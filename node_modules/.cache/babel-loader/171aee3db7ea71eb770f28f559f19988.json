{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useMemo,useState}from'react';import{ArrowBackIcon,Card,CardBody,CardHeader,Flex,Heading,IconButton,Button,BinanceIcon,Text,BalanceInput,Slider,Box,AutoRenewIcon}from'@pancakeswap/uikit';import{ethers}from'ethers';import{parseUnits}from'ethers/lib/utils';import{useWeb3React}from'@web3-react/core';import{useGetMinBetAmount}from'state/predictions/hooks';import{useTranslation}from'contexts/Localization';import{usePredictionsContract}from'hooks/useContract';import{useGetBnbBalance}from'hooks/useTokenBalance';import useToast from'hooks/useToast';import{useCallWithGasPrice}from'hooks/useCallWithGasPrice';import{BetPosition}from'state/types';import{formatBigNumber,formatFixedNumber}from'utils/formatBalance';import ConnectWalletButton from'components/ConnectWalletButton';import PositionTag from'../PositionTag';import useSwiper from'../../hooks/useSwiper';import FlexRow from'../FlexRow';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var dust=parseUnits('0.01',18);var percentShortcuts=[10,25,50,75];var getButtonProps=function getButtonProps(value,bnbBalance,minBetAmountBalance){var hasSufficientBalance=function hasSufficientBalance(){if(value.gt(0)){return value.lte(bnbBalance);}return bnbBalance.gt(0);};if(!hasSufficientBalance()){return{key:'Insufficient BNB balance',disabled:true};}if(value.eq(0)){return{key:'Enter an amount',disabled:true};}return{key:'Confirm',disabled:value.lt(minBetAmountBalance)};};var getValueAsEthersBn=function getValueAsEthersBn(value){var valueAsFloat=parseFloat(value);return Number.isNaN(valueAsFloat)?ethers.BigNumber.from(0):parseUnits(value);};var SetPositionCard=function SetPositionCard(_ref){var position=_ref.position,togglePosition=_ref.togglePosition,epoch=_ref.epoch,onBack=_ref.onBack,onSuccess=_ref.onSuccess;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),value=_useState2[0],setValue=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isTxPending=_useState4[0],setIsTxPending=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),errorMessage=_useState6[0],setErrorMessage=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),percent=_useState8[0],setPercent=_useState8[1];var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var _useSwiper=useSwiper(),swiper=_useSwiper.swiper;var _useGetBnbBalance=useGetBnbBalance(),bnbBalance=_useGetBnbBalance.balance;var minBetAmount=useGetMinBetAmount();var _useTranslation=useTranslation(),t=_useTranslation.t;var _useToast=useToast(),toastError=_useToast.toastError;var _useCallWithGasPrice=useCallWithGasPrice(),callWithGasPrice=_useCallWithGasPrice.callWithGasPrice;var predictionsContract=usePredictionsContract();var maxBalance=useMemo(function(){return bnbBalance.gt(dust)?bnbBalance.sub(dust):dust;},[bnbBalance]);var balanceDisplay=formatBigNumber(bnbBalance);var valueAsBn=getValueAsEthersBn(value);var showFieldWarning=account&&valueAsBn.gt(0)&&errorMessage!==null;var handleInputChange=function handleInputChange(input){var inputAsBn=getValueAsEthersBn(input);if(inputAsBn.eq(0)){setPercent(0);}else{var inputAsFn=ethers.FixedNumber.from(inputAsBn);var maxValueAsFn=ethers.FixedNumber.from(maxBalance);var hundredAsFn=ethers.FixedNumber.from(100);var percentage=inputAsFn.divUnsafe(maxValueAsFn).mulUnsafe(hundredAsFn);var percentageAsFloat=percentage.toUnsafeFloat();setPercent(percentageAsFloat>100?100:percentageAsFloat);}setValue(input);};var handlePercentChange=function handlePercentChange(sliderPercent){if(sliderPercent>0){var maxValueAsFn=ethers.FixedNumber.from(maxBalance);var hundredAsFn=ethers.FixedNumber.from(100);var sliderPercentAsFn=ethers.FixedNumber.from(sliderPercent.toFixed(18)).divUnsafe(hundredAsFn);var balancePercentage=maxValueAsFn.mulUnsafe(sliderPercentAsFn);setValue(formatFixedNumber(balancePercentage));}else{setValue('');}setPercent(sliderPercent);};// Clear value\nvar handleGoBack=function handleGoBack(){setValue('');setPercent(0);onBack();};// Disable the swiper events to avoid conflicts\nvar handleMouseOver=function handleMouseOver(){swiper.keyboard.disable();swiper.mousewheel.disable();swiper.detachEvents();};var handleMouseOut=function handleMouseOut(){swiper.keyboard.enable();swiper.mousewheel.enable();swiper.attachEvents();};var _getButtonProps=getButtonProps(valueAsBn,maxBalance,minBetAmount),key=_getButtonProps.key,disabled=_getButtonProps.disabled;var handleEnterPosition=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var betMethod,tx,receipt;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:betMethod=position===BetPosition.BULL?'betBull':'betBear';_context.prev=1;_context.next=4;return callWithGasPrice(predictionsContract,betMethod,[epoch],{value:valueAsBn.toString()});case 4:tx=_context.sent;setIsTxPending(true);_context.next=8;return tx.wait();case 8:receipt=_context.sent;onSuccess(receipt.transactionHash);_context.next=15;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](1);toastError(t('Error'),t('Please try again. Confirm the transaction and make sure you are paying enough gas!'));case 15:_context.prev=15;setIsTxPending(false);return _context.finish(15);case 18:case\"end\":return _context.stop();}}},_callee,null,[[1,12,15,18]]);}));return function handleEnterPosition(){return _ref2.apply(this,arguments);};}();// Warnings\nuseEffect(function(){var inputAmount=getValueAsEthersBn(value);var hasSufficientBalance=inputAmount.gt(0)&&inputAmount.lte(maxBalance);if(!hasSufficientBalance){setErrorMessage({key:'Insufficient BNB balance'});}else if(inputAmount.gt(0)&&inputAmount.lt(minBetAmount)){setErrorMessage({key:'A minimum amount of %num% %token% is required',data:{num:formatBigNumber(minBetAmount),token:'BNB'}});}else{setErrorMessage(null);}},[value,maxBalance,minBetAmount,setErrorMessage]);return/*#__PURE__*/_jsxs(Card,{onMouseOver:handleMouseOver,onMouseOut:handleMouseOut,children:[/*#__PURE__*/_jsx(CardHeader,{p:\"16px\",children:/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",children:[/*#__PURE__*/_jsx(IconButton,{variant:\"text\",scale:\"sm\",onClick:handleGoBack,mr:\"8px\",children:/*#__PURE__*/_jsx(ArrowBackIcon,{width:\"24px\"})}),/*#__PURE__*/_jsx(FlexRow,{children:/*#__PURE__*/_jsx(Heading,{scale:\"md\",children:t('Set Position')})}),/*#__PURE__*/_jsx(PositionTag,{betPosition:position,onClick:togglePosition,children:position===BetPosition.BULL?t('Up'):t('Down')})]})}),/*#__PURE__*/_jsxs(CardBody,{py:\"16px\",children:[/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"space-between\",mb:\"8px\",children:[/*#__PURE__*/_jsxs(Text,{textAlign:\"right\",color:\"textSubtle\",children:[t('Commit'),\":\"]}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",children:[/*#__PURE__*/_jsx(BinanceIcon,{mr:\"4px  \"}),/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",children:\"BNB\"})]})]}),/*#__PURE__*/_jsx(BalanceInput,{value:value,onUserInput:handleInputChange,isWarning:showFieldWarning,inputProps:{disabled:!account||isTxPending}}),showFieldWarning&&/*#__PURE__*/_jsx(Text,{color:\"failure\",fontSize:\"12px\",mt:\"4px\",textAlign:\"right\",children:t(errorMessage.key,errorMessage.data)}),/*#__PURE__*/_jsx(Text,{textAlign:\"right\",mb:\"16px\",color:\"textSubtle\",fontSize:\"12px\",style:{height:'18px'},children:account&&t('Balance: %balance%',{balance:balanceDisplay})}),/*#__PURE__*/_jsx(Slider,{name:\"balance\",min:0,max:100,value:percent,onValueChanged:handlePercentChange,valueLabel:account?\"\".concat(percent.toFixed(percent>0?1:0),\"%\"):'',step:0.01,disabled:!account||isTxPending,mb:\"4px\",className:!account||isTxPending?'':'swiper-no-swiping'}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"space-between\",mb:\"16px\",children:[percentShortcuts.map(function(percentShortcut){var handleClick=function handleClick(){handlePercentChange(percentShortcut);};return/*#__PURE__*/_jsx(Button,{scale:\"xs\",variant:\"tertiary\",onClick:handleClick,disabled:!account||isTxPending,style:{flex:1},children:\"\".concat(percentShortcut,\"%\")},percentShortcut);}),/*#__PURE__*/_jsx(Button,{scale:\"xs\",variant:\"tertiary\",onClick:function onClick(){return handlePercentChange(100);},disabled:!account||isTxPending,children:t('Max')})]}),/*#__PURE__*/_jsx(Box,{mb:\"8px\",children:account?/*#__PURE__*/_jsx(Button,{width:\"100%\",disabled:!account||disabled,onClick:handleEnterPosition,isLoading:isTxPending,endIcon:isTxPending?/*#__PURE__*/_jsx(AutoRenewIcon,{color:\"currentColor\",spin:true}):null,children:t(key)}):/*#__PURE__*/_jsx(ConnectWalletButton,{width:\"100%\"})}),/*#__PURE__*/_jsx(Text,{as:\"p\",fontSize:\"12px\",lineHeight:1,color:\"textSubtle\",children:t('You wonâ€™t be able to remove or change your position once you enter it.')})]})]});};export default SetPositionCard;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/views/Predictions/components/RoundCard/SetPositionCard.tsx"],"names":["React","useEffect","useMemo","useState","ArrowBackIcon","Card","CardBody","CardHeader","Flex","Heading","IconButton","Button","BinanceIcon","Text","BalanceInput","Slider","Box","AutoRenewIcon","ethers","parseUnits","useWeb3React","useGetMinBetAmount","useTranslation","usePredictionsContract","useGetBnbBalance","useToast","useCallWithGasPrice","BetPosition","formatBigNumber","formatFixedNumber","ConnectWalletButton","PositionTag","useSwiper","FlexRow","dust","percentShortcuts","getButtonProps","value","bnbBalance","minBetAmountBalance","hasSufficientBalance","gt","lte","key","disabled","eq","lt","getValueAsEthersBn","valueAsFloat","parseFloat","Number","isNaN","BigNumber","from","SetPositionCard","position","togglePosition","epoch","onBack","onSuccess","setValue","isTxPending","setIsTxPending","errorMessage","setErrorMessage","percent","setPercent","account","swiper","balance","minBetAmount","t","toastError","callWithGasPrice","predictionsContract","maxBalance","sub","balanceDisplay","valueAsBn","showFieldWarning","handleInputChange","input","inputAsBn","inputAsFn","FixedNumber","maxValueAsFn","hundredAsFn","percentage","divUnsafe","mulUnsafe","percentageAsFloat","toUnsafeFloat","handlePercentChange","sliderPercent","sliderPercentAsFn","toFixed","balancePercentage","handleGoBack","handleMouseOver","keyboard","disable","mousewheel","detachEvents","handleMouseOut","enable","attachEvents","handleEnterPosition","betMethod","BULL","toString","tx","wait","receipt","transactionHash","inputAmount","data","num","token","height","map","percentShortcut","handleClick","flex"],"mappings":"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","sourcesContent":["import React, { useEffect, useMemo, useState } from 'react'\nimport {\n  ArrowBackIcon,\n  Card,\n  CardBody,\n  CardHeader,\n  Flex,\n  Heading,\n  IconButton,\n  Button,\n  BinanceIcon,\n  Text,\n  BalanceInput,\n  Slider,\n  Box,\n  AutoRenewIcon,\n} from '@pancakeswap/uikit'\nimport { ethers } from 'ethers'\nimport { parseUnits } from 'ethers/lib/utils'\nimport { useWeb3React } from '@web3-react/core'\nimport { useGetMinBetAmount } from 'state/predictions/hooks'\nimport { useTranslation } from 'contexts/Localization'\nimport { usePredictionsContract } from 'hooks/useContract'\nimport { useGetBnbBalance } from 'hooks/useTokenBalance'\nimport useToast from 'hooks/useToast'\nimport { useCallWithGasPrice } from 'hooks/useCallWithGasPrice'\nimport { BetPosition } from 'state/types'\nimport { formatBigNumber, formatFixedNumber } from 'utils/formatBalance'\nimport ConnectWalletButton from 'components/ConnectWalletButton'\nimport PositionTag from '../PositionTag'\nimport useSwiper from '../../hooks/useSwiper'\nimport FlexRow from '../FlexRow'\n\ninterface SetPositionCardProps {\n  position: BetPosition\n  togglePosition: () => void\n  epoch: number\n  onBack: () => void\n  onSuccess: (hash: string) => Promise<void>\n}\n\nconst dust = parseUnits('0.01', 18)\nconst percentShortcuts = [10, 25, 50, 75]\n\nconst getButtonProps = (\n  value: ethers.BigNumber,\n  bnbBalance: ethers.BigNumber,\n  minBetAmountBalance: ethers.BigNumber,\n) => {\n  const hasSufficientBalance = () => {\n    if (value.gt(0)) {\n      return value.lte(bnbBalance)\n    }\n    return bnbBalance.gt(0)\n  }\n\n  if (!hasSufficientBalance()) {\n    return { key: 'Insufficient BNB balance', disabled: true }\n  }\n\n  if (value.eq(0)) {\n    return { key: 'Enter an amount', disabled: true }\n  }\n\n  return { key: 'Confirm', disabled: value.lt(minBetAmountBalance) }\n}\n\nconst getValueAsEthersBn = (value: string) => {\n  const valueAsFloat = parseFloat(value)\n  return Number.isNaN(valueAsFloat) ? ethers.BigNumber.from(0) : parseUnits(value)\n}\n\nconst SetPositionCard: React.FC<SetPositionCardProps> = ({ position, togglePosition, epoch, onBack, onSuccess }) => {\n  const [value, setValue] = useState('')\n  const [isTxPending, setIsTxPending] = useState(false)\n  const [errorMessage, setErrorMessage] = useState(null)\n  const [percent, setPercent] = useState(0)\n\n  const { account } = useWeb3React()\n  const { swiper } = useSwiper()\n  const { balance: bnbBalance } = useGetBnbBalance()\n  const minBetAmount = useGetMinBetAmount()\n  const { t } = useTranslation()\n  const { toastError } = useToast()\n  const { callWithGasPrice } = useCallWithGasPrice()\n  const predictionsContract = usePredictionsContract()\n\n  const maxBalance = useMemo(() => {\n    return bnbBalance.gt(dust) ? bnbBalance.sub(dust) : dust\n  }, [bnbBalance])\n  const balanceDisplay = formatBigNumber(bnbBalance)\n\n  const valueAsBn = getValueAsEthersBn(value)\n  const showFieldWarning = account && valueAsBn.gt(0) && errorMessage !== null\n\n  const handleInputChange = (input: string) => {\n    const inputAsBn = getValueAsEthersBn(input)\n\n    if (inputAsBn.eq(0)) {\n      setPercent(0)\n    } else {\n      const inputAsFn = ethers.FixedNumber.from(inputAsBn)\n      const maxValueAsFn = ethers.FixedNumber.from(maxBalance)\n      const hundredAsFn = ethers.FixedNumber.from(100)\n      const percentage = inputAsFn.divUnsafe(maxValueAsFn).mulUnsafe(hundredAsFn)\n      const percentageAsFloat = percentage.toUnsafeFloat()\n\n      setPercent(percentageAsFloat > 100 ? 100 : percentageAsFloat)\n    }\n    setValue(input)\n  }\n\n  const handlePercentChange = (sliderPercent: number) => {\n    if (sliderPercent > 0) {\n      const maxValueAsFn = ethers.FixedNumber.from(maxBalance)\n      const hundredAsFn = ethers.FixedNumber.from(100)\n      const sliderPercentAsFn = ethers.FixedNumber.from(sliderPercent.toFixed(18)).divUnsafe(hundredAsFn)\n      const balancePercentage = maxValueAsFn.mulUnsafe(sliderPercentAsFn)\n      setValue(formatFixedNumber(balancePercentage))\n    } else {\n      setValue('')\n    }\n    setPercent(sliderPercent)\n  }\n\n  // Clear value\n  const handleGoBack = () => {\n    setValue('')\n    setPercent(0)\n    onBack()\n  }\n\n  // Disable the swiper events to avoid conflicts\n  const handleMouseOver = () => {\n    swiper.keyboard.disable()\n    swiper.mousewheel.disable()\n    swiper.detachEvents()\n  }\n\n  const handleMouseOut = () => {\n    swiper.keyboard.enable()\n    swiper.mousewheel.enable()\n    swiper.attachEvents()\n  }\n\n  const { key, disabled } = getButtonProps(valueAsBn, maxBalance, minBetAmount)\n\n  const handleEnterPosition = async () => {\n    const betMethod = position === BetPosition.BULL ? 'betBull' : 'betBear'\n\n    try {\n      const tx = await callWithGasPrice(predictionsContract, betMethod, [epoch], { value: valueAsBn.toString() })\n      setIsTxPending(true)\n      const receipt = await tx.wait()\n      onSuccess(receipt.transactionHash)\n    } catch {\n      toastError(t('Error'), t('Please try again. Confirm the transaction and make sure you are paying enough gas!'))\n    } finally {\n      setIsTxPending(false)\n    }\n  }\n\n  // Warnings\n  useEffect(() => {\n    const inputAmount = getValueAsEthersBn(value)\n    const hasSufficientBalance = inputAmount.gt(0) && inputAmount.lte(maxBalance)\n\n    if (!hasSufficientBalance) {\n      setErrorMessage({ key: 'Insufficient BNB balance' })\n    } else if (inputAmount.gt(0) && inputAmount.lt(minBetAmount)) {\n      setErrorMessage({\n        key: 'A minimum amount of %num% %token% is required',\n        data: { num: formatBigNumber(minBetAmount), token: 'BNB' },\n      })\n    } else {\n      setErrorMessage(null)\n    }\n  }, [value, maxBalance, minBetAmount, setErrorMessage])\n\n  return (\n    <Card onMouseOver={handleMouseOver} onMouseOut={handleMouseOut}>\n      <CardHeader p=\"16px\">\n        <Flex alignItems=\"center\">\n          <IconButton variant=\"text\" scale=\"sm\" onClick={handleGoBack} mr=\"8px\">\n            <ArrowBackIcon width=\"24px\" />\n          </IconButton>\n          <FlexRow>\n            <Heading scale=\"md\">{t('Set Position')}</Heading>\n          </FlexRow>\n          <PositionTag betPosition={position} onClick={togglePosition}>\n            {position === BetPosition.BULL ? t('Up') : t('Down')}\n          </PositionTag>\n        </Flex>\n      </CardHeader>\n      <CardBody py=\"16px\">\n        <Flex alignItems=\"center\" justifyContent=\"space-between\" mb=\"8px\">\n          <Text textAlign=\"right\" color=\"textSubtle\">\n            {t('Commit')}:\n          </Text>\n          <Flex alignItems=\"center\">\n            <BinanceIcon mr=\"4px  \" />\n            <Text bold textTransform=\"uppercase\">\n              BNB\n            </Text>\n          </Flex>\n        </Flex>\n        <BalanceInput\n          value={value}\n          onUserInput={handleInputChange}\n          isWarning={showFieldWarning}\n          inputProps={{ disabled: !account || isTxPending }}\n        />\n        {showFieldWarning && (\n          <Text color=\"failure\" fontSize=\"12px\" mt=\"4px\" textAlign=\"right\">\n            {t(errorMessage.key, errorMessage.data)}\n          </Text>\n        )}\n        <Text textAlign=\"right\" mb=\"16px\" color=\"textSubtle\" fontSize=\"12px\" style={{ height: '18px' }}>\n          {account && t('Balance: %balance%', { balance: balanceDisplay })}\n        </Text>\n        <Slider\n          name=\"balance\"\n          min={0}\n          max={100}\n          value={percent}\n          onValueChanged={handlePercentChange}\n          valueLabel={account ? `${percent.toFixed(percent > 0 ? 1 : 0)}%` : ''}\n          step={0.01}\n          disabled={!account || isTxPending}\n          mb=\"4px\"\n          className={!account || isTxPending ? '' : 'swiper-no-swiping'}\n        />\n        <Flex alignItems=\"center\" justifyContent=\"space-between\" mb=\"16px\">\n          {percentShortcuts.map((percentShortcut) => {\n            const handleClick = () => {\n              handlePercentChange(percentShortcut)\n            }\n\n            return (\n              <Button\n                key={percentShortcut}\n                scale=\"xs\"\n                variant=\"tertiary\"\n                onClick={handleClick}\n                disabled={!account || isTxPending}\n                style={{ flex: 1 }}\n              >\n                {`${percentShortcut}%`}\n              </Button>\n            )\n          })}\n          <Button\n            scale=\"xs\"\n            variant=\"tertiary\"\n            onClick={() => handlePercentChange(100)}\n            disabled={!account || isTxPending}\n          >\n            {t('Max')}\n          </Button>\n        </Flex>\n        <Box mb=\"8px\">\n          {account ? (\n            <Button\n              width=\"100%\"\n              disabled={!account || disabled}\n              onClick={handleEnterPosition}\n              isLoading={isTxPending}\n              endIcon={isTxPending ? <AutoRenewIcon color=\"currentColor\" spin /> : null}\n            >\n              {t(key)}\n            </Button>\n          ) : (\n            <ConnectWalletButton width=\"100%\" />\n          )}\n        </Box>\n        <Text as=\"p\" fontSize=\"12px\" lineHeight={1} color=\"textSubtle\">\n          {t('You wonâ€™t be able to remove or change your position once you enter it.')}\n        </Text>\n      </CardBody>\n    </Card>\n  )\n}\n\nexport default SetPositionCard\n"]},"metadata":{},"sourceType":"module"}