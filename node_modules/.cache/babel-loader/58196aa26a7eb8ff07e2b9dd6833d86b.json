{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useCallback,useEffect,useState,useMemo}from'react';import{useDispatch,useSelector}from'react-redux';import{getUnixTime,startOfHour,sub}from'date-fns';import{isAddress}from'utils';import fetchPoolChartData from'state/info/queries/pools/chartData';import fetchPoolTransactions from'state/info/queries/pools/transactions';import fetchTokenChartData from'state/info/queries/tokens/chartData';import fetchTokenTransactions from'state/info/queries/tokens/transactions';import fetchTokenPriceData from'state/info/queries/tokens/priceData';import fetchPoolsForToken from'state/info/queries/tokens/poolsForToken';import{updateProtocolData,updateProtocolChartData,updateProtocolTransactions,updatePoolData,addPoolKeys,updatePoolChartData,updatePoolTransactions,updateTokenData,addTokenKeys,addTokenPoolAddresses,updateTokenChartData,updateTokenPriceData,updateTokenTransactions}from'./actions';// Protocol hooks\nexport var useProtocolData=function useProtocolData(){var protocolData=useSelector(function(state){return state.info.protocol.overview;});var dispatch=useDispatch();var setProtocolData=useCallback(function(data){return dispatch(updateProtocolData({protocolData:data}));},[dispatch]);return[protocolData,setProtocolData];};export var useProtocolChartData=function useProtocolChartData(){var chartData=useSelector(function(state){return state.info.protocol.chartData;});var dispatch=useDispatch();var setChartData=useCallback(function(data){return dispatch(updateProtocolChartData({chartData:data}));},[dispatch]);return[chartData,setChartData];};export var useProtocolTransactions=function useProtocolTransactions(){var transactions=useSelector(function(state){return state.info.protocol.transactions;});var dispatch=useDispatch();var setTransactions=useCallback(function(transactionsData){return dispatch(updateProtocolTransactions({transactions:transactionsData}));},[dispatch]);return[transactions,setTransactions];};// Pools hooks\nexport var useAllPoolData=function useAllPoolData(){return useSelector(function(state){return state.info.pools.byAddress;});};export var useUpdatePoolData=function useUpdatePoolData(){var dispatch=useDispatch();return useCallback(function(pools){return dispatch(updatePoolData({pools:pools}));},[dispatch]);};export var useAddPoolKeys=function useAddPoolKeys(){var dispatch=useDispatch();return useCallback(function(poolAddresses){return dispatch(addPoolKeys({poolAddresses:poolAddresses}));},[dispatch]);};export var usePoolDatas=function usePoolDatas(poolAddresses){var allPoolData=useAllPoolData();var addNewPoolKeys=useAddPoolKeys();var untrackedAddresses=poolAddresses.reduce(function(accum,address){if(!Object.keys(allPoolData).includes(address)){accum.push(address);}return accum;},[]);useEffect(function(){if(untrackedAddresses){addNewPoolKeys(untrackedAddresses);}},[addNewPoolKeys,untrackedAddresses]);var poolsWithData=poolAddresses.map(function(address){var _allPoolData$address;return(_allPoolData$address=allPoolData[address])===null||_allPoolData$address===void 0?void 0:_allPoolData$address.data;}).filter(function(pool){return pool;});return poolsWithData;};export var usePoolChartData=function usePoolChartData(address){var dispatch=useDispatch();var pool=useSelector(function(state){return state.info.pools.byAddress[address];});var chartData=pool===null||pool===void 0?void 0:pool.chartData;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];useEffect(function(){var fetch=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$fetchPoolChart,fetchError,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetchPoolChartData(address);case 2:_yield$fetchPoolChart=_context.sent;fetchError=_yield$fetchPoolChart.error;data=_yield$fetchPoolChart.data;if(!fetchError&&data){dispatch(updatePoolChartData({poolAddress:address,chartData:data}));}if(fetchError){setError(fetchError);}case 7:case\"end\":return _context.stop();}}},_callee);}));return function fetch(){return _ref.apply(this,arguments);};}();if(!chartData&&!error){fetch();}},[address,dispatch,error,chartData]);return chartData;};export var usePoolTransactions=function usePoolTransactions(address){var dispatch=useDispatch();var pool=useSelector(function(state){return state.info.pools.byAddress[address];});var transactions=pool===null||pool===void 0?void 0:pool.transactions;var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];useEffect(function(){var fetch=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$fetchPoolTrans,fetchError,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetchPoolTransactions(address);case 2:_yield$fetchPoolTrans=_context2.sent;fetchError=_yield$fetchPoolTrans.error;data=_yield$fetchPoolTrans.data;if(fetchError){setError(true);}else{dispatch(updatePoolTransactions({poolAddress:address,transactions:data}));}case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function fetch(){return _ref2.apply(this,arguments);};}();if(!transactions&&!error){fetch();}},[address,dispatch,error,transactions]);return transactions;};// Tokens hooks\nexport var useAllTokenData=function useAllTokenData(){return useSelector(function(state){return state.info.tokens.byAddress;});};export var useUpdateTokenData=function useUpdateTokenData(){var dispatch=useDispatch();return useCallback(function(tokens){dispatch(updateTokenData({tokens:tokens}));},[dispatch]);};export var useAddTokenKeys=function useAddTokenKeys(){var dispatch=useDispatch();return useCallback(function(tokenAddresses){return dispatch(addTokenKeys({tokenAddresses:tokenAddresses}));},[dispatch]);};export var useTokenDatas=function useTokenDatas(addresses){var allTokenData=useAllTokenData();var addNewTokenKeys=useAddTokenKeys();// if token not tracked yet track it\naddresses===null||addresses===void 0?void 0:addresses.forEach(function(a){if(!allTokenData[a]){addNewTokenKeys([a]);}});var tokensWithData=useMemo(function(){if(!addresses){return undefined;}return addresses.map(function(a){var _allTokenData$a;return(_allTokenData$a=allTokenData[a])===null||_allTokenData$a===void 0?void 0:_allTokenData$a.data;}).filter(function(token){return token;});},[addresses,allTokenData]);return tokensWithData;};export var useTokenData=function useTokenData(address){var _allTokenData$address;var allTokenData=useAllTokenData();var addNewTokenKeys=useAddTokenKeys();if(!address||!isAddress(address)){return undefined;}// if token not tracked yet track it\nif(!allTokenData[address]){addNewTokenKeys([address]);}return(_allTokenData$address=allTokenData[address])===null||_allTokenData$address===void 0?void 0:_allTokenData$address.data;};export var usePoolsForToken=function usePoolsForToken(address){var dispatch=useDispatch();var token=useSelector(function(state){return state.info.tokens.byAddress[address];});var poolsForToken=token.poolAddresses;var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];useEffect(function(){var fetch=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _yield$fetchPoolsForT,fetchError,addresses;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return fetchPoolsForToken(address);case 2:_yield$fetchPoolsForT=_context3.sent;fetchError=_yield$fetchPoolsForT.error;addresses=_yield$fetchPoolsForT.addresses;if(!fetchError&&addresses){dispatch(addTokenPoolAddresses({tokenAddress:address,poolAddresses:addresses}));}if(fetchError){setError(fetchError);}case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function fetch(){return _ref3.apply(this,arguments);};}();if(!poolsForToken&&!error){fetch();}},[address,dispatch,error,poolsForToken]);return poolsForToken;};export var useTokenChartData=function useTokenChartData(address){var dispatch=useDispatch();var token=useSelector(function(state){return state.info.tokens.byAddress[address];});var chartData=token.chartData;var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];useEffect(function(){var fetch=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var _yield$fetchTokenChar,fetchError,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return fetchTokenChartData(address);case 2:_yield$fetchTokenChar=_context4.sent;fetchError=_yield$fetchTokenChar.error;data=_yield$fetchTokenChar.data;if(!fetchError&&data){dispatch(updateTokenChartData({tokenAddress:address,chartData:data}));}if(fetchError){setError(fetchError);}case 7:case\"end\":return _context4.stop();}}},_callee4);}));return function fetch(){return _ref4.apply(this,arguments);};}();if(!chartData&&!error){fetch();}},[address,dispatch,error,chartData]);return chartData;};export var useTokenPriceData=function useTokenPriceData(address,interval,timeWindow){var dispatch=useDispatch();var token=useSelector(function(state){return state.info.tokens.byAddress[address];});var priceData=token.priceData[interval];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),error=_useState10[0],setError=_useState10[1];// construct timestamps and check if we need to fetch more data\nvar oldestTimestampFetched=token.priceData.oldestFetchedTimestamp;var utcCurrentTime=getUnixTime(new Date())*1000;var startTimestamp=getUnixTime(startOfHour(sub(utcCurrentTime,timeWindow)));useEffect(function(){var fetch=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var _yield$fetchTokenPric,data,fetchingError;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return fetchTokenPriceData(address,interval,startTimestamp);case 2:_yield$fetchTokenPric=_context5.sent;data=_yield$fetchTokenPric.data;fetchingError=_yield$fetchTokenPric.error;if(data){dispatch(updateTokenPriceData({tokenAddress:address,secondsInterval:interval,priceData:data,oldestFetchedTimestamp:startTimestamp}));}if(fetchingError){setError(true);}case 7:case\"end\":return _context5.stop();}}},_callee5);}));return function fetch(){return _ref5.apply(this,arguments);};}();if(!priceData&&!error){fetch();}},[address,dispatch,error,interval,oldestTimestampFetched,priceData,startTimestamp,timeWindow]);return priceData;};export var useTokenTransactions=function useTokenTransactions(address){var dispatch=useDispatch();var token=useSelector(function(state){return state.info.tokens.byAddress[address];});var transactions=token.transactions;var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),error=_useState12[0],setError=_useState12[1];useEffect(function(){var fetch=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var _yield$fetchTokenTran,fetchError,data;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return fetchTokenTransactions(address);case 2:_yield$fetchTokenTran=_context6.sent;fetchError=_yield$fetchTokenTran.error;data=_yield$fetchTokenTran.data;if(fetchError){setError(true);}else if(data){dispatch(updateTokenTransactions({tokenAddress:address,transactions:data}));}case 6:case\"end\":return _context6.stop();}}},_callee6);}));return function fetch(){return _ref6.apply(this,arguments);};}();if(!transactions&&!error){fetch();}},[address,dispatch,error,transactions]);return transactions;};","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/state/info/hooks.ts"],"names":["useCallback","useEffect","useState","useMemo","useDispatch","useSelector","getUnixTime","startOfHour","sub","isAddress","fetchPoolChartData","fetchPoolTransactions","fetchTokenChartData","fetchTokenTransactions","fetchTokenPriceData","fetchPoolsForToken","updateProtocolData","updateProtocolChartData","updateProtocolTransactions","updatePoolData","addPoolKeys","updatePoolChartData","updatePoolTransactions","updateTokenData","addTokenKeys","addTokenPoolAddresses","updateTokenChartData","updateTokenPriceData","updateTokenTransactions","useProtocolData","protocolData","state","info","protocol","overview","dispatch","setProtocolData","data","useProtocolChartData","chartData","setChartData","useProtocolTransactions","transactions","setTransactions","transactionsData","useAllPoolData","pools","byAddress","useUpdatePoolData","useAddPoolKeys","poolAddresses","usePoolDatas","allPoolData","addNewPoolKeys","untrackedAddresses","reduce","accum","address","Object","keys","includes","push","poolsWithData","map","filter","pool","usePoolChartData","error","setError","fetch","fetchError","poolAddress","usePoolTransactions","useAllTokenData","tokens","useUpdateTokenData","useAddTokenKeys","tokenAddresses","useTokenDatas","addresses","allTokenData","addNewTokenKeys","forEach","a","tokensWithData","undefined","token","useTokenData","usePoolsForToken","poolsForToken","tokenAddress","useTokenChartData","useTokenPriceData","interval","timeWindow","priceData","oldestTimestampFetched","oldestFetchedTimestamp","utcCurrentTime","Date","startTimestamp","fetchingError","secondsInterval","useTokenTransactions"],"mappings":"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","sourcesContent":["import { useCallback, useEffect, useState, useMemo } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { getUnixTime, startOfHour, Duration, sub } from 'date-fns'\nimport { AppState, AppDispatch } from 'state'\nimport { isAddress } from 'utils'\nimport { Transaction } from 'state/info/types'\nimport fetchPoolChartData from 'state/info/queries/pools/chartData'\nimport fetchPoolTransactions from 'state/info/queries/pools/transactions'\nimport fetchTokenChartData from 'state/info/queries/tokens/chartData'\nimport fetchTokenTransactions from 'state/info/queries/tokens/transactions'\nimport fetchTokenPriceData from 'state/info/queries/tokens/priceData'\nimport fetchPoolsForToken from 'state/info/queries/tokens/poolsForToken'\nimport {\n  updateProtocolData,\n  updateProtocolChartData,\n  updateProtocolTransactions,\n  updatePoolData,\n  addPoolKeys,\n  updatePoolChartData,\n  updatePoolTransactions,\n  updateTokenData,\n  addTokenKeys,\n  addTokenPoolAddresses,\n  updateTokenChartData,\n  updateTokenPriceData,\n  updateTokenTransactions,\n} from './actions'\nimport { ProtocolData, PoolData, TokenData, ChartEntry, PriceChartEntry } from './types'\n\n// Protocol hooks\n\nexport const useProtocolData = (): [ProtocolData | undefined, (protocolData: ProtocolData) => void] => {\n  const protocolData: ProtocolData | undefined = useSelector((state: AppState) => state.info.protocol.overview)\n\n  const dispatch = useDispatch<AppDispatch>()\n  const setProtocolData: (protocolData: ProtocolData) => void = useCallback(\n    (data: ProtocolData) => dispatch(updateProtocolData({ protocolData: data })),\n    [dispatch],\n  )\n\n  return [protocolData, setProtocolData]\n}\n\nexport const useProtocolChartData = (): [ChartEntry[] | undefined, (chartData: ChartEntry[]) => void] => {\n  const chartData: ChartEntry[] | undefined = useSelector((state: AppState) => state.info.protocol.chartData)\n  const dispatch = useDispatch<AppDispatch>()\n  const setChartData: (chartData: ChartEntry[]) => void = useCallback(\n    (data: ChartEntry[]) => dispatch(updateProtocolChartData({ chartData: data })),\n    [dispatch],\n  )\n  return [chartData, setChartData]\n}\n\nexport const useProtocolTransactions = (): [Transaction[] | undefined, (transactions: Transaction[]) => void] => {\n  const transactions: Transaction[] | undefined = useSelector((state: AppState) => state.info.protocol.transactions)\n  const dispatch = useDispatch<AppDispatch>()\n  const setTransactions: (transactions: Transaction[]) => void = useCallback(\n    (transactionsData: Transaction[]) => dispatch(updateProtocolTransactions({ transactions: transactionsData })),\n    [dispatch],\n  )\n  return [transactions, setTransactions]\n}\n\n// Pools hooks\n\nexport const useAllPoolData = (): {\n  [address: string]: { data?: PoolData }\n} => {\n  return useSelector((state: AppState) => state.info.pools.byAddress)\n}\n\nexport const useUpdatePoolData = (): ((pools: PoolData[]) => void) => {\n  const dispatch = useDispatch<AppDispatch>()\n  return useCallback((pools: PoolData[]) => dispatch(updatePoolData({ pools })), [dispatch])\n}\n\nexport const useAddPoolKeys = (): ((addresses: string[]) => void) => {\n  const dispatch = useDispatch<AppDispatch>()\n  return useCallback((poolAddresses: string[]) => dispatch(addPoolKeys({ poolAddresses })), [dispatch])\n}\n\nexport const usePoolDatas = (poolAddresses: string[]): PoolData[] => {\n  const allPoolData = useAllPoolData()\n  const addNewPoolKeys = useAddPoolKeys()\n\n  const untrackedAddresses = poolAddresses.reduce((accum: string[], address) => {\n    if (!Object.keys(allPoolData).includes(address)) {\n      accum.push(address)\n    }\n    return accum\n  }, [])\n\n  useEffect(() => {\n    if (untrackedAddresses) {\n      addNewPoolKeys(untrackedAddresses)\n    }\n  }, [addNewPoolKeys, untrackedAddresses])\n\n  const poolsWithData = poolAddresses\n    .map((address) => {\n      return allPoolData[address]?.data\n    })\n    .filter((pool) => pool)\n\n  return poolsWithData\n}\n\nexport const usePoolChartData = (address: string): ChartEntry[] | undefined => {\n  const dispatch = useDispatch<AppDispatch>()\n  const pool = useSelector((state: AppState) => state.info.pools.byAddress[address])\n  const chartData = pool?.chartData\n  const [error, setError] = useState(false)\n\n  useEffect(() => {\n    const fetch = async () => {\n      const { error: fetchError, data } = await fetchPoolChartData(address)\n      if (!fetchError && data) {\n        dispatch(updatePoolChartData({ poolAddress: address, chartData: data }))\n      }\n      if (fetchError) {\n        setError(fetchError)\n      }\n    }\n    if (!chartData && !error) {\n      fetch()\n    }\n  }, [address, dispatch, error, chartData])\n\n  return chartData\n}\n\nexport const usePoolTransactions = (address: string): Transaction[] | undefined => {\n  const dispatch = useDispatch<AppDispatch>()\n  const pool = useSelector((state: AppState) => state.info.pools.byAddress[address])\n  const transactions = pool?.transactions\n  const [error, setError] = useState(false)\n\n  useEffect(() => {\n    const fetch = async () => {\n      const { error: fetchError, data } = await fetchPoolTransactions(address)\n      if (fetchError) {\n        setError(true)\n      } else {\n        dispatch(updatePoolTransactions({ poolAddress: address, transactions: data }))\n      }\n    }\n    if (!transactions && !error) {\n      fetch()\n    }\n  }, [address, dispatch, error, transactions])\n\n  return transactions\n}\n\n// Tokens hooks\n\nexport const useAllTokenData = (): {\n  [address: string]: { data?: TokenData }\n} => {\n  return useSelector((state: AppState) => state.info.tokens.byAddress)\n}\n\nexport const useUpdateTokenData = (): ((tokens: TokenData[]) => void) => {\n  const dispatch = useDispatch<AppDispatch>()\n  return useCallback(\n    (tokens: TokenData[]) => {\n      dispatch(updateTokenData({ tokens }))\n    },\n    [dispatch],\n  )\n}\n\nexport const useAddTokenKeys = (): ((addresses: string[]) => void) => {\n  const dispatch = useDispatch<AppDispatch>()\n  return useCallback((tokenAddresses: string[]) => dispatch(addTokenKeys({ tokenAddresses })), [dispatch])\n}\n\nexport const useTokenDatas = (addresses?: string[]): TokenData[] | undefined => {\n  const allTokenData = useAllTokenData()\n  const addNewTokenKeys = useAddTokenKeys()\n\n  // if token not tracked yet track it\n  addresses?.forEach((a) => {\n    if (!allTokenData[a]) {\n      addNewTokenKeys([a])\n    }\n  })\n\n  const tokensWithData = useMemo(() => {\n    if (!addresses) {\n      return undefined\n    }\n    return addresses\n      .map((a) => {\n        return allTokenData[a]?.data\n      })\n      .filter((token) => token)\n  }, [addresses, allTokenData])\n\n  return tokensWithData\n}\n\nexport const useTokenData = (address: string | undefined): TokenData | undefined => {\n  const allTokenData = useAllTokenData()\n  const addNewTokenKeys = useAddTokenKeys()\n\n  if (!address || !isAddress(address)) {\n    return undefined\n  }\n\n  // if token not tracked yet track it\n  if (!allTokenData[address]) {\n    addNewTokenKeys([address])\n  }\n\n  return allTokenData[address]?.data\n}\n\nexport const usePoolsForToken = (address: string): string[] | undefined => {\n  const dispatch = useDispatch<AppDispatch>()\n  const token = useSelector((state: AppState) => state.info.tokens.byAddress[address])\n  const poolsForToken = token.poolAddresses\n  const [error, setError] = useState(false)\n\n  useEffect(() => {\n    const fetch = async () => {\n      const { error: fetchError, addresses } = await fetchPoolsForToken(address)\n      if (!fetchError && addresses) {\n        dispatch(addTokenPoolAddresses({ tokenAddress: address, poolAddresses: addresses }))\n      }\n      if (fetchError) {\n        setError(fetchError)\n      }\n    }\n    if (!poolsForToken && !error) {\n      fetch()\n    }\n  }, [address, dispatch, error, poolsForToken])\n\n  return poolsForToken\n}\n\nexport const useTokenChartData = (address: string): ChartEntry[] | undefined => {\n  const dispatch = useDispatch<AppDispatch>()\n  const token = useSelector((state: AppState) => state.info.tokens.byAddress[address])\n  const { chartData } = token\n  const [error, setError] = useState(false)\n\n  useEffect(() => {\n    const fetch = async () => {\n      const { error: fetchError, data } = await fetchTokenChartData(address)\n      if (!fetchError && data) {\n        dispatch(updateTokenChartData({ tokenAddress: address, chartData: data }))\n      }\n      if (fetchError) {\n        setError(fetchError)\n      }\n    }\n    if (!chartData && !error) {\n      fetch()\n    }\n  }, [address, dispatch, error, chartData])\n\n  return chartData\n}\n\nexport const useTokenPriceData = (\n  address: string,\n  interval: number,\n  timeWindow: Duration,\n): PriceChartEntry[] | undefined => {\n  const dispatch = useDispatch<AppDispatch>()\n  const token = useSelector((state: AppState) => state.info.tokens.byAddress[address])\n  const priceData = token.priceData[interval]\n  const [error, setError] = useState(false)\n\n  // construct timestamps and check if we need to fetch more data\n  const oldestTimestampFetched = token.priceData.oldestFetchedTimestamp\n  const utcCurrentTime = getUnixTime(new Date()) * 1000\n  const startTimestamp = getUnixTime(startOfHour(sub(utcCurrentTime, timeWindow)))\n\n  useEffect(() => {\n    const fetch = async () => {\n      const { data, error: fetchingError } = await fetchTokenPriceData(address, interval, startTimestamp)\n      if (data) {\n        dispatch(\n          updateTokenPriceData({\n            tokenAddress: address,\n            secondsInterval: interval,\n            priceData: data,\n            oldestFetchedTimestamp: startTimestamp,\n          }),\n        )\n      }\n      if (fetchingError) {\n        setError(true)\n      }\n    }\n    if (!priceData && !error) {\n      fetch()\n    }\n  }, [address, dispatch, error, interval, oldestTimestampFetched, priceData, startTimestamp, timeWindow])\n\n  return priceData\n}\n\nexport const useTokenTransactions = (address: string): Transaction[] | undefined => {\n  const dispatch = useDispatch<AppDispatch>()\n  const token = useSelector((state: AppState) => state.info.tokens.byAddress[address])\n  const { transactions } = token\n  const [error, setError] = useState(false)\n\n  useEffect(() => {\n    const fetch = async () => {\n      const { error: fetchError, data } = await fetchTokenTransactions(address)\n      if (fetchError) {\n        setError(true)\n      } else if (data) {\n        dispatch(updateTokenTransactions({ tokenAddress: address, transactions: data }))\n      }\n    }\n    if (!transactions && !error) {\n      fetch()\n    }\n  }, [address, dispatch, error, transactions])\n\n  return transactions\n}\n"]},"metadata":{},"sourceType":"module"}