{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import{useWeb3React}from'@web3-react/core';import{AuctionStatus}from'config/constants/types';import{useFarmAuctionContract}from'hooks/useContract';import{processAuctionData,sortAuctionBidders}from'../helpers';var useCongratulateAuctionWinner=function useCongratulateAuctionWinner(currentAuction,bidders){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),wonAuction=_useState2[0],setWonAuction=_useState2[1];var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var farmAuctionContract=useFarmAuctionContract();useEffect(function(){var checkIfWonPreviousAuction=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(previousAuctionId){var auctionData,processedAuctionData,_yield$farmAuctionCon,_yield$farmAuctionCon2,auctionBidders,sortedBidders,leaderboardThreshold,winnerAddresses,accountBidderData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return farmAuctionContract.auctions(previousAuctionId);case 2:auctionData=_context.sent;_context.next=5;return processAuctionData(previousAuctionId,auctionData);case 5:processedAuctionData=_context.sent;_context.next=8;return farmAuctionContract.viewBidsPerAuction(previousAuctionId,0,500);case 8:_yield$farmAuctionCon=_context.sent;_yield$farmAuctionCon2=_slicedToArray(_yield$farmAuctionCon,1);auctionBidders=_yield$farmAuctionCon2[0];sortedBidders=sortAuctionBidders(auctionBidders);leaderboardThreshold=processedAuctionData.leaderboardThreshold;winnerAddresses=sortedBidders.filter(function(bidder){return leaderboardThreshold.lte(bidder.amount);}).map(function(bidder){return bidder.account;});if(winnerAddresses.includes(account)){accountBidderData=sortedBidders.find(function(bidder){return bidder.account===account;});setWonAuction({auction:processedAuctionData,bidderData:accountBidderData});}case 15:case\"end\":return _context.stop();}}},_callee);}));return function checkIfWonPreviousAuction(_x){return _ref.apply(this,arguments);};}();var winnerAddresses=bidders.filter(function(bidder){return currentAuction.leaderboardThreshold.lte(bidder.amount);}).map(function(bidder){return bidder.account;});var previousAuctionId=currentAuction.id-1;if(currentAuction.status===AuctionStatus.Closed&&winnerAddresses.includes(account)){var accountBidderData=bidders.find(function(bidder){return bidder.account===account;});setWonAuction({auction:currentAuction,bidderData:accountBidderData});}else if(previousAuctionId>0){checkIfWonPreviousAuction(previousAuctionId);}},[currentAuction,bidders,account,farmAuctionContract]);return wonAuction;};export default useCongratulateAuctionWinner;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/views/FarmAuction/hooks/useCongratulateAuctionWinner.tsx"],"names":["useState","useEffect","useWeb3React","AuctionStatus","useFarmAuctionContract","processAuctionData","sortAuctionBidders","useCongratulateAuctionWinner","currentAuction","bidders","wonAuction","setWonAuction","account","farmAuctionContract","checkIfWonPreviousAuction","previousAuctionId","auctions","auctionData","processedAuctionData","viewBidsPerAuction","auctionBidders","sortedBidders","leaderboardThreshold","winnerAddresses","filter","bidder","lte","amount","map","includes","accountBidderData","find","auction","bidderData","id","status","Closed"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'\nimport { useWeb3React } from '@web3-react/core'\nimport { Auction, AuctionStatus, Bidder } from 'config/constants/types'\nimport { useFarmAuctionContract } from 'hooks/useContract'\nimport { processAuctionData, sortAuctionBidders } from '../helpers'\n\ninterface WonAuction {\n  auction: Auction\n  bidderData: Bidder\n}\n\nconst useCongratulateAuctionWinner = (currentAuction: Auction, bidders: Bidder[]): WonAuction => {\n  const [wonAuction, setWonAuction] = useState<WonAuction | null>(null)\n\n  const { account } = useWeb3React()\n\n  const farmAuctionContract = useFarmAuctionContract()\n\n  useEffect(() => {\n    const checkIfWonPreviousAuction = async (previousAuctionId: number) => {\n      const auctionData = await farmAuctionContract.auctions(previousAuctionId)\n      const processedAuctionData = await processAuctionData(previousAuctionId, auctionData)\n      const [auctionBidders] = await farmAuctionContract.viewBidsPerAuction(previousAuctionId, 0, 500)\n      const sortedBidders = sortAuctionBidders(auctionBidders)\n      const { leaderboardThreshold } = processedAuctionData\n      const winnerAddresses = sortedBidders\n        .filter((bidder) => leaderboardThreshold.lte(bidder.amount))\n        .map((bidder) => bidder.account)\n      if (winnerAddresses.includes(account)) {\n        const accountBidderData = sortedBidders.find((bidder) => bidder.account === account)\n        setWonAuction({\n          auction: processedAuctionData,\n          bidderData: accountBidderData,\n        })\n      }\n    }\n\n    const winnerAddresses = bidders\n      .filter((bidder) => currentAuction.leaderboardThreshold.lte(bidder.amount))\n      .map((bidder) => bidder.account)\n    const previousAuctionId = currentAuction.id - 1\n    if (currentAuction.status === AuctionStatus.Closed && winnerAddresses.includes(account)) {\n      const accountBidderData = bidders.find((bidder) => bidder.account === account)\n      setWonAuction({\n        auction: currentAuction,\n        bidderData: accountBidderData,\n      })\n    } else if (previousAuctionId > 0) {\n      checkIfWonPreviousAuction(previousAuctionId)\n    }\n  }, [currentAuction, bidders, account, farmAuctionContract])\n\n  return wonAuction\n}\n\nexport default useCongratulateAuctionWinner\n"]},"metadata":{},"sourceType":"module"}