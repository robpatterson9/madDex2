{"ast":null,"code":"import { SNAPSHOT_HUB_API, SNAPSHOT_VOTING_API } from 'config/constants/endpoints';\nimport tokens from 'config/constants/tokens';\nimport { ProposalType } from 'state/types';\nimport { simpleRpcProvider } from 'utils/providers';\nimport { ADMINS, PANCAKE_SPACE, SNAPSHOT_VERSION } from './config';\nexport const isCoreProposal = proposal => {\n  return ADMINS.includes(proposal.author.toLowerCase());\n};\nexport const filterProposalsByType = (proposals, proposalType) => {\n  switch (proposalType) {\n    case ProposalType.COMMUNITY:\n      return proposals.filter(proposal => !isCoreProposal(proposal));\n\n    case ProposalType.CORE:\n      return proposals.filter(proposal => isCoreProposal(proposal));\n\n    case ProposalType.ALL:\n    default:\n      return proposals;\n  }\n};\nexport const filterProposalsByState = (proposals, state) => {\n  return proposals.filter(proposal => proposal.state === state);\n};\n\n/**\n * Generates metadata required by snapshot to validate payload\n */\nexport const generateMetaData = () => {\n  return {\n    plugins: {},\n    network: 56,\n    strategies: [{\n      name: 'cake',\n      params: {\n        symbol: 'CAKE',\n        address: tokens.cake.address,\n        decimals: 18\n      }\n    }]\n  };\n};\n/**\n * Returns data that is required on all snapshot payloads\n */\n\nexport const generatePayloadData = () => {\n  return {\n    version: SNAPSHOT_VERSION,\n    timestamp: (Date.now() / 1e3).toFixed(),\n    space: PANCAKE_SPACE\n  };\n};\n/**\n * General function to send commands to the snapshot api\n */\n\nexport const sendSnapshotData = async message => {\n  const response = await fetch(SNAPSHOT_HUB_API, {\n    method: 'post',\n    headers: {\n      Accept: 'application/json',\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(message)\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error === null || error === void 0 ? void 0 : error.error_description);\n  }\n\n  const data = await response.json();\n  return data;\n};\nexport const getVotingPower = async (account, poolAddresses, block) => {\n  const blockNumber = block || (await simpleRpcProvider.getBlockNumber());\n  const response = await fetch(`${SNAPSHOT_VOTING_API}/power`, {\n    method: 'post',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      address: account,\n      block: blockNumber,\n      poolAddresses\n    })\n  });\n  const data = await response.json();\n  return data.data;\n};\nexport const calculateVoteResults = votes => {\n  return votes.reduce((accum, vote) => {\n    const choiceText = vote.proposal.choices[vote.choice - 1];\n    return { ...accum,\n      [choiceText]: accum[choiceText] ? [...accum[choiceText], vote] : [vote]\n    };\n  }, {});\n};\nexport const getTotalFromVotes = votes => {\n  return votes.reduce((accum, vote) => {\n    var _vote$metadata;\n\n    const power = parseFloat((_vote$metadata = vote.metadata) === null || _vote$metadata === void 0 ? void 0 : _vote$metadata.votingPower);\n    return accum + power;\n  }, 0);\n};","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/views/Voting/helpers.ts"],"names":["SNAPSHOT_HUB_API","SNAPSHOT_VOTING_API","tokens","ProposalType","simpleRpcProvider","ADMINS","PANCAKE_SPACE","SNAPSHOT_VERSION","isCoreProposal","proposal","includes","author","toLowerCase","filterProposalsByType","proposals","proposalType","COMMUNITY","filter","CORE","ALL","filterProposalsByState","state","generateMetaData","plugins","network","strategies","name","params","symbol","address","cake","decimals","generatePayloadData","version","timestamp","Date","now","toFixed","space","sendSnapshotData","message","response","fetch","method","headers","Accept","body","JSON","stringify","ok","error","json","Error","error_description","data","getVotingPower","account","poolAddresses","block","blockNumber","getBlockNumber","calculateVoteResults","votes","reduce","accum","vote","choiceText","choices","choice","getTotalFromVotes","power","parseFloat","metadata","votingPower"],"mappings":"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","sourcesContent":["import { SNAPSHOT_HUB_API, SNAPSHOT_VOTING_API } from 'config/constants/endpoints'\nimport tokens from 'config/constants/tokens'\nimport { Proposal, ProposalState, ProposalType, Vote } from 'state/types'\nimport { simpleRpcProvider } from 'utils/providers'\nimport { ADMINS, PANCAKE_SPACE, SNAPSHOT_VERSION } from './config'\n\nexport const isCoreProposal = (proposal: Proposal) => {\n  return ADMINS.includes(proposal.author.toLowerCase())\n}\n\nexport const filterProposalsByType = (proposals: Proposal[], proposalType: ProposalType) => {\n  switch (proposalType) {\n    case ProposalType.COMMUNITY:\n      return proposals.filter((proposal) => !isCoreProposal(proposal))\n    case ProposalType.CORE:\n      return proposals.filter((proposal) => isCoreProposal(proposal))\n    case ProposalType.ALL:\n    default:\n      return proposals\n  }\n}\n\nexport const filterProposalsByState = (proposals: Proposal[], state: ProposalState) => {\n  return proposals.filter((proposal) => proposal.state === state)\n}\n\nexport interface Message {\n  address: string\n  msg: string\n  sig: string\n}\n\n/**\n * Generates metadata required by snapshot to validate payload\n */\nexport const generateMetaData = () => {\n  return {\n    plugins: {},\n    network: 56,\n    strategies: [{ name: 'cake', params: { symbol: 'CAKE', address: tokens.cake.address, decimals: 18 } }],\n  }\n}\n\n/**\n * Returns data that is required on all snapshot payloads\n */\nexport const generatePayloadData = () => {\n  return {\n    version: SNAPSHOT_VERSION,\n    timestamp: (Date.now() / 1e3).toFixed(),\n    space: PANCAKE_SPACE,\n  }\n}\n\n/**\n * General function to send commands to the snapshot api\n */\nexport const sendSnapshotData = async (message: Message) => {\n  const response = await fetch(SNAPSHOT_HUB_API, {\n    method: 'post',\n    headers: {\n      Accept: 'application/json',\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify(message),\n  })\n\n  if (!response.ok) {\n    const error = await response.json()\n    throw new Error(error?.error_description)\n  }\n\n  const data = await response.json()\n  return data\n}\n\nexport const getVotingPower = async (account: string, poolAddresses: string[], block?: number) => {\n  const blockNumber = block || (await simpleRpcProvider.getBlockNumber())\n  const response = await fetch(`${SNAPSHOT_VOTING_API}/power`, {\n    method: 'post',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      address: account,\n      block: blockNumber,\n      poolAddresses,\n    }),\n  })\n  const data = await response.json()\n  return data.data\n}\n\nexport const calculateVoteResults = (votes: Vote[]): { [key: string]: Vote[] } => {\n  return votes.reduce((accum, vote) => {\n    const choiceText = vote.proposal.choices[vote.choice - 1]\n\n    return {\n      ...accum,\n      [choiceText]: accum[choiceText] ? [...accum[choiceText], vote] : [vote],\n    }\n  }, {})\n}\n\nexport const getTotalFromVotes = (votes: Vote[]) => {\n  return votes.reduce((accum, vote) => {\n    const power = parseFloat(vote.metadata?.votingPower)\n    return accum + power\n  }, 0)\n}\n"]},"metadata":{},"sourceType":"module"}