{"ast":null,"code":"import _defineProperty from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{lazy,useEffect,useState,useMemo}from'react';import{AutoRenewIcon,Box,Breadcrumbs,Button,Card,CardBody,CardHeader,Flex,Heading,Input,LinkExternal,Text,useModal}from'@pancakeswap/uikit';import{useHistory}from'react-router';import{Link}from'react-router-dom';import{useWeb3React}from'@web3-react/core';import times from'lodash/times';import isEmpty from'lodash/isEmpty';import{useInitialBlock}from'state/block/hooks';import{SnapshotCommand}from'state/types';import useToast from'hooks/useToast';import useWeb3Provider from'hooks/useActiveWeb3React';import{getBscScanLink}from'utils';import truncateHash from'utils/truncateHash';import{signMessage}from'utils/web3React';import{useTranslation}from'contexts/Localization';import Container from'components/Layout/Container';import{DatePicker,TimePicker}from'components/DatePicker';import ConnectWalletButton from'components/ConnectWalletButton';import ReactMarkdown from'components/ReactMarkdown';import{PageMeta}from'components/Layout/Page';import{sendSnapshotData,generateMetaData,generatePayloadData}from'../helpers';import Layout from'../components/Layout';import{FormErrors,Label,SecondaryLabel}from'./styles';import Choices,{makeChoice,MINIMUM_CHOICES}from'./Choices';import{combineDateAndTime,getFormErrors}from'./helpers';import{ADMINS,VOTE_THRESHOLD}from'../config';import VoteDetailsModal from'../components/VoteDetailsModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var EasyMde=/*#__PURE__*/lazy(function(){return import('components/EasyMde');});var CreateProposal=function CreateProposal(){var _useState=useState({name:'',body:'',choices:times(MINIMUM_CHOICES).map(makeChoice),startDate:null,startTime:null,endDate:null,endTime:null,snapshot:0}),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isLoading=_useState4[0],setIsLoading=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),fieldsState=_useState6[0],setFieldsState=_useState6[1];var _useTranslation=useTranslation(),t=_useTranslation.t;var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var initialBlock=useInitialBlock();var _useHistory=useHistory(),push=_useHistory.push;var _useWeb3Provider=useWeb3Provider(),library=_useWeb3Provider.library;var _useToast=useToast(),toastSuccess=_useToast.toastSuccess,toastError=_useToast.toastError;var _useModal=useModal(/*#__PURE__*/_jsx(VoteDetailsModal,{block:state.snapshot})),_useModal2=_slicedToArray(_useModal,1),onPresentVoteDetailsModal=_useModal2[0];var name=state.name,body=state.body,choices=state.choices,startDate=state.startDate,startTime=state.startTime,endDate=state.endDate,endTime=state.endTime,snapshot=state.snapshot;var formErrors=getFormErrors(state,t);var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(evt){var proposal,sig,msg,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:evt.preventDefault();_context.prev=1;setIsLoading(true);proposal=JSON.stringify(_objectSpread(_objectSpread({},generatePayloadData()),{},{type:SnapshotCommand.PROPOSAL,payload:{name:name,body:body,snapshot:snapshot,start:combineDateAndTime(startDate,startTime),end:combineDateAndTime(endDate,endTime),choices:choices.filter(function(choice){return choice.value;}).map(function(choice){return choice.value;}),metadata:generateMetaData(),type:'single-choice'}}));_context.next=6;return signMessage(library,account,proposal);case 6:sig=_context.sent;if(!sig){_context.next=16;break;}msg={address:account,msg:proposal,sig:sig};// Save proposal to snapshot\n_context.next=11;return sendSnapshotData(msg);case 11:data=_context.sent;// Redirect user to newly created proposal page\npush(\"/voting/proposal/\".concat(data.ipfsHash));toastSuccess(t('Proposal created!'));_context.next=17;break;case 16:toastError(t('Error'),t('Unable to sign payload'));case 17:_context.next=24;break;case 19:_context.prev=19;_context.t0=_context[\"catch\"](1);toastError(t('Error'),(_context.t0===null||_context.t0===void 0?void 0:_context.t0.message)||(_context.t0===null||_context.t0===void 0?void 0:_context.t0.error));console.error(_context.t0);setIsLoading(false);case 24:case\"end\":return _context.stop();}}},_callee,null,[[1,19]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();var updateValue=function updateValue(key,value){setState(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},key,value));});// Keep track of what fields the user has attempted to edit\nsetFieldsState(function(prevFieldsState){return _objectSpread(_objectSpread({},prevFieldsState),{},_defineProperty({},key,true));});};var handleChange=function handleChange(evt){var _evt$currentTarget=evt.currentTarget,inputName=_evt$currentTarget.name,value=_evt$currentTarget.value;updateValue(inputName,value);};var handleEasyMdeChange=function handleEasyMdeChange(value){updateValue('body',value);};var handleChoiceChange=function handleChoiceChange(newChoices){updateValue('choices',newChoices);};var handleDateChange=function handleDateChange(key){return function(value){updateValue(key,value);};};var options=useMemo(function(){return{hideIcons:ADMINS.includes(account.toLowerCase())?[]:['guide','fullscreen','preview','side-by-side','image']};},[account]);useEffect(function(){if(initialBlock>0){setState(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{snapshot:initialBlock});});}},[initialBlock,setState]);return/*#__PURE__*/_jsxs(Container,{py:\"40px\",children:[/*#__PURE__*/_jsx(PageMeta,{}),/*#__PURE__*/_jsx(Box,{mb:\"48px\",children:/*#__PURE__*/_jsxs(Breadcrumbs,{children:[/*#__PURE__*/_jsx(Link,{to:\"/\",children:t('Home')}),/*#__PURE__*/_jsx(Link,{to:\"/voting\",children:t('Voting')}),/*#__PURE__*/_jsx(Text,{children:t('Make a Proposal')})]})}),/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit,children:/*#__PURE__*/_jsxs(Layout,{children:[/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsxs(Box,{mb:\"24px\",children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"name\",children:t('Title')}),/*#__PURE__*/_jsx(Input,{id:\"name\",name:\"name\",value:name,scale:\"lg\",onChange:handleChange,required:true}),formErrors.name&&fieldsState.name&&/*#__PURE__*/_jsx(FormErrors,{errors:formErrors.name})]}),/*#__PURE__*/_jsxs(Box,{mb:\"24px\",children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"body\",children:t('Content')}),/*#__PURE__*/_jsx(Text,{color:\"textSubtle\",mb:\"8px\",children:t('Tip: write in Markdown!')}),/*#__PURE__*/_jsx(EasyMde,{id:\"body\",name:\"body\",onTextChange:handleEasyMdeChange,value:body,options:options,required:true}),formErrors.body&&fieldsState.body&&/*#__PURE__*/_jsx(FormErrors,{errors:formErrors.body})]}),body&&/*#__PURE__*/_jsx(Box,{mb:\"24px\",children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsx(Heading,{as:\"h3\",scale:\"md\",children:t('Preview')})}),/*#__PURE__*/_jsx(CardBody,{p:\"0\",px:\"24px\",children:/*#__PURE__*/_jsx(ReactMarkdown,{children:body})})]})}),/*#__PURE__*/_jsx(Choices,{choices:choices,onChange:handleChoiceChange}),formErrors.choices&&fieldsState.choices&&/*#__PURE__*/_jsx(FormErrors,{errors:formErrors.choices})]}),/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsx(Heading,{as:\"h3\",scale:\"md\",children:t('Actions')})}),/*#__PURE__*/_jsxs(CardBody,{children:[/*#__PURE__*/_jsxs(Box,{mb:\"24px\",children:[/*#__PURE__*/_jsx(SecondaryLabel,{children:t('Start Date')}),/*#__PURE__*/_jsx(DatePicker,{name:\"startDate\",onChange:handleDateChange('startDate'),selected:startDate,placeholderText:\"YYYY/MM/DD\"}),formErrors.startDate&&fieldsState.startDate&&/*#__PURE__*/_jsx(FormErrors,{errors:formErrors.startDate})]}),/*#__PURE__*/_jsxs(Box,{mb:\"24px\",children:[/*#__PURE__*/_jsx(SecondaryLabel,{children:t('Start Time')}),/*#__PURE__*/_jsx(TimePicker,{name:\"startTime\",onChange:handleDateChange('startTime'),selected:startTime,placeholderText:\"00:00\"}),formErrors.startTime&&fieldsState.startTime&&/*#__PURE__*/_jsx(FormErrors,{errors:formErrors.startTime})]}),/*#__PURE__*/_jsxs(Box,{mb:\"24px\",children:[/*#__PURE__*/_jsx(SecondaryLabel,{children:t('End Date')}),/*#__PURE__*/_jsx(DatePicker,{name:\"endDate\",onChange:handleDateChange('endDate'),selected:endDate,placeholderText:\"YYYY/MM/DD\"}),formErrors.endDate&&fieldsState.endDate&&/*#__PURE__*/_jsx(FormErrors,{errors:formErrors.endDate})]}),/*#__PURE__*/_jsxs(Box,{mb:\"24px\",children:[/*#__PURE__*/_jsx(SecondaryLabel,{children:t('End Time')}),/*#__PURE__*/_jsx(TimePicker,{name:\"endTime\",onChange:handleDateChange('endTime'),selected:endTime,placeholderText:\"00:00\"}),formErrors.endTime&&fieldsState.endTime&&/*#__PURE__*/_jsx(FormErrors,{errors:formErrors.endTime})]}),account&&/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",mb:\"8px\",children:[/*#__PURE__*/_jsx(Text,{color:\"textSubtle\",mr:\"16px\",children:t('Creator')}),/*#__PURE__*/_jsx(LinkExternal,{href:getBscScanLink(account,'address'),children:truncateHash(account)})]}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",mb:\"16px\",children:[/*#__PURE__*/_jsx(Text,{color:\"textSubtle\",mr:\"16px\",children:t('Snapshot')}),/*#__PURE__*/_jsx(LinkExternal,{href:getBscScanLink(snapshot,'block'),children:snapshot})]}),account?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{type:\"submit\",width:\"100%\",isLoading:isLoading,endIcon:isLoading?/*#__PURE__*/_jsx(AutoRenewIcon,{spin:true,color:\"currentColor\"}):null,disabled:!isEmpty(formErrors),mb:\"16px\",children:t('Publish')}),/*#__PURE__*/_jsxs(Text,{color:\"failure\",as:\"p\",mb:\"4px\",children:[t('You need at least %count% voting power to publish a proposal.',{count:VOTE_THRESHOLD}),' ']}),/*#__PURE__*/_jsx(Button,{scale:\"sm\",type:\"button\",variant:\"text\",onClick:onPresentVoteDetailsModal,p:0,children:t('Check voting power')})]}):/*#__PURE__*/_jsx(ConnectWalletButton,{width:\"100%\",type:\"button\"})]})]})})]})})]});};export default CreateProposal;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/views/Voting/CreateProposal/index.tsx"],"names":["React","lazy","useEffect","useState","useMemo","AutoRenewIcon","Box","Breadcrumbs","Button","Card","CardBody","CardHeader","Flex","Heading","Input","LinkExternal","Text","useModal","useHistory","Link","useWeb3React","times","isEmpty","useInitialBlock","SnapshotCommand","useToast","useWeb3Provider","getBscScanLink","truncateHash","signMessage","useTranslation","Container","DatePicker","TimePicker","ConnectWalletButton","ReactMarkdown","PageMeta","sendSnapshotData","generateMetaData","generatePayloadData","Layout","FormErrors","Label","SecondaryLabel","Choices","makeChoice","MINIMUM_CHOICES","combineDateAndTime","getFormErrors","ADMINS","VOTE_THRESHOLD","VoteDetailsModal","EasyMde","CreateProposal","name","body","choices","map","startDate","startTime","endDate","endTime","snapshot","state","setState","isLoading","setIsLoading","fieldsState","setFieldsState","t","account","initialBlock","push","library","toastSuccess","toastError","onPresentVoteDetailsModal","formErrors","handleSubmit","evt","preventDefault","proposal","JSON","stringify","type","PROPOSAL","payload","start","end","filter","choice","value","metadata","sig","msg","address","data","ipfsHash","message","error","console","updateValue","key","prevState","prevFieldsState","handleChange","currentTarget","inputName","handleEasyMdeChange","handleChoiceChange","newChoices","handleDateChange","options","hideIcons","includes","toLowerCase","count"],"mappings":"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","sourcesContent":["import React, { ChangeEvent, FormEvent, lazy, useEffect, useState, useMemo } from 'react'\nimport {\n  AutoRenewIcon,\n  Box,\n  Breadcrumbs,\n  Button,\n  Card,\n  CardBody,\n  CardHeader,\n  Flex,\n  Heading,\n  Input,\n  LinkExternal,\n  Text,\n  useModal,\n} from '@pancakeswap/uikit'\nimport { useHistory } from 'react-router'\nimport { Link } from 'react-router-dom'\nimport { useWeb3React } from '@web3-react/core'\nimport times from 'lodash/times'\nimport isEmpty from 'lodash/isEmpty'\nimport { useInitialBlock } from 'state/block/hooks'\nimport { SnapshotCommand } from 'state/types'\nimport useToast from 'hooks/useToast'\nimport useWeb3Provider from 'hooks/useActiveWeb3React'\nimport { getBscScanLink } from 'utils'\nimport truncateHash from 'utils/truncateHash'\nimport { signMessage } from 'utils/web3React'\nimport { useTranslation } from 'contexts/Localization'\nimport Container from 'components/Layout/Container'\nimport { DatePicker, TimePicker } from 'components/DatePicker'\nimport ConnectWalletButton from 'components/ConnectWalletButton'\nimport ReactMarkdown from 'components/ReactMarkdown'\nimport { PageMeta } from 'components/Layout/Page'\nimport { sendSnapshotData, Message, generateMetaData, generatePayloadData } from '../helpers'\nimport Layout from '../components/Layout'\nimport { FormErrors, Label, SecondaryLabel } from './styles'\nimport Choices, { Choice, makeChoice, MINIMUM_CHOICES } from './Choices'\nimport { combineDateAndTime, getFormErrors } from './helpers'\nimport { FormState } from './types'\nimport { ADMINS, VOTE_THRESHOLD } from '../config'\nimport VoteDetailsModal from '../components/VoteDetailsModal'\n\nconst EasyMde = lazy(() => import('components/EasyMde'))\n\nconst CreateProposal = () => {\n  const [state, setState] = useState<FormState>({\n    name: '',\n    body: '',\n    choices: times(MINIMUM_CHOICES).map(makeChoice),\n    startDate: null,\n    startTime: null,\n    endDate: null,\n    endTime: null,\n    snapshot: 0,\n  })\n  const [isLoading, setIsLoading] = useState(false)\n  const [fieldsState, setFieldsState] = useState<{ [key: string]: boolean }>({})\n  const { t } = useTranslation()\n  const { account } = useWeb3React()\n  const initialBlock = useInitialBlock()\n  const { push } = useHistory()\n  const { library } = useWeb3Provider()\n  const { toastSuccess, toastError } = useToast()\n  const [onPresentVoteDetailsModal] = useModal(<VoteDetailsModal block={state.snapshot} />)\n  const { name, body, choices, startDate, startTime, endDate, endTime, snapshot } = state\n  const formErrors = getFormErrors(state, t)\n\n  const handleSubmit = async (evt: FormEvent<HTMLFormElement>) => {\n    evt.preventDefault()\n\n    try {\n      setIsLoading(true)\n      const proposal = JSON.stringify({\n        ...generatePayloadData(),\n        type: SnapshotCommand.PROPOSAL,\n        payload: {\n          name,\n          body,\n          snapshot,\n          start: combineDateAndTime(startDate, startTime),\n          end: combineDateAndTime(endDate, endTime),\n          choices: choices\n            .filter((choice) => choice.value)\n            .map((choice) => {\n              return choice.value\n            }),\n          metadata: generateMetaData(),\n          type: 'single-choice',\n        },\n      })\n\n      const sig = await signMessage(library, account, proposal)\n\n      if (sig) {\n        const msg: Message = { address: account, msg: proposal, sig }\n\n        // Save proposal to snapshot\n        const data = await sendSnapshotData(msg)\n\n        // Redirect user to newly created proposal page\n        push(`/voting/proposal/${data.ipfsHash}`)\n\n        toastSuccess(t('Proposal created!'))\n      } else {\n        toastError(t('Error'), t('Unable to sign payload'))\n      }\n    } catch (error) {\n      toastError(t('Error'), error?.message || error?.error)\n      console.error(error)\n      setIsLoading(false)\n    }\n  }\n\n  const updateValue = (key: string, value: string | Choice[] | Date) => {\n    setState((prevState) => ({\n      ...prevState,\n      [key]: value,\n    }))\n\n    // Keep track of what fields the user has attempted to edit\n    setFieldsState((prevFieldsState) => ({\n      ...prevFieldsState,\n      [key]: true,\n    }))\n  }\n\n  const handleChange = (evt: ChangeEvent<HTMLInputElement>) => {\n    const { name: inputName, value } = evt.currentTarget\n    updateValue(inputName, value)\n  }\n\n  const handleEasyMdeChange = (value: string) => {\n    updateValue('body', value)\n  }\n\n  const handleChoiceChange = (newChoices: Choice[]) => {\n    updateValue('choices', newChoices)\n  }\n\n  const handleDateChange = (key: string) => (value: Date) => {\n    updateValue(key, value)\n  }\n\n  const options = useMemo(\n    () => ({\n      hideIcons: ADMINS.includes(account.toLowerCase())\n        ? []\n        : ['guide', 'fullscreen', 'preview', 'side-by-side', 'image'],\n    }),\n    [account],\n  )\n\n  useEffect(() => {\n    if (initialBlock > 0) {\n      setState((prevState) => ({\n        ...prevState,\n        snapshot: initialBlock,\n      }))\n    }\n  }, [initialBlock, setState])\n\n  return (\n    <Container py=\"40px\">\n      <PageMeta />\n      <Box mb=\"48px\">\n        <Breadcrumbs>\n          <Link to=\"/\">{t('Home')}</Link>\n          <Link to=\"/voting\">{t('Voting')}</Link>\n          <Text>{t('Make a Proposal')}</Text>\n        </Breadcrumbs>\n      </Box>\n      <form onSubmit={handleSubmit}>\n        <Layout>\n          <Box>\n            <Box mb=\"24px\">\n              <Label htmlFor=\"name\">{t('Title')}</Label>\n              <Input id=\"name\" name=\"name\" value={name} scale=\"lg\" onChange={handleChange} required />\n              {formErrors.name && fieldsState.name && <FormErrors errors={formErrors.name} />}\n            </Box>\n            <Box mb=\"24px\">\n              <Label htmlFor=\"body\">{t('Content')}</Label>\n              <Text color=\"textSubtle\" mb=\"8px\">\n                {t('Tip: write in Markdown!')}\n              </Text>\n              <EasyMde\n                id=\"body\"\n                name=\"body\"\n                onTextChange={handleEasyMdeChange}\n                value={body}\n                options={options}\n                required\n              />\n              {formErrors.body && fieldsState.body && <FormErrors errors={formErrors.body} />}\n            </Box>\n            {body && (\n              <Box mb=\"24px\">\n                <Card>\n                  <CardHeader>\n                    <Heading as=\"h3\" scale=\"md\">\n                      {t('Preview')}\n                    </Heading>\n                  </CardHeader>\n                  <CardBody p=\"0\" px=\"24px\">\n                    <ReactMarkdown>{body}</ReactMarkdown>\n                  </CardBody>\n                </Card>\n              </Box>\n            )}\n            <Choices choices={choices} onChange={handleChoiceChange} />\n            {formErrors.choices && fieldsState.choices && <FormErrors errors={formErrors.choices} />}\n          </Box>\n          <Box>\n            <Card>\n              <CardHeader>\n                <Heading as=\"h3\" scale=\"md\">\n                  {t('Actions')}\n                </Heading>\n              </CardHeader>\n              <CardBody>\n                <Box mb=\"24px\">\n                  <SecondaryLabel>{t('Start Date')}</SecondaryLabel>\n                  <DatePicker\n                    name=\"startDate\"\n                    onChange={handleDateChange('startDate')}\n                    selected={startDate}\n                    placeholderText=\"YYYY/MM/DD\"\n                  />\n                  {formErrors.startDate && fieldsState.startDate && <FormErrors errors={formErrors.startDate} />}\n                </Box>\n                <Box mb=\"24px\">\n                  <SecondaryLabel>{t('Start Time')}</SecondaryLabel>\n                  <TimePicker\n                    name=\"startTime\"\n                    onChange={handleDateChange('startTime')}\n                    selected={startTime}\n                    placeholderText=\"00:00\"\n                  />\n                  {formErrors.startTime && fieldsState.startTime && <FormErrors errors={formErrors.startTime} />}\n                </Box>\n                <Box mb=\"24px\">\n                  <SecondaryLabel>{t('End Date')}</SecondaryLabel>\n                  <DatePicker\n                    name=\"endDate\"\n                    onChange={handleDateChange('endDate')}\n                    selected={endDate}\n                    placeholderText=\"YYYY/MM/DD\"\n                  />\n                  {formErrors.endDate && fieldsState.endDate && <FormErrors errors={formErrors.endDate} />}\n                </Box>\n                <Box mb=\"24px\">\n                  <SecondaryLabel>{t('End Time')}</SecondaryLabel>\n                  <TimePicker\n                    name=\"endTime\"\n                    onChange={handleDateChange('endTime')}\n                    selected={endTime}\n                    placeholderText=\"00:00\"\n                  />\n                  {formErrors.endTime && fieldsState.endTime && <FormErrors errors={formErrors.endTime} />}\n                </Box>\n                {account && (\n                  <Flex alignItems=\"center\" mb=\"8px\">\n                    <Text color=\"textSubtle\" mr=\"16px\">\n                      {t('Creator')}\n                    </Text>\n                    <LinkExternal href={getBscScanLink(account, 'address')}>{truncateHash(account)}</LinkExternal>\n                  </Flex>\n                )}\n                <Flex alignItems=\"center\" mb=\"16px\">\n                  <Text color=\"textSubtle\" mr=\"16px\">\n                    {t('Snapshot')}\n                  </Text>\n                  <LinkExternal href={getBscScanLink(snapshot, 'block')}>{snapshot}</LinkExternal>\n                </Flex>\n                {account ? (\n                  <>\n                    <Button\n                      type=\"submit\"\n                      width=\"100%\"\n                      isLoading={isLoading}\n                      endIcon={isLoading ? <AutoRenewIcon spin color=\"currentColor\" /> : null}\n                      disabled={!isEmpty(formErrors)}\n                      mb=\"16px\"\n                    >\n                      {t('Publish')}\n                    </Button>\n                    <Text color=\"failure\" as=\"p\" mb=\"4px\">\n                      {t('You need at least %count% voting power to publish a proposal.', { count: VOTE_THRESHOLD })}{' '}\n                    </Text>\n                    <Button scale=\"sm\" type=\"button\" variant=\"text\" onClick={onPresentVoteDetailsModal} p={0}>\n                      {t('Check voting power')}\n                    </Button>\n                  </>\n                ) : (\n                  <ConnectWalletButton width=\"100%\" type=\"button\" />\n                )}\n              </CardBody>\n            </Card>\n          </Box>\n        </Layout>\n      </form>\n    </Container>\n  )\n}\n\nexport default CreateProposal\n"]},"metadata":{},"sourceType":"module"}