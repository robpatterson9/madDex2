{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import{useFarmAuctionContract}from'hooks/useContract';import{AUCTION_BIDDERS_TO_FETCH}from'config';import{processAuctionData,sortAuctionBidders}from'../helpers';var useAuctionHistory=function useAuctionHistory(auctionId){var _useState=useState({}),_useState2=_slicedToArray(_useState,2),auctionHistory=_useState2[0],setAuctionHistory=_useState2[1];var farmAuctionContract=useFarmAuctionContract();// Get past auction data\nuseEffect(function(){var fetchAuction=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var auctionData,processedAuctionData,_yield$farmAuctionCon,_yield$farmAuctionCon2,auctionBidders,sortedBidders;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return farmAuctionContract.auctions(auctionId);case 3:auctionData=_context.sent;_context.next=6;return processAuctionData(auctionId,auctionData);case 6:processedAuctionData=_context.sent;_context.next=9;return farmAuctionContract.viewBidsPerAuction(auctionId,0,AUCTION_BIDDERS_TO_FETCH);case 9:_yield$farmAuctionCon=_context.sent;_yield$farmAuctionCon2=_slicedToArray(_yield$farmAuctionCon,1);auctionBidders=_yield$farmAuctionCon2[0];sortedBidders=sortAuctionBidders(auctionBidders,processedAuctionData);setAuctionHistory(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},auctionId,{auction:processedAuctionData,bidders:sortedBidders}));});_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](0);console.error('Failed to fetch auction history',_context.t0);case 19:case\"end\":return _context.stop();}}},_callee,null,[[0,16]]);}));return function fetchAuction(){return _ref.apply(this,arguments);};}();if(!auctionHistory[auctionId]&&auctionId>0){fetchAuction();}},[farmAuctionContract,auctionHistory,auctionId]);return auctionHistory;};export default useAuctionHistory;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/views/FarmAuction/hooks/useAuctionHistory.tsx"],"names":["useState","useEffect","useFarmAuctionContract","AUCTION_BIDDERS_TO_FETCH","processAuctionData","sortAuctionBidders","useAuctionHistory","auctionId","auctionHistory","setAuctionHistory","farmAuctionContract","fetchAuction","auctions","auctionData","processedAuctionData","viewBidsPerAuction","auctionBidders","sortedBidders","prev","auction","bidders","console","error"],"mappings":"svBAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,OAASC,sBAAT,KAAuC,mBAAvC,CAEA,OAASC,wBAAT,KAAyC,QAAzC,CACA,OAASC,kBAAT,CAA6BC,kBAA7B,KAAuD,YAAvD,CASA,GAAMC,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACC,SAAD,CAAuB,CAC/C,cAA4CP,QAAQ,CAAoB,EAApB,CAApD,wCAAOQ,cAAP,eAAuBC,iBAAvB,eAEA,GAAMC,CAAAA,mBAAmB,CAAGR,sBAAsB,EAAlD,CAEA;AACAD,SAAS,CAAC,UAAM,CACd,GAAMU,CAAAA,YAAY,0FAAG,wRAESD,CAAAA,mBAAmB,CAACE,QAApB,CAA6BL,SAA7B,CAFT,QAEXM,WAFW,qCAGkBT,CAAAA,kBAAkB,CAACG,SAAD,CAAYM,WAAZ,CAHpC,QAGXC,oBAHW,qCAKcJ,CAAAA,mBAAmB,CAACK,kBAApB,CAAuCR,SAAvC,CAAkD,CAAlD,CAAqDJ,wBAArD,CALd,2GAKVa,cALU,2BAMXC,aANW,CAMKZ,kBAAkB,CAACW,cAAD,CAAiBF,oBAAjB,CANvB,CAOjBL,iBAAiB,CAAC,SAACS,IAAD,wCACbA,IADa,wBAEfX,SAFe,CAEH,CAAEY,OAAO,CAAEL,oBAAX,CAAiCM,OAAO,CAAEH,aAA1C,CAFG,IAAD,CAAjB,CAPiB,iFAYjBI,OAAO,CAACC,KAAR,CAAc,iCAAd,cAZiB,qEAAH,kBAAZX,CAAAA,YAAY,0CAAlB,CAeA,GAAI,CAACH,cAAc,CAACD,SAAD,CAAf,EAA8BA,SAAS,CAAG,CAA9C,CAAiD,CAC/CI,YAAY,GACb,CACF,CAnBQ,CAmBN,CAACD,mBAAD,CAAsBF,cAAtB,CAAsCD,SAAtC,CAnBM,CAAT,CAqBA,MAAOC,CAAAA,cAAP,CACD,CA5BD,CA8BA,cAAeF,CAAAA,iBAAf","sourcesContent":["import { useState, useEffect } from 'react'\nimport { useFarmAuctionContract } from 'hooks/useContract'\nimport { Auction, Bidder } from 'config/constants/types'\nimport { AUCTION_BIDDERS_TO_FETCH } from 'config'\nimport { processAuctionData, sortAuctionBidders } from '../helpers'\n\ninterface AuctionHistoryMap {\n  [key: number]: {\n    auction: Auction\n    bidders: Bidder[]\n  }\n}\n\nconst useAuctionHistory = (auctionId: number) => {\n  const [auctionHistory, setAuctionHistory] = useState<AuctionHistoryMap>({})\n\n  const farmAuctionContract = useFarmAuctionContract()\n\n  // Get past auction data\n  useEffect(() => {\n    const fetchAuction = async () => {\n      try {\n        const auctionData = await farmAuctionContract.auctions(auctionId)\n        const processedAuctionData = await processAuctionData(auctionId, auctionData)\n\n        const [auctionBidders] = await farmAuctionContract.viewBidsPerAuction(auctionId, 0, AUCTION_BIDDERS_TO_FETCH)\n        const sortedBidders = sortAuctionBidders(auctionBidders, processedAuctionData)\n        setAuctionHistory((prev) => ({\n          ...prev,\n          [auctionId]: { auction: processedAuctionData, bidders: sortedBidders },\n        }))\n      } catch (error) {\n        console.error('Failed to fetch auction history', error)\n      }\n    }\n    if (!auctionHistory[auctionId] && auctionId > 0) {\n      fetchAuction()\n    }\n  }, [farmAuctionContract, auctionHistory, auctionId])\n\n  return auctionHistory\n}\n\nexport default useAuctionHistory\n"]},"metadata":{},"sourceType":"module"}