{"ast":null,"code":"import _objectSpread from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6;import React,{useEffect,useCallback,useState,useMemo,useRef}from'react';import{Route,useRouteMatch,useLocation,NavLink}from'react-router-dom';import BigNumber from'bignumber.js';import{useWeb3React}from'@web3-react/core';import{Image,Heading,Toggle,Text,Flex}from'@pancakeswap/uikit';import{ChainId}from'@pancakeswap/sdk';import styled from'styled-components';import FlexLayout from'components/Layout/Flex';import Page from'components/Layout/Page';import{useFarms,usePollFarmsWithUserData,usePriceCakeBusd}from'state/farms/hooks';import useIntersectionObserver from'hooks/useIntersectionObserver';import{useTranslation}from'contexts/Localization';import{getBalanceNumber}from'utils/formatBalance';import{getFarmApr}from'utils/apr';import{orderBy}from'lodash';import isArchivedPid from'utils/farmHelpers';import{latinise}from'utils/latinise';import{useUserFarmStakedOnly,useUserFarmsViewMode}from'state/user/hooks';import{ViewMode}from'state/user/actions';import PageHeader from'components/PageHeader';import SearchInput from'components/SearchInput';import Select from'components/Select/Select';import Loading from'components/Loading';import FarmCard from'./components/FarmCard/FarmCard';import Table from'./components/FarmTable/FarmTable';import FarmTabButtons from'./components/FarmTabButtons';import ToggleView from'./components/ToggleView/ToggleView';import{DesktopColumnSchema}from'./components/types';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ControlContainer=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  display: flex;\\n  width: 100%;\\n  align-items: center;\\n  position: relative;\\n\\n  justify-content: space-between;\\n  flex-direction: column;\\n  margin-bottom: 32px;\\n\\n  \",\" {\\n    flex-direction: row;\\n    flex-wrap: wrap;\\n    padding: 16px 32px;\\n    margin-bottom: 0;\\n  }\\n\"])),function(_ref){var theme=_ref.theme;return theme.mediaQueries.sm;});var ToggleWrapper=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  margin-left: 10px;\\n\\n  \",\" {\\n    margin-left: 8px;\\n  }\\n\"])),Text);var LabelWrapper=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  > \",\" {\\n    font-size: 12px;\\n  }\\n\"])),Text);var FilterContainer=styled.div(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  width: 100%;\\n  padding: 8px 0px;\\n\\n  \",\" {\\n    width: auto;\\n    padding: 0;\\n  }\\n\"])),function(_ref2){var theme=_ref2.theme;return theme.mediaQueries.sm;});var ViewControls=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  flex-wrap: wrap;\\n  justify-content: space-between;\\n  display: flex;\\n  align-items: center;\\n  width: 100%;\\n\\n  > div {\\n    padding: 8px 0px;\\n  }\\n\\n  \",\" {\\n    justify-content: flex-start;\\n    width: auto;\\n\\n    > div {\\n      padding: 0;\\n    }\\n  }\\n\"])),function(_ref3){var theme=_ref3.theme;return theme.mediaQueries.sm;});var StyledImage=styled(Image)(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\\n  margin-left: auto;\\n  margin-right: auto;\\n  margin-top: 58px;\\n\"])));var NUMBER_OF_FARMS_VISIBLE=12;var getDisplayApr=function getDisplayApr(cakeRewardsApr,lpRewardsApr){if(cakeRewardsApr&&lpRewardsApr){return(cakeRewardsApr+lpRewardsApr).toLocaleString('en-US',{maximumFractionDigits:2});}if(cakeRewardsApr){return cakeRewardsApr.toLocaleString('en-US',{maximumFractionDigits:2});}return null;};var Farms=function Farms(){var _useRouteMatch=useRouteMatch(),path=_useRouteMatch.path;var _useLocation=useLocation(),pathname=_useLocation.pathname;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useFarms=useFarms(),farmsLP=_useFarms.data,userDataLoaded=_useFarms.userDataLoaded;var cakePrice=usePriceCakeBusd();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),query=_useState2[0],setQuery=_useState2[1];var _useUserFarmsViewMode=useUserFarmsViewMode(),_useUserFarmsViewMode2=_slicedToArray(_useUserFarmsViewMode,2),viewMode=_useUserFarmsViewMode2[0],setViewMode=_useUserFarmsViewMode2[1];var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var _useState3=useState('hot'),_useState4=_slicedToArray(_useState3,2),sortOption=_useState4[0],setSortOption=_useState4[1];var _useIntersectionObser=useIntersectionObserver(),observerRef=_useIntersectionObser.observerRef,isIntersecting=_useIntersectionObser.isIntersecting;var chosenFarmsLength=useRef(0);var isArchived=pathname.includes('archived');var isInactive=pathname.includes('history');var isActive=!isInactive&&!isArchived;usePollFarmsWithUserData(isArchived);// Users with no wallet connected should see 0 as Earned amount\n// Connected users should see loading indicator until first userData has loaded\nvar userDataReady=!account||!!account&&userDataLoaded;var _useUserFarmStakedOnl=useUserFarmStakedOnly(isActive),_useUserFarmStakedOnl2=_slicedToArray(_useUserFarmStakedOnl,2),stakedOnly=_useUserFarmStakedOnl2[0],setStakedOnly=_useUserFarmStakedOnl2[1];var activeFarms=farmsLP.filter(function(farm){return farm.pid!==0&&farm.multiplier!=='0X'&&!isArchivedPid(farm.pid);});var inactiveFarms=farmsLP.filter(function(farm){return farm.pid!==0&&farm.multiplier==='0X'&&!isArchivedPid(farm.pid);});var archivedFarms=farmsLP.filter(function(farm){return isArchivedPid(farm.pid);});var stakedOnlyFarms=activeFarms.filter(function(farm){return farm.userData&&new BigNumber(farm.userData.stakedBalance).isGreaterThan(0);});var stakedInactiveFarms=inactiveFarms.filter(function(farm){return farm.userData&&new BigNumber(farm.userData.stakedBalance).isGreaterThan(0);});var stakedArchivedFarms=archivedFarms.filter(function(farm){return farm.userData&&new BigNumber(farm.userData.stakedBalance).isGreaterThan(0);});var farmsList=useCallback(function(farmsToDisplay){var farmsToDisplayWithAPR=farmsToDisplay.map(function(farm){if(!farm.lpTotalInQuoteToken||!farm.quoteTokenPriceBusd){return farm;}var totalLiquidity=new BigNumber(farm.lpTotalInQuoteToken).times(farm.quoteTokenPriceBusd);var _ref4=isActive?getFarmApr(new BigNumber(farm.poolWeight),cakePrice,totalLiquidity,farm.lpAddresses[ChainId.MAINNET]):{cakeRewardsApr:0,lpRewardsApr:0},cakeRewardsApr=_ref4.cakeRewardsApr,lpRewardsApr=_ref4.lpRewardsApr;return _objectSpread(_objectSpread({},farm),{},{apr:cakeRewardsApr,lpRewardsApr:lpRewardsApr,liquidity:totalLiquidity});});if(query){var lowercaseQuery=latinise(query.toLowerCase());farmsToDisplayWithAPR=farmsToDisplayWithAPR.filter(function(farm){return latinise(farm.lpSymbol.toLowerCase()).includes(lowercaseQuery);});}return farmsToDisplayWithAPR;},[cakePrice,query,isActive]);var handleChangeQuery=function handleChangeQuery(event){setQuery(event.target.value);};var _useState5=useState(NUMBER_OF_FARMS_VISIBLE),_useState6=_slicedToArray(_useState5,2),numberOfFarmsVisible=_useState6[0],setNumberOfFarmsVisible=_useState6[1];var chosenFarmsMemoized=useMemo(function(){var chosenFarms=[];var sortFarms=function sortFarms(farms){switch(sortOption){case'apr':return orderBy(farms,function(farm){return farm.apr+farm.lpRewardsApr;},'desc');case'multiplier':return orderBy(farms,function(farm){return farm.multiplier?Number(farm.multiplier.slice(0,-1)):0;},'desc');case'earned':return orderBy(farms,function(farm){return farm.userData?Number(farm.userData.earnings):0;},'desc');case'liquidity':return orderBy(farms,function(farm){return Number(farm.liquidity);},'desc');default:return farms;}};if(isActive){chosenFarms=stakedOnly?farmsList(stakedOnlyFarms):farmsList(activeFarms);}if(isInactive){chosenFarms=stakedOnly?farmsList(stakedInactiveFarms):farmsList(inactiveFarms);}if(isArchived){chosenFarms=stakedOnly?farmsList(stakedArchivedFarms):farmsList(archivedFarms);}return sortFarms(chosenFarms).slice(0,numberOfFarmsVisible);},[sortOption,activeFarms,farmsList,inactiveFarms,archivedFarms,isActive,isInactive,isArchived,stakedArchivedFarms,stakedInactiveFarms,stakedOnly,stakedOnlyFarms,numberOfFarmsVisible]);chosenFarmsLength.current=chosenFarmsMemoized.length;useEffect(function(){if(isIntersecting){setNumberOfFarmsVisible(function(farmsCurrentlyVisible){if(farmsCurrentlyVisible<=chosenFarmsLength.current){return farmsCurrentlyVisible+NUMBER_OF_FARMS_VISIBLE;}return farmsCurrentlyVisible;});}},[isIntersecting]);var rowData=chosenFarmsMemoized.map(function(farm){var token=farm.token,quoteToken=farm.quoteToken;var tokenAddress=token.address;var quoteTokenAddress=quoteToken.address;var lpLabel=farm.lpSymbol&&farm.lpSymbol.split(' ')[0].toUpperCase().replace('PANCAKE','');var row={apr:{value:getDisplayApr(farm.apr,farm.lpRewardsApr),pid:farm.pid,multiplier:farm.multiplier,lpLabel:lpLabel,lpSymbol:farm.lpSymbol,tokenAddress:tokenAddress,quoteTokenAddress:quoteTokenAddress,cakePrice:cakePrice,originalValue:farm.apr},farm:{label:lpLabel,pid:farm.pid,token:farm.token,quoteToken:farm.quoteToken},earned:{earnings:getBalanceNumber(new BigNumber(farm.userData.earnings)),pid:farm.pid},liquidity:{liquidity:farm.liquidity},multiplier:{multiplier:farm.multiplier},details:farm};return row;});var renderContent=function renderContent(){if(viewMode===ViewMode.TABLE&&rowData.length){var columnSchema=DesktopColumnSchema;var columns=columnSchema.map(function(column){return{id:column.id,name:column.name,label:column.label,sort:function sort(a,b){switch(column.name){case'farm':return b.id-a.id;case'apr':if(a.original.apr.value&&b.original.apr.value){return Number(a.original.apr.value)-Number(b.original.apr.value);}return 0;case'earned':return a.original.earned.earnings-b.original.earned.earnings;default:return 1;}},sortable:column.sortable};});return/*#__PURE__*/_jsx(Table,{data:rowData,columns:columns,userDataReady:userDataReady});}return/*#__PURE__*/_jsxs(FlexLayout,{children:[/*#__PURE__*/_jsx(Route,{exact:true,path:\"\".concat(path),children:chosenFarmsMemoized.map(function(farm){return/*#__PURE__*/_jsx(FarmCard,{farm:farm,displayApr:getDisplayApr(farm.apr,farm.lpRewardsApr),cakePrice:cakePrice,account:account,removed:false},farm.pid);})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"\".concat(path,\"/history\"),children:chosenFarmsMemoized.map(function(farm){return/*#__PURE__*/_jsx(FarmCard,{farm:farm,displayApr:getDisplayApr(farm.apr,farm.lpRewardsApr),cakePrice:cakePrice,account:account,removed:true},farm.pid);})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"\".concat(path,\"/archived\"),children:chosenFarmsMemoized.map(function(farm){return/*#__PURE__*/_jsx(FarmCard,{farm:farm,displayApr:getDisplayApr(farm.apr,farm.lpRewardsApr),cakePrice:cakePrice,account:account,removed:true},farm.pid);})})]});};var handleSortOptionChange=function handleSortOptionChange(option){setSortOption(option.value);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(PageHeader,{children:[/*#__PURE__*/_jsx(Heading,{as:\"h1\",scale:\"xxl\",color:\"secondary\",mb:\"14px\",children:t('Farms')}),/*#__PURE__*/_jsx(Heading,{scale:\"lg\",color:\"text\",children:t('Stake LP tokens to earn.')}),/*#__PURE__*/_jsx(NavLink,{exact:true,activeClassName:\"active\",to:\"/farms/auction\",id:\"lottery-pot-banner\"})]}),/*#__PURE__*/_jsxs(Page,{children:[/*#__PURE__*/_jsxs(ControlContainer,{children:[/*#__PURE__*/_jsxs(ViewControls,{children:[/*#__PURE__*/_jsx(ToggleView,{viewMode:viewMode,onToggle:function onToggle(mode){return setViewMode(mode);}}),/*#__PURE__*/_jsxs(ToggleWrapper,{children:[/*#__PURE__*/_jsx(Toggle,{id:\"staked-only-farms\",checked:stakedOnly,onChange:function onChange(){return setStakedOnly(!stakedOnly);},scale:\"sm\"}),/*#__PURE__*/_jsxs(Text,{children:[\" \",t('Staked only')]})]}),/*#__PURE__*/_jsx(FarmTabButtons,{hasStakeInFinishedFarms:stakedInactiveFarms.length>0})]}),/*#__PURE__*/_jsxs(FilterContainer,{children:[/*#__PURE__*/_jsxs(LabelWrapper,{children:[/*#__PURE__*/_jsx(Text,{textTransform:\"uppercase\",children:t('Sort by')}),/*#__PURE__*/_jsx(Select,{options:[{label:t('Hot'),value:'hot'},{label:t('APR'),value:'apr'},{label:t('Multiplier'),value:'multiplier'},{label:t('Earned'),value:'earned'},{label:t('Liquidity'),value:'liquidity'}],onOptionChange:handleSortOptionChange})]}),/*#__PURE__*/_jsxs(LabelWrapper,{style:{marginLeft:16},children:[/*#__PURE__*/_jsx(Text,{textTransform:\"uppercase\",children:t('Search')}),/*#__PURE__*/_jsx(SearchInput,{onChange:handleChangeQuery,placeholder:\"Search Farms\"})]})]})]}),renderContent(),account&&!userDataLoaded&&stakedOnly&&/*#__PURE__*/_jsx(Flex,{justifyContent:\"center\",children:/*#__PURE__*/_jsx(Loading,{})}),/*#__PURE__*/_jsx(\"div\",{ref:observerRef}),/*#__PURE__*/_jsx(StyledImage,{src:\"/images/decorations/3dpan.png\",alt:\"Pancake illustration\",width:120,height:103})]})]});};export default Farms;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/views/Farms/Farms.tsx"],"names":["React","useEffect","useCallback","useState","useMemo","useRef","Route","useRouteMatch","useLocation","NavLink","BigNumber","useWeb3React","Image","Heading","Toggle","Text","Flex","ChainId","styled","FlexLayout","Page","useFarms","usePollFarmsWithUserData","usePriceCakeBusd","useIntersectionObserver","useTranslation","getBalanceNumber","getFarmApr","orderBy","isArchivedPid","latinise","useUserFarmStakedOnly","useUserFarmsViewMode","ViewMode","PageHeader","SearchInput","Select","Loading","FarmCard","Table","FarmTabButtons","ToggleView","DesktopColumnSchema","ControlContainer","div","theme","mediaQueries","sm","ToggleWrapper","LabelWrapper","FilterContainer","ViewControls","StyledImage","NUMBER_OF_FARMS_VISIBLE","getDisplayApr","cakeRewardsApr","lpRewardsApr","toLocaleString","maximumFractionDigits","Farms","path","pathname","t","farmsLP","data","userDataLoaded","cakePrice","query","setQuery","viewMode","setViewMode","account","sortOption","setSortOption","observerRef","isIntersecting","chosenFarmsLength","isArchived","includes","isInactive","isActive","userDataReady","stakedOnly","setStakedOnly","activeFarms","filter","farm","pid","multiplier","inactiveFarms","archivedFarms","stakedOnlyFarms","userData","stakedBalance","isGreaterThan","stakedInactiveFarms","stakedArchivedFarms","farmsList","farmsToDisplay","farmsToDisplayWithAPR","map","lpTotalInQuoteToken","quoteTokenPriceBusd","totalLiquidity","times","poolWeight","lpAddresses","MAINNET","apr","liquidity","lowercaseQuery","toLowerCase","lpSymbol","handleChangeQuery","event","target","value","numberOfFarmsVisible","setNumberOfFarmsVisible","chosenFarmsMemoized","chosenFarms","sortFarms","farms","Number","slice","earnings","current","length","farmsCurrentlyVisible","rowData","token","quoteToken","tokenAddress","address","quoteTokenAddress","lpLabel","split","toUpperCase","replace","row","originalValue","label","earned","details","renderContent","TABLE","columnSchema","columns","column","id","name","sort","a","b","original","sortable","handleSortOptionChange","option","mode","marginLeft"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback, useState, useMemo, useRef } from 'react'\nimport { Route, useRouteMatch, useLocation, NavLink } from 'react-router-dom'\nimport BigNumber from 'bignumber.js'\nimport { useWeb3React } from '@web3-react/core'\nimport { Image, Heading, RowType, Toggle, Text, Button, ArrowForwardIcon, Flex } from '@pancakeswap/uikit'\nimport { ChainId } from '@pancakeswap/sdk'\nimport styled from 'styled-components'\nimport FlexLayout from 'components/Layout/Flex'\nimport Page from 'components/Layout/Page'\nimport { useFarms, usePollFarmsWithUserData, usePriceCakeBusd } from 'state/farms/hooks'\nimport useIntersectionObserver from 'hooks/useIntersectionObserver'\nimport { DeserializedFarm } from 'state/types'\nimport { useTranslation } from 'contexts/Localization'\nimport { getBalanceNumber } from 'utils/formatBalance'\nimport { getFarmApr } from 'utils/apr'\nimport { orderBy } from 'lodash'\nimport isArchivedPid from 'utils/farmHelpers'\nimport { latinise } from 'utils/latinise'\nimport { useUserFarmStakedOnly, useUserFarmsViewMode } from 'state/user/hooks'\nimport { ViewMode } from 'state/user/actions'\nimport PageHeader from 'components/PageHeader'\nimport SearchInput from 'components/SearchInput'\nimport Select, { OptionProps } from 'components/Select/Select'\nimport Loading from 'components/Loading'\nimport FarmCard, { FarmWithStakedValue } from './components/FarmCard/FarmCard'\nimport Table from './components/FarmTable/FarmTable'\nimport FarmTabButtons from './components/FarmTabButtons'\nimport { RowProps } from './components/FarmTable/Row'\nimport ToggleView from './components/ToggleView/ToggleView'\nimport { DesktopColumnSchema } from './components/types'\n\nconst ControlContainer = styled.div`\n  display: flex;\n  width: 100%;\n  align-items: center;\n  position: relative;\n\n  justify-content: space-between;\n  flex-direction: column;\n  margin-bottom: 32px;\n\n  ${({ theme }) => theme.mediaQueries.sm} {\n    flex-direction: row;\n    flex-wrap: wrap;\n    padding: 16px 32px;\n    margin-bottom: 0;\n  }\n`\n\nconst ToggleWrapper = styled.div`\n  display: flex;\n  align-items: center;\n  margin-left: 10px;\n\n  ${Text} {\n    margin-left: 8px;\n  }\n`\n\nconst LabelWrapper = styled.div`\n  > ${Text} {\n    font-size: 12px;\n  }\n`\n\nconst FilterContainer = styled.div`\n  display: flex;\n  align-items: center;\n  width: 100%;\n  padding: 8px 0px;\n\n  ${({ theme }) => theme.mediaQueries.sm} {\n    width: auto;\n    padding: 0;\n  }\n`\n\nconst ViewControls = styled.div`\n  flex-wrap: wrap;\n  justify-content: space-between;\n  display: flex;\n  align-items: center;\n  width: 100%;\n\n  > div {\n    padding: 8px 0px;\n  }\n\n  ${({ theme }) => theme.mediaQueries.sm} {\n    justify-content: flex-start;\n    width: auto;\n\n    > div {\n      padding: 0;\n    }\n  }\n`\n\nconst StyledImage = styled(Image)`\n  margin-left: auto;\n  margin-right: auto;\n  margin-top: 58px;\n`\nconst NUMBER_OF_FARMS_VISIBLE = 12\n\nconst getDisplayApr = (cakeRewardsApr?: number, lpRewardsApr?: number) => {\n  if (cakeRewardsApr && lpRewardsApr) {\n    return (cakeRewardsApr + lpRewardsApr).toLocaleString('en-US', { maximumFractionDigits: 2 })\n  }\n  if (cakeRewardsApr) {\n    return cakeRewardsApr.toLocaleString('en-US', { maximumFractionDigits: 2 })\n  }\n  return null\n}\n\nconst Farms: React.FC = () => {\n  const { path } = useRouteMatch()\n  const { pathname } = useLocation()\n  const { t } = useTranslation()\n  const { data: farmsLP, userDataLoaded } = useFarms()\n  const cakePrice = usePriceCakeBusd()\n  const [query, setQuery] = useState('')\n  const [viewMode, setViewMode] = useUserFarmsViewMode()\n  const { account } = useWeb3React()\n  const [sortOption, setSortOption] = useState('hot')\n  const { observerRef, isIntersecting } = useIntersectionObserver()\n  const chosenFarmsLength = useRef(0)\n\n  const isArchived = pathname.includes('archived')\n  const isInactive = pathname.includes('history')\n  const isActive = !isInactive && !isArchived\n\n  usePollFarmsWithUserData(isArchived)\n\n  // Users with no wallet connected should see 0 as Earned amount\n  // Connected users should see loading indicator until first userData has loaded\n  const userDataReady = !account || (!!account && userDataLoaded)\n\n  const [stakedOnly, setStakedOnly] = useUserFarmStakedOnly(isActive)\n\n  const activeFarms = farmsLP.filter((farm) => farm.pid !== 0 && farm.multiplier !== '0X' && !isArchivedPid(farm.pid))\n  const inactiveFarms = farmsLP.filter((farm) => farm.pid !== 0 && farm.multiplier === '0X' && !isArchivedPid(farm.pid))\n  const archivedFarms = farmsLP.filter((farm) => isArchivedPid(farm.pid))\n\n  const stakedOnlyFarms = activeFarms.filter(\n    (farm) => farm.userData && new BigNumber(farm.userData.stakedBalance).isGreaterThan(0),\n  )\n\n  const stakedInactiveFarms = inactiveFarms.filter(\n    (farm) => farm.userData && new BigNumber(farm.userData.stakedBalance).isGreaterThan(0),\n  )\n\n  const stakedArchivedFarms = archivedFarms.filter(\n    (farm) => farm.userData && new BigNumber(farm.userData.stakedBalance).isGreaterThan(0),\n  )\n\n  const farmsList = useCallback(\n    (farmsToDisplay: DeserializedFarm[]): FarmWithStakedValue[] => {\n      let farmsToDisplayWithAPR: FarmWithStakedValue[] = farmsToDisplay.map((farm) => {\n        if (!farm.lpTotalInQuoteToken || !farm.quoteTokenPriceBusd) {\n          return farm\n        }\n        const totalLiquidity = new BigNumber(farm.lpTotalInQuoteToken).times(farm.quoteTokenPriceBusd)\n        const { cakeRewardsApr, lpRewardsApr } = isActive\n          ? getFarmApr(new BigNumber(farm.poolWeight), cakePrice, totalLiquidity, farm.lpAddresses[ChainId.MAINNET])\n          : { cakeRewardsApr: 0, lpRewardsApr: 0 }\n\n        return { ...farm, apr: cakeRewardsApr, lpRewardsApr, liquidity: totalLiquidity }\n      })\n\n      if (query) {\n        const lowercaseQuery = latinise(query.toLowerCase())\n        farmsToDisplayWithAPR = farmsToDisplayWithAPR.filter((farm: FarmWithStakedValue) => {\n          return latinise(farm.lpSymbol.toLowerCase()).includes(lowercaseQuery)\n        })\n      }\n      return farmsToDisplayWithAPR\n    },\n    [cakePrice, query, isActive],\n  )\n\n  const handleChangeQuery = (event: React.ChangeEvent<HTMLInputElement>) => {\n    setQuery(event.target.value)\n  }\n\n  const [numberOfFarmsVisible, setNumberOfFarmsVisible] = useState(NUMBER_OF_FARMS_VISIBLE)\n\n  const chosenFarmsMemoized = useMemo(() => {\n    let chosenFarms = []\n\n    const sortFarms = (farms: FarmWithStakedValue[]): FarmWithStakedValue[] => {\n      switch (sortOption) {\n        case 'apr':\n          return orderBy(farms, (farm: FarmWithStakedValue) => farm.apr + farm.lpRewardsApr, 'desc')\n        case 'multiplier':\n          return orderBy(\n            farms,\n            (farm: FarmWithStakedValue) => (farm.multiplier ? Number(farm.multiplier.slice(0, -1)) : 0),\n            'desc',\n          )\n        case 'earned':\n          return orderBy(\n            farms,\n            (farm: FarmWithStakedValue) => (farm.userData ? Number(farm.userData.earnings) : 0),\n            'desc',\n          )\n        case 'liquidity':\n          return orderBy(farms, (farm: FarmWithStakedValue) => Number(farm.liquidity), 'desc')\n        default:\n          return farms\n      }\n    }\n\n    if (isActive) {\n      chosenFarms = stakedOnly ? farmsList(stakedOnlyFarms) : farmsList(activeFarms)\n    }\n    if (isInactive) {\n      chosenFarms = stakedOnly ? farmsList(stakedInactiveFarms) : farmsList(inactiveFarms)\n    }\n    if (isArchived) {\n      chosenFarms = stakedOnly ? farmsList(stakedArchivedFarms) : farmsList(archivedFarms)\n    }\n\n    return sortFarms(chosenFarms).slice(0, numberOfFarmsVisible)\n  }, [\n    sortOption,\n    activeFarms,\n    farmsList,\n    inactiveFarms,\n    archivedFarms,\n    isActive,\n    isInactive,\n    isArchived,\n    stakedArchivedFarms,\n    stakedInactiveFarms,\n    stakedOnly,\n    stakedOnlyFarms,\n    numberOfFarmsVisible,\n  ])\n\n  chosenFarmsLength.current = chosenFarmsMemoized.length\n\n  useEffect(() => {\n    if (isIntersecting) {\n      setNumberOfFarmsVisible((farmsCurrentlyVisible) => {\n        if (farmsCurrentlyVisible <= chosenFarmsLength.current) {\n          return farmsCurrentlyVisible + NUMBER_OF_FARMS_VISIBLE\n        }\n        return farmsCurrentlyVisible\n      })\n    }\n  }, [isIntersecting])\n\n  const rowData = chosenFarmsMemoized.map((farm) => {\n    const { token, quoteToken } = farm\n    const tokenAddress = token.address\n    const quoteTokenAddress = quoteToken.address\n    const lpLabel = farm.lpSymbol && farm.lpSymbol.split(' ')[0].toUpperCase().replace('PANCAKE', '')\n\n    const row: RowProps = {\n      apr: {\n        value: getDisplayApr(farm.apr, farm.lpRewardsApr),\n        pid: farm.pid,\n        multiplier: farm.multiplier,\n        lpLabel,\n        lpSymbol: farm.lpSymbol,\n        tokenAddress,\n        quoteTokenAddress,\n        cakePrice,\n        originalValue: farm.apr,\n      },\n      farm: {\n        label: lpLabel,\n        pid: farm.pid,\n        token: farm.token,\n        quoteToken: farm.quoteToken,\n      },\n      earned: {\n        earnings: getBalanceNumber(new BigNumber(farm.userData.earnings)),\n        pid: farm.pid,\n      },\n      liquidity: {\n        liquidity: farm.liquidity,\n      },\n      multiplier: {\n        multiplier: farm.multiplier,\n      },\n      details: farm,\n    }\n\n    return row\n  })\n\n  const renderContent = (): JSX.Element => {\n    if (viewMode === ViewMode.TABLE && rowData.length) {\n      const columnSchema = DesktopColumnSchema\n\n      const columns = columnSchema.map((column) => ({\n        id: column.id,\n        name: column.name,\n        label: column.label,\n        sort: (a: RowType<RowProps>, b: RowType<RowProps>) => {\n          switch (column.name) {\n            case 'farm':\n              return b.id - a.id\n            case 'apr':\n              if (a.original.apr.value && b.original.apr.value) {\n                return Number(a.original.apr.value) - Number(b.original.apr.value)\n              }\n\n              return 0\n            case 'earned':\n              return a.original.earned.earnings - b.original.earned.earnings\n            default:\n              return 1\n          }\n        },\n        sortable: column.sortable,\n      }))\n\n      return <Table data={rowData} columns={columns} userDataReady={userDataReady} />\n    }\n\n    return (\n      <FlexLayout>\n        <Route exact path={`${path}`}>\n          {chosenFarmsMemoized.map((farm) => (\n            <FarmCard\n              key={farm.pid}\n              farm={farm}\n              displayApr={getDisplayApr(farm.apr, farm.lpRewardsApr)}\n              cakePrice={cakePrice}\n              account={account}\n              removed={false}\n            />\n          ))}\n        </Route>\n        <Route exact path={`${path}/history`}>\n          {chosenFarmsMemoized.map((farm) => (\n            <FarmCard\n              key={farm.pid}\n              farm={farm}\n              displayApr={getDisplayApr(farm.apr, farm.lpRewardsApr)}\n              cakePrice={cakePrice}\n              account={account}\n              removed\n            />\n          ))}\n        </Route>\n        <Route exact path={`${path}/archived`}>\n          {chosenFarmsMemoized.map((farm) => (\n            <FarmCard\n              key={farm.pid}\n              farm={farm}\n              displayApr={getDisplayApr(farm.apr, farm.lpRewardsApr)}\n              cakePrice={cakePrice}\n              account={account}\n              removed\n            />\n          ))}\n        </Route>\n      </FlexLayout>\n    )\n  }\n\n  const handleSortOptionChange = (option: OptionProps): void => {\n    setSortOption(option.value)\n  }\n\n  return (\n    <>\n      <PageHeader>\n        <Heading as=\"h1\" scale=\"xxl\" color=\"secondary\" mb=\"14px\">\n          {t('Farms')}\n        </Heading>\n        <Heading scale=\"lg\" color=\"text\">\n          {t('Stake LP tokens to earn.')}\n        </Heading>\n        <NavLink exact activeClassName=\"active\" to=\"/farms/auction\" id=\"lottery-pot-banner\" />\n\n          \n     \n      \n      </PageHeader>\n      <Page>\n        <ControlContainer>\n          <ViewControls>\n            <ToggleView viewMode={viewMode} onToggle={(mode: ViewMode) => setViewMode(mode)} />\n            <ToggleWrapper>\n              <Toggle\n                id=\"staked-only-farms\"\n                checked={stakedOnly}\n                onChange={() => setStakedOnly(!stakedOnly)}\n                scale=\"sm\"\n              />\n              <Text> {t('Staked only')}</Text>\n            </ToggleWrapper>\n            <FarmTabButtons hasStakeInFinishedFarms={stakedInactiveFarms.length > 0} />\n          </ViewControls>\n          <FilterContainer>\n            <LabelWrapper>\n              <Text textTransform=\"uppercase\">{t('Sort by')}</Text>\n              <Select\n                options={[\n                  {\n                    label: t('Hot'),\n                    value: 'hot',\n                  },\n                  {\n                    label: t('APR'),\n                    value: 'apr',\n                  },\n                  {\n                    label: t('Multiplier'),\n                    value: 'multiplier',\n                  },\n                  {\n                    label: t('Earned'),\n                    value: 'earned',\n                  },\n                  {\n                    label: t('Liquidity'),\n                    value: 'liquidity',\n                  },\n                ]}\n                onOptionChange={handleSortOptionChange}\n              />\n            </LabelWrapper>\n            <LabelWrapper style={{ marginLeft: 16 }}>\n              <Text textTransform=\"uppercase\">{t('Search')}</Text>\n              <SearchInput onChange={handleChangeQuery} placeholder=\"Search Farms\" />\n            </LabelWrapper>\n          </FilterContainer>\n        </ControlContainer>\n        {renderContent()}\n        {account && !userDataLoaded && stakedOnly && (\n          <Flex justifyContent=\"center\">\n            <Loading />\n          </Flex>\n        )}\n        <div ref={observerRef} />\n        <StyledImage src=\"/images/decorations/3dpan.png\" alt=\"Pancake illustration\" width={120} height={103} />\n      </Page>\n    </>\n  )\n}\n\nexport default Farms\n"]},"metadata":{},"sourceType":"module"}