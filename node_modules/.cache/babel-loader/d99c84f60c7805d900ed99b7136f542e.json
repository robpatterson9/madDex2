{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3;import React,{useState,useEffect}from'react';import styled from'styled-components';import BigNumber from'bignumber.js';import{ethers}from'ethers';import{Modal,Text,Flex,BalanceInput,Box,Button,PancakeRoundIcon}from'@pancakeswap/uikit';import{useTranslation}from'contexts/Localization';import{useWeb3React}from'@web3-react/core';import{formatNumber,getBalanceAmount,getBalanceNumber}from'utils/formatBalance';import{ethersToBigNumber}from'utils/bigNumber';import useTheme from'hooks/useTheme';import useTokenBalance,{FetchStatus}from'hooks/useTokenBalance';import useApproveConfirmTransaction from'hooks/useApproveConfirmTransaction';import{useCake,useFarmAuctionContract}from'hooks/useContract';import{DEFAULT_TOKEN_DECIMAL}from'config';import useToast from'hooks/useToast';import ConnectWalletButton from'components/ConnectWalletButton';import ApproveConfirmButtons,{ButtonArrangement}from'components/ApproveConfirmButtons';import{usePriceCakeBusd}from'state/farms/hooks';import{useCallWithGasPrice}from'hooks/useCallWithGasPrice';import{ToastDescriptionWithTx}from'components/Toast';import tokens from'config/constants/tokens';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var StyledModal=styled(Modal)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  min-width: 280px;\\n  max-width: 320px;\\n  & > div:nth-child(2) {\\n    padding: 0;\\n  }\\n\"])));var ExistingInfo=styled(Box)(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  padding: 24px;\\n  background-color: \",\";\\n\"])),function(_ref){var theme=_ref.theme;return theme.colors.dropdown;});var InnerContent=styled(Box)(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  padding: 24px;\\n\"])));var PlaceBidModal=function PlaceBidModal(_ref2){var onDismiss=_ref2.onDismiss,initialBidAmount=_ref2.initialBidAmount,connectedBidder=_ref2.connectedBidder,refreshBidders=_ref2.refreshBidders;var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useTheme=useTheme(),theme=_useTheme.theme;var _useCallWithGasPrice=useCallWithGasPrice(),callWithGasPrice=_useCallWithGasPrice.callWithGasPrice;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),bid=_useState2[0],setBid=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isMultipleOfTen=_useState4[0],setIsMultipleOfTen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isMoreThanInitialBidAmount=_useState6[0],setIsMoreThanInitialBidAmount=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),userNotEnoughCake=_useState8[0],setUserNotEnoughCake=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),errorText=_useState10[0],setErrorText=_useState10[1];var _useTokenBalance=useTokenBalance(tokens.cake.address),userCake=_useTokenBalance.balance,fetchStatus=_useTokenBalance.fetchStatus;var userCakeBalance=getBalanceAmount(userCake);var cakePriceBusd=usePriceCakeBusd();var farmAuctionContract=useFarmAuctionContract();var cakeContract=useCake();var _useToast=useToast(),toastSuccess=_useToast.toastSuccess;var bidderData=connectedBidder.bidderData;var amount=bidderData.amount,position=bidderData.position;var isFirstBid=amount.isZero();var isInvalidFirstBid=isFirstBid&&!isMoreThanInitialBidAmount;useEffect(function(){setIsMoreThanInitialBidAmount(parseFloat(bid)>=initialBidAmount);setIsMultipleOfTen(parseFloat(bid)%10===0&&parseFloat(bid)!==0);if(fetchStatus===FetchStatus.SUCCESS&&userCakeBalance.lt(bid)){setUserNotEnoughCake(true);}else{setUserNotEnoughCake(false);}},[bid,initialBidAmount,fetchStatus,userCakeBalance]);useEffect(function(){if(userNotEnoughCake){setErrorText(t('Insufficient CAKE balance'));}else if(!isMoreThanInitialBidAmount&&isFirstBid){setErrorText(t('First bid must be %initialBidAmount% CAKE or more.',{initialBidAmount:initialBidAmount}));}else if(!isMultipleOfTen){setErrorText(t('Bid must be a multiple of 10'));}else{setErrorText(null);}},[isMultipleOfTen,isMoreThanInitialBidAmount,userNotEnoughCake,initialBidAmount,t,isFirstBid]);var _useApproveConfirmTra=useApproveConfirmTransaction({onRequiresApproval:function(){var _onRequiresApproval=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,currentAllowance;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return cakeContract.allowance(account,farmAuctionContract.address);case 3:response=_context.sent;currentAllowance=ethersToBigNumber(response);return _context.abrupt(\"return\",currentAllowance.gt(0));case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",false);case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));function onRequiresApproval(){return _onRequiresApproval.apply(this,arguments);}return onRequiresApproval;}(),onApprove:function onApprove(){return callWithGasPrice(cakeContract,'approve',[farmAuctionContract.address,ethers.constants.MaxUint256]);},onApproveSuccess:function(){var _onApproveSuccess=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref3){var receipt;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:receipt=_ref3.receipt;toastSuccess(t('Contract approved - you can now place your bid!'),/*#__PURE__*/_jsx(ToastDescriptionWithTx,{txHash:receipt.transactionHash}));case 2:case\"end\":return _context2.stop();}}},_callee2);}));function onApproveSuccess(_x){return _onApproveSuccess.apply(this,arguments);}return onApproveSuccess;}(),onConfirm:function onConfirm(){var bidAmount=new BigNumber(bid).times(DEFAULT_TOKEN_DECIMAL).toString();return callWithGasPrice(farmAuctionContract,'bid',[bidAmount]);},onSuccess:function(){var _onSuccess=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref4){var receipt;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:receipt=_ref4.receipt;refreshBidders();onDismiss();toastSuccess(t('Bid placed!'),/*#__PURE__*/_jsx(ToastDescriptionWithTx,{txHash:receipt.transactionHash}));case 4:case\"end\":return _context3.stop();}}},_callee3);}));function onSuccess(_x2){return _onSuccess.apply(this,arguments);}return onSuccess;}()}),isApproving=_useApproveConfirmTra.isApproving,isApproved=_useApproveConfirmTra.isApproved,isConfirmed=_useApproveConfirmTra.isConfirmed,isConfirming=_useApproveConfirmTra.isConfirming,handleApprove=_useApproveConfirmTra.handleApprove,handleConfirm=_useApproveConfirmTra.handleConfirm;var handleInputChange=function handleInputChange(input){setBid(input);};var setPercentageValue=function setPercentageValue(percentage){var rounding=percentage===1?BigNumber.ROUND_FLOOR:BigNumber.ROUND_CEIL;var valueToSet=getBalanceAmount(userCake.times(percentage)).div(10).integerValue(rounding).times(10);setBid(valueToSet.toString());};return/*#__PURE__*/_jsxs(StyledModal,{title:t('Place a Bid'),onDismiss:onDismiss,headerBackground:theme.colors.gradients.cardHeader,children:[/*#__PURE__*/_jsxs(ExistingInfo,{children:[/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",children:[/*#__PURE__*/_jsx(Text,{children:t('Your existing bid')}),/*#__PURE__*/_jsx(Text,{children:t('%num% CAKE',{num:getBalanceNumber(amount).toLocaleString()})})]}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",children:[/*#__PURE__*/_jsx(Text,{children:t('Your position')}),/*#__PURE__*/_jsx(Text,{children:position?\"#\".concat(position):'-'})]})]}),/*#__PURE__*/_jsxs(InnerContent,{children:[/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",alignItems:\"center\",pb:\"8px\",children:[/*#__PURE__*/_jsx(Text,{children:t('Bid a multiple of 10')}),/*#__PURE__*/_jsxs(Flex,{children:[/*#__PURE__*/_jsx(PancakeRoundIcon,{width:\"24px\",height:\"24px\",mr:\"4px\"}),/*#__PURE__*/_jsx(Text,{bold:true,children:\"CAKE\"})]})]}),isFirstBid&&/*#__PURE__*/_jsx(Text,{pb:\"8px\",small:true,children:t('First bid must be %initialBidAmount% CAKE or more.',{initialBidAmount:initialBidAmount})}),/*#__PURE__*/_jsx(BalanceInput,{isWarning:!isMultipleOfTen||isInvalidFirstBid,placeholder:\"0\",value:bid,onUserInput:handleInputChange,currencyValue:cakePriceBusd.gt(0)&&\"~\".concat(bid?cakePriceBusd.times(new BigNumber(bid)).toNumber().toLocaleString():'0.00',\" USD\")}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"flex-end\",mt:\"8px\",children:[/*#__PURE__*/_jsxs(Text,{fontSize:\"12px\",color:\"textSubtle\",mr:\"8px\",children:[t('Balance'),\":\"]}),/*#__PURE__*/_jsx(Text,{fontSize:\"12px\",color:\"textSubtle\",children:formatNumber(userCakeBalance.toNumber(),3,3)})]}),errorText&&/*#__PURE__*/_jsx(Text,{color:\"failure\",textAlign:\"right\",fontSize:\"12px\",children:errorText}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",mt:\"8px\",mb:\"24px\",children:[/*#__PURE__*/_jsx(Button,{disabled:fetchStatus!==FetchStatus.SUCCESS,scale:\"xs\",mx:\"2px\",p:\"4px 16px\",variant:\"tertiary\",onClick:function onClick(){return setPercentageValue(0.25);},children:\"25%\"}),/*#__PURE__*/_jsx(Button,{disabled:fetchStatus!==FetchStatus.SUCCESS,scale:\"xs\",mx:\"2px\",p:\"4px 16px\",variant:\"tertiary\",onClick:function onClick(){return setPercentageValue(0.5);},children:\"50%\"}),/*#__PURE__*/_jsx(Button,{disabled:fetchStatus!==FetchStatus.SUCCESS,scale:\"xs\",mx:\"2px\",p:\"4px 16px\",variant:\"tertiary\",onClick:function onClick(){return setPercentageValue(0.75);},children:\"75%\"}),/*#__PURE__*/_jsx(Button,{disabled:fetchStatus!==FetchStatus.SUCCESS,scale:\"xs\",mx:\"2px\",p:\"4px 16px\",variant:\"tertiary\",onClick:function onClick(){return setPercentageValue(1);},children:\"MAX\"})]}),/*#__PURE__*/_jsx(Flex,{flexDirection:\"column\",children:account?/*#__PURE__*/_jsx(ApproveConfirmButtons,{isApproveDisabled:isApproved,isApproving:isApproving,isConfirmDisabled:!isMultipleOfTen||getBalanceAmount(userCake).lt(bid)||isConfirmed||isInvalidFirstBid||userNotEnoughCake,isConfirming:isConfirming,onApprove:handleApprove,onConfirm:handleConfirm,buttonArrangement:ButtonArrangement.SEQUENTIAL}):/*#__PURE__*/_jsx(ConnectWalletButton,{})}),/*#__PURE__*/_jsx(Text,{color:\"textSubtle\",small:true,mt:\"24px\",children:t('If your bid is unsuccessful, you’ll be able to reclaim your CAKE after the auction.')})]})]});};export default PlaceBidModal;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/views/FarmAuction/components/PlaceBidModal.tsx"],"names":["React","useState","useEffect","styled","BigNumber","ethers","Modal","Text","Flex","BalanceInput","Box","Button","PancakeRoundIcon","useTranslation","useWeb3React","formatNumber","getBalanceAmount","getBalanceNumber","ethersToBigNumber","useTheme","useTokenBalance","FetchStatus","useApproveConfirmTransaction","useCake","useFarmAuctionContract","DEFAULT_TOKEN_DECIMAL","useToast","ConnectWalletButton","ApproveConfirmButtons","ButtonArrangement","usePriceCakeBusd","useCallWithGasPrice","ToastDescriptionWithTx","tokens","StyledModal","ExistingInfo","theme","colors","dropdown","InnerContent","PlaceBidModal","onDismiss","initialBidAmount","connectedBidder","refreshBidders","account","t","callWithGasPrice","bid","setBid","isMultipleOfTen","setIsMultipleOfTen","isMoreThanInitialBidAmount","setIsMoreThanInitialBidAmount","userNotEnoughCake","setUserNotEnoughCake","errorText","setErrorText","cake","address","userCake","balance","fetchStatus","userCakeBalance","cakePriceBusd","farmAuctionContract","cakeContract","toastSuccess","bidderData","amount","position","isFirstBid","isZero","isInvalidFirstBid","parseFloat","SUCCESS","lt","onRequiresApproval","allowance","response","currentAllowance","gt","onApprove","constants","MaxUint256","onApproveSuccess","receipt","transactionHash","onConfirm","bidAmount","times","toString","onSuccess","isApproving","isApproved","isConfirmed","isConfirming","handleApprove","handleConfirm","handleInputChange","input","setPercentageValue","percentage","rounding","ROUND_FLOOR","ROUND_CEIL","valueToSet","div","integerValue","gradients","cardHeader","num","toLocaleString","toNumber","SEQUENTIAL"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport styled from 'styled-components'\nimport BigNumber from 'bignumber.js'\nimport { ethers } from 'ethers'\nimport { Modal, Text, Flex, BalanceInput, Box, Button, PancakeRoundIcon } from '@pancakeswap/uikit'\nimport { useTranslation } from 'contexts/Localization'\nimport { useWeb3React } from '@web3-react/core'\nimport { formatNumber, getBalanceAmount, getBalanceNumber } from 'utils/formatBalance'\nimport { ethersToBigNumber } from 'utils/bigNumber'\nimport useTheme from 'hooks/useTheme'\nimport useTokenBalance, { FetchStatus } from 'hooks/useTokenBalance'\nimport useApproveConfirmTransaction from 'hooks/useApproveConfirmTransaction'\nimport { useCake, useFarmAuctionContract } from 'hooks/useContract'\nimport { DEFAULT_TOKEN_DECIMAL } from 'config'\nimport useToast from 'hooks/useToast'\nimport ConnectWalletButton from 'components/ConnectWalletButton'\nimport ApproveConfirmButtons, { ButtonArrangement } from 'components/ApproveConfirmButtons'\nimport { ConnectedBidder } from 'config/constants/types'\nimport { usePriceCakeBusd } from 'state/farms/hooks'\nimport { useCallWithGasPrice } from 'hooks/useCallWithGasPrice'\nimport { ToastDescriptionWithTx } from 'components/Toast'\nimport tokens from 'config/constants/tokens'\n\nconst StyledModal = styled(Modal)`\n  min-width: 280px;\n  max-width: 320px;\n  & > div:nth-child(2) {\n    padding: 0;\n  }\n`\n\nconst ExistingInfo = styled(Box)`\n  padding: 24px;\n  background-color: ${({ theme }) => theme.colors.dropdown};\n`\n\nconst InnerContent = styled(Box)`\n  padding: 24px;\n`\n\ninterface PlaceBidModalProps {\n  onDismiss?: () => void\n  // undefined initialBidAmount is passed only if auction is not loaded\n  // in this case modal will not be possible to open\n  initialBidAmount?: number\n  connectedBidder: ConnectedBidder\n  refreshBidders: () => void\n}\n\nconst PlaceBidModal: React.FC<PlaceBidModalProps> = ({\n  onDismiss,\n  initialBidAmount,\n  connectedBidder,\n  refreshBidders,\n}) => {\n  const { account } = useWeb3React()\n  const { t } = useTranslation()\n  const { theme } = useTheme()\n  const { callWithGasPrice } = useCallWithGasPrice()\n\n  const [bid, setBid] = useState('')\n  const [isMultipleOfTen, setIsMultipleOfTen] = useState(false)\n  const [isMoreThanInitialBidAmount, setIsMoreThanInitialBidAmount] = useState(false)\n  const [userNotEnoughCake, setUserNotEnoughCake] = useState(false)\n  const [errorText, setErrorText] = useState(null)\n\n  const { balance: userCake, fetchStatus } = useTokenBalance(tokens.cake.address)\n  const userCakeBalance = getBalanceAmount(userCake)\n\n  const cakePriceBusd = usePriceCakeBusd()\n  const farmAuctionContract = useFarmAuctionContract()\n  const cakeContract = useCake()\n\n  const { toastSuccess } = useToast()\n\n  const { bidderData } = connectedBidder\n  const { amount, position } = bidderData\n  const isFirstBid = amount.isZero()\n  const isInvalidFirstBid = isFirstBid && !isMoreThanInitialBidAmount\n\n  useEffect(() => {\n    setIsMoreThanInitialBidAmount(parseFloat(bid) >= initialBidAmount)\n    setIsMultipleOfTen(parseFloat(bid) % 10 === 0 && parseFloat(bid) !== 0)\n    if (fetchStatus === FetchStatus.SUCCESS && userCakeBalance.lt(bid)) {\n      setUserNotEnoughCake(true)\n    } else {\n      setUserNotEnoughCake(false)\n    }\n  }, [bid, initialBidAmount, fetchStatus, userCakeBalance])\n\n  useEffect(() => {\n    if (userNotEnoughCake) {\n      setErrorText(t('Insufficient CAKE balance'))\n    } else if (!isMoreThanInitialBidAmount && isFirstBid) {\n      setErrorText(t('First bid must be %initialBidAmount% CAKE or more.', { initialBidAmount }))\n    } else if (!isMultipleOfTen) {\n      setErrorText(t('Bid must be a multiple of 10'))\n    } else {\n      setErrorText(null)\n    }\n  }, [isMultipleOfTen, isMoreThanInitialBidAmount, userNotEnoughCake, initialBidAmount, t, isFirstBid])\n\n  const { isApproving, isApproved, isConfirmed, isConfirming, handleApprove, handleConfirm } =\n    useApproveConfirmTransaction({\n      onRequiresApproval: async () => {\n        try {\n          const response = await cakeContract.allowance(account, farmAuctionContract.address)\n          const currentAllowance = ethersToBigNumber(response)\n          return currentAllowance.gt(0)\n        } catch (error) {\n          return false\n        }\n      },\n      onApprove: () => {\n        return callWithGasPrice(cakeContract, 'approve', [farmAuctionContract.address, ethers.constants.MaxUint256])\n      },\n      onApproveSuccess: async ({ receipt }) => {\n        toastSuccess(\n          t('Contract approved - you can now place your bid!'),\n          <ToastDescriptionWithTx txHash={receipt.transactionHash} />,\n        )\n      },\n      onConfirm: () => {\n        const bidAmount = new BigNumber(bid).times(DEFAULT_TOKEN_DECIMAL).toString()\n        return callWithGasPrice(farmAuctionContract, 'bid', [bidAmount])\n      },\n      onSuccess: async ({ receipt }) => {\n        refreshBidders()\n        onDismiss()\n        toastSuccess(t('Bid placed!'), <ToastDescriptionWithTx txHash={receipt.transactionHash} />)\n      },\n    })\n\n  const handleInputChange = (input: string) => {\n    setBid(input)\n  }\n\n  const setPercentageValue = (percentage: number) => {\n    const rounding = percentage === 1 ? BigNumber.ROUND_FLOOR : BigNumber.ROUND_CEIL\n    const valueToSet = getBalanceAmount(userCake.times(percentage)).div(10).integerValue(rounding).times(10)\n    setBid(valueToSet.toString())\n  }\n  return (\n    <StyledModal title={t('Place a Bid')} onDismiss={onDismiss} headerBackground={theme.colors.gradients.cardHeader}>\n      <ExistingInfo>\n        <Flex justifyContent=\"space-between\">\n          <Text>{t('Your existing bid')}</Text>\n          <Text>{t('%num% CAKE', { num: getBalanceNumber(amount).toLocaleString() })}</Text>\n        </Flex>\n        <Flex justifyContent=\"space-between\">\n          <Text>{t('Your position')}</Text>\n          <Text>{position ? `#${position}` : '-'}</Text>\n        </Flex>\n      </ExistingInfo>\n      <InnerContent>\n        <Flex justifyContent=\"space-between\" alignItems=\"center\" pb=\"8px\">\n          <Text>{t('Bid a multiple of 10')}</Text>\n          <Flex>\n            <PancakeRoundIcon width=\"24px\" height=\"24px\" mr=\"4px\" />\n            <Text bold>CAKE</Text>\n          </Flex>\n        </Flex>\n        {isFirstBid && (\n          <Text pb=\"8px\" small>\n            {t('First bid must be %initialBidAmount% CAKE or more.', { initialBidAmount })}\n          </Text>\n        )}\n        <BalanceInput\n          isWarning={!isMultipleOfTen || isInvalidFirstBid}\n          placeholder=\"0\"\n          value={bid}\n          onUserInput={handleInputChange}\n          currencyValue={\n            cakePriceBusd.gt(0) &&\n            `~${bid ? cakePriceBusd.times(new BigNumber(bid)).toNumber().toLocaleString() : '0.00'} USD`\n          }\n        />\n        <Flex justifyContent=\"flex-end\" mt=\"8px\">\n          <Text fontSize=\"12px\" color=\"textSubtle\" mr=\"8px\">\n            {t('Balance')}:\n          </Text>\n          <Text fontSize=\"12px\" color=\"textSubtle\">\n            {formatNumber(userCakeBalance.toNumber(), 3, 3)}\n          </Text>\n        </Flex>\n        {errorText && (\n          <Text color=\"failure\" textAlign=\"right\" fontSize=\"12px\">\n            {errorText}\n          </Text>\n        )}\n        <Flex justifyContent=\"space-between\" mt=\"8px\" mb=\"24px\">\n          <Button\n            disabled={fetchStatus !== FetchStatus.SUCCESS}\n            scale=\"xs\"\n            mx=\"2px\"\n            p=\"4px 16px\"\n            variant=\"tertiary\"\n            onClick={() => setPercentageValue(0.25)}\n          >\n            25%\n          </Button>\n          <Button\n            disabled={fetchStatus !== FetchStatus.SUCCESS}\n            scale=\"xs\"\n            mx=\"2px\"\n            p=\"4px 16px\"\n            variant=\"tertiary\"\n            onClick={() => setPercentageValue(0.5)}\n          >\n            50%\n          </Button>\n          <Button\n            disabled={fetchStatus !== FetchStatus.SUCCESS}\n            scale=\"xs\"\n            mx=\"2px\"\n            p=\"4px 16px\"\n            variant=\"tertiary\"\n            onClick={() => setPercentageValue(0.75)}\n          >\n            75%\n          </Button>\n          <Button\n            disabled={fetchStatus !== FetchStatus.SUCCESS}\n            scale=\"xs\"\n            mx=\"2px\"\n            p=\"4px 16px\"\n            variant=\"tertiary\"\n            onClick={() => setPercentageValue(1)}\n          >\n            MAX\n          </Button>\n        </Flex>\n        <Flex flexDirection=\"column\">\n          {account ? (\n            <ApproveConfirmButtons\n              isApproveDisabled={isApproved}\n              isApproving={isApproving}\n              isConfirmDisabled={\n                !isMultipleOfTen ||\n                getBalanceAmount(userCake).lt(bid) ||\n                isConfirmed ||\n                isInvalidFirstBid ||\n                userNotEnoughCake\n              }\n              isConfirming={isConfirming}\n              onApprove={handleApprove}\n              onConfirm={handleConfirm}\n              buttonArrangement={ButtonArrangement.SEQUENTIAL}\n            />\n          ) : (\n            <ConnectWalletButton />\n          )}\n        </Flex>\n        <Text color=\"textSubtle\" small mt=\"24px\">\n          {t('If your bid is unsuccessful, you’ll be able to reclaim your CAKE after the auction.')}\n        </Text>\n      </InnerContent>\n    </StyledModal>\n  )\n}\n\nexport default PlaceBidModal\n"]},"metadata":{},"sourceType":"module"}