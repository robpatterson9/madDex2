{"ast":null,"code":"import _slicedToArray from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _taggedTemplateLiteral from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";import _asyncToGenerator from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";var _templateObject;import{useEffect,useState}from'react';import{request,gql}from'graphql-request';import{INFO_CLIENT}from'config/constants/endpoints';import{TOKEN_BLACKLIST}from'config/constants/info';import{getDeltaTimestamps}from'views/Info/utils/infoQueryHelpers';/**\n * Tokens to display on Home page\n * The actual data is later requested in tokenData.ts\n * Note: dailyTxns_gt: 300 is there to prevent fetching incorrectly priced tokens with high dailyVolumeUSD\n */var fetchTopTokens=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(timestamp24hAgo){var query,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;query=gql(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n      query topTokens($blacklist: [String!], $timestamp24hAgo: Int) {\\n        tokenDayDatas(\\n          first: 30\\n          where: { dailyTxns_gt: 300, id_not_in: $blacklist, date_gt: $timestamp24hAgo }\\n          orderBy: dailyVolumeUSD\\n          orderDirection: desc\\n        ) {\\n          id\\n        }\\n      }\\n    \"])));_context.next=4;return request(INFO_CLIENT,query,{blacklist:TOKEN_BLACKLIST,timestamp24hAgo:timestamp24hAgo});case 4:data=_context.sent;return _context.abrupt(\"return\",data.tokenDayDatas.map(function(t){return t.id.split('-')[0];}));case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.error('Failed to fetch top tokens',_context.t0);return _context.abrupt(\"return\",[]);case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function fetchTopTokens(_x){return _ref.apply(this,arguments);};}();/**\n * Fetch top addresses by volume\n */var useTopTokenAddresses=function useTopTokenAddresses(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),topTokenAddresses=_useState2[0],setTopTokenAddresses=_useState2[1];var _getDeltaTimestamps=getDeltaTimestamps(),_getDeltaTimestamps2=_slicedToArray(_getDeltaTimestamps,1),timestamp24hAgo=_getDeltaTimestamps2[0];useEffect(function(){var fetch=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var addresses;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetchTopTokens(timestamp24hAgo);case 2:addresses=_context2.sent;setTopTokenAddresses(addresses);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function fetch(){return _ref2.apply(this,arguments);};}();if(topTokenAddresses.length===0){fetch();}},[topTokenAddresses,timestamp24hAgo]);return topTokenAddresses;};export default useTopTokenAddresses;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/state/info/queries/tokens/topTokens.ts"],"names":["useEffect","useState","request","gql","INFO_CLIENT","TOKEN_BLACKLIST","getDeltaTimestamps","fetchTopTokens","timestamp24hAgo","query","blacklist","data","tokenDayDatas","map","t","id","split","console","error","useTopTokenAddresses","topTokenAddresses","setTopTokenAddresses","fetch","addresses","length"],"mappings":"ioBAAA,OAASA,SAAT,CAAoBC,QAApB,KAAoC,OAApC,CACA,OAASC,OAAT,CAAkBC,GAAlB,KAA6B,iBAA7B,CACA,OAASC,WAAT,KAA4B,4BAA5B,CACA,OAASC,eAAT,KAAgC,uBAAhC,CACA,OAASC,kBAAT,KAAmC,mCAAnC,CAQA;AACA;AACA;AACA;AACA,GACA,GAAMC,CAAAA,cAAc,0FAAG,iBAAOC,eAAP,iJAEbC,KAFa,CAELN,GAFK,8ZAcAD,CAAAA,OAAO,CAAoBE,WAApB,CAAiCK,KAAjC,CAAwC,CAAEC,SAAS,CAAEL,eAAb,CAA8BG,eAAe,CAAfA,eAA9B,CAAxC,CAdP,QAcbG,IAda,+CAgBZA,IAAI,CAACC,aAAL,CAAmBC,GAAnB,CAAuB,SAACC,CAAD,QAAOA,CAAAA,CAAC,CAACC,EAAF,CAAKC,KAAL,CAAW,GAAX,EAAgB,CAAhB,CAAP,EAAvB,CAhBY,0DAkBnBC,OAAO,CAACC,KAAR,CAAc,4BAAd,cAlBmB,gCAmBZ,EAnBY,sEAAH,kBAAdX,CAAAA,cAAc,4CAApB,CAuBA;AACA;AACA,GACA,GAAMY,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,EAAgB,CAC3C,cAAkDlB,QAAQ,CAAC,EAAD,CAA1D,wCAAOmB,iBAAP,eAA0BC,oBAA1B,eACA,wBAA0Bf,kBAAkB,EAA5C,4DAAOE,eAAP,yBAEAR,SAAS,CAAC,UAAM,CACd,GAAMsB,CAAAA,KAAK,2FAAG,6KACYf,CAAAA,cAAc,CAACC,eAAD,CAD1B,QACNe,SADM,gBAEZF,oBAAoB,CAACE,SAAD,CAApB,CAFY,wDAAH,kBAALD,CAAAA,KAAK,2CAAX,CAIA,GAAIF,iBAAiB,CAACI,MAAlB,GAA6B,CAAjC,CAAoC,CAClCF,KAAK,GACN,CACF,CARQ,CAQN,CAACF,iBAAD,CAAoBZ,eAApB,CARM,CAAT,CAUA,MAAOY,CAAAA,iBAAP,CACD,CAfD,CAiBA,cAAeD,CAAAA,oBAAf","sourcesContent":["import { useEffect, useState } from 'react'\nimport { request, gql } from 'graphql-request'\nimport { INFO_CLIENT } from 'config/constants/endpoints'\nimport { TOKEN_BLACKLIST } from 'config/constants/info'\nimport { getDeltaTimestamps } from 'views/Info/utils/infoQueryHelpers'\n\ninterface TopTokensResponse {\n  tokenDayDatas: {\n    id: string\n  }[]\n}\n\n/**\n * Tokens to display on Home page\n * The actual data is later requested in tokenData.ts\n * Note: dailyTxns_gt: 300 is there to prevent fetching incorrectly priced tokens with high dailyVolumeUSD\n */\nconst fetchTopTokens = async (timestamp24hAgo: number): Promise<string[]> => {\n  try {\n    const query = gql`\n      query topTokens($blacklist: [String!], $timestamp24hAgo: Int) {\n        tokenDayDatas(\n          first: 30\n          where: { dailyTxns_gt: 300, id_not_in: $blacklist, date_gt: $timestamp24hAgo }\n          orderBy: dailyVolumeUSD\n          orderDirection: desc\n        ) {\n          id\n        }\n      }\n    `\n    const data = await request<TopTokensResponse>(INFO_CLIENT, query, { blacklist: TOKEN_BLACKLIST, timestamp24hAgo })\n    // tokenDayDatas id has compound id \"0xTOKENADDRESS-NUMBERS\", extracting token address with .split('-')\n    return data.tokenDayDatas.map((t) => t.id.split('-')[0])\n  } catch (error) {\n    console.error('Failed to fetch top tokens', error)\n    return []\n  }\n}\n\n/**\n * Fetch top addresses by volume\n */\nconst useTopTokenAddresses = (): string[] => {\n  const [topTokenAddresses, setTopTokenAddresses] = useState([])\n  const [timestamp24hAgo] = getDeltaTimestamps()\n\n  useEffect(() => {\n    const fetch = async () => {\n      const addresses = await fetchTopTokens(timestamp24hAgo)\n      setTopTokenAddresses(addresses)\n    }\n    if (topTokenAddresses.length === 0) {\n      fetch()\n    }\n  }, [topTokenAddresses, timestamp24hAgo])\n\n  return topTokenAddresses\n}\n\nexport default useTopTokenAddresses\n"]},"metadata":{},"sourceType":"module"}