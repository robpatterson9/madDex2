{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _asyncToGenerator from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _taggedTemplateLiteral from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2;import React from'react';import{useWeb3React}from'@web3-react/core';import{Box,Flex,Heading,Text,PrizeIcon,BlockIcon,LinkExternal,useTooltip,InfoIcon}from'@pancakeswap/uikit';import styled from'styled-components';import{useAppDispatch}from'state';import{useTranslation}from'contexts/Localization';import{REWARD_RATE}from'state/predictions/config';import{BetPosition}from'state/types';import{fetchLedgerData,markAsCollected}from'state/predictions';import{Result}from'state/predictions/helpers';import{useGetIsClaimable}from'state/predictions/hooks';import{useBNBBusdPrice}from'hooks/useBUSDPrice';import{getBscScanLink}from'utils';import{multiplyPriceByAmount}from'utils/prices';import useIsRefundable from'../../hooks/useIsRefundable';import{formatBnb,getNetPayout}from'./helpers';import CollectWinningsButton from'../CollectWinningsButton';import PositionTag from'../PositionTag';import ReclaimPositionButton from'../ReclaimPositionButton';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var StyledBetResult=styled(Box)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  border: 2px solid \",\";\\n  border-radius: 16px;\\n  margin-bottom: 24px;\\n  padding: 16px;\\n\"])),function(_ref){var theme=_ref.theme;return theme.colors.textDisabled;});var Divider=styled.hr(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  border: 1px solid \",\";\\n\"])),function(_ref2){var theme=_ref2.theme;return theme.colors.cardBorder;});var BetResult=function BetResult(_ref3){var bet=_ref3.bet,result=_ref3.result;var _useTranslation=useTranslation(),t=_useTranslation.t;var dispatch=useAppDispatch();var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var _useIsRefundable=useIsRefundable(bet.round.epoch),isRefundable=_useIsRefundable.isRefundable;var canClaim=useGetIsClaimable(bet.round.epoch);var bnbBusdPrice=useBNBBusdPrice();var _useTooltip=useTooltip(/*#__PURE__*/_jsx(Text,{as:\"p\",children:t('Includes your original position and your winnings, minus the %fee% fee.',{fee:'3%'})}),{placement:'auto'}),targetRef=_useTooltip.targetRef,tooltip=_useTooltip.tooltip,tooltipVisible=_useTooltip.tooltipVisible;var isWinner=result===Result.WIN;// Winners get the payout, otherwise the claim what they put it if it was canceled\nvar payout=isWinner?getNetPayout(bet,REWARD_RATE):bet.amount;var totalPayout=multiplyPriceByAmount(bnbBusdPrice,payout);var returned=payout+bet.amount;var getHeaderColor=function getHeaderColor(){switch(result){case Result.WIN:return'warning';case Result.LOSE:return'textSubtle';case Result.CANCELED:return'textDisabled';case Result.HOUSE:return'textDisabled';default:return'text';}};var getHeaderText=function getHeaderText(){switch(result){case Result.WIN:return t('Win');case Result.LOSE:return t('Lose');case Result.CANCELED:return t('Canceled');case Result.HOUSE:return t('To Burn');default:return'';}};var getHeaderIcon=function getHeaderIcon(){switch(result){case Result.WIN:return/*#__PURE__*/_jsx(PrizeIcon,{color:getHeaderColor()});case Result.LOSE:case Result.CANCELED:return/*#__PURE__*/_jsx(BlockIcon,{color:getHeaderColor()});default:return null;}};var getResultColor=function getResultColor(){switch(result){case Result.WIN:return'success';case Result.LOSE:return'failure';case Result.CANCELED:case Result.HOUSE:default:return'text';}};var handleSuccess=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// We have to mark the bet as claimed immediately because it does not update fast enough\ndispatch(markAsCollected(_defineProperty({},bet.round.epoch,true)));dispatch(fetchLedgerData({account:account,epochs:[bet.round.epoch]}));case 2:case\"end\":return _context.stop();}}},_callee);}));return function handleSuccess(){return _ref4.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"space-between\",mb:\"8px\",children:[/*#__PURE__*/_jsx(Heading,{children:t('Your History')}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",children:[/*#__PURE__*/_jsx(Heading,{as:\"h3\",color:getHeaderColor(),textTransform:\"uppercase\",bold:true,mr:\"4px\",children:getHeaderText()}),getHeaderIcon()]})]}),/*#__PURE__*/_jsxs(StyledBetResult,{children:[result===Result.WIN&&!canClaim&&/*#__PURE__*/_jsx(CollectWinningsButton,{hasClaimed:!canClaim,width:\"100%\",mb:\"16px\",onSuccess:handleSuccess,children:bet.claimed?t('Already Collected'):t('Collect Winnings')}),bet.claimed&&bet.claimedHash&&/*#__PURE__*/_jsx(Flex,{justifyContent:\"center\",children:/*#__PURE__*/_jsx(LinkExternal,{href:getBscScanLink(bet.claimedHash,'transaction'),mb:\"16px\",children:t('View on BscScan')})}),result===Result.CANCELED&&isRefundable&&/*#__PURE__*/_jsx(ReclaimPositionButton,{epoch:bet.round.epoch,width:\"100%\",mb:\"16px\"}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"space-between\",mb:\"16px\",children:[/*#__PURE__*/_jsxs(Text,{children:[t('Your direction'),\":\"]}),/*#__PURE__*/_jsx(PositionTag,{betPosition:bet.position,children:bet.position===BetPosition.BULL?t('Up'):t('Down')})]}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"space-between\",mb:\"16px\",children:[/*#__PURE__*/_jsx(Text,{children:t('Your position')}),/*#__PURE__*/_jsx(Text,{children:\"\".concat(formatBnb(bet.amount),\" BNB\")})]}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"start\",justifyContent:\"space-between\",children:[/*#__PURE__*/_jsxs(Text,{bold:true,children:[isWinner?t('Your winnings'):t('Your Result'),\":\"]}),/*#__PURE__*/_jsxs(Box,{style:{textAlign:'right'},children:[/*#__PURE__*/_jsx(Text,{bold:true,color:getResultColor(),children:\"\".concat(isWinner?'+':'-').concat(formatBnb(payout),\" BNB\")}),/*#__PURE__*/_jsx(Text,{fontSize:\"12px\",color:\"textSubtle\",children:\"~$\".concat(totalPayout.toFixed(2))})]})]}),isWinner&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"start\",justifyContent:\"space-between\",children:[/*#__PURE__*/_jsxs(Text,{fontSize:\"14px\",color:\"textSubtle\",children:[t('Amount to collect'),\":\"]}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"end\",children:[/*#__PURE__*/_jsx(Text,{fontSize:\"14px\",color:\"textSubtle\",children:\"\".concat(formatBnb(returned),\" BNB\")}),/*#__PURE__*/_jsx(\"span\",{ref:targetRef,children:/*#__PURE__*/_jsx(InfoIcon,{color:\"textSubtle\",ml:\"4px\"})})]}),tooltipVisible&&tooltip]})]})]})]});};export default BetResult;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/views/Predictions/components/History/BetResult.tsx"],"names":["React","useWeb3React","Box","Flex","Heading","Text","PrizeIcon","BlockIcon","LinkExternal","useTooltip","InfoIcon","styled","useAppDispatch","useTranslation","REWARD_RATE","BetPosition","fetchLedgerData","markAsCollected","Result","useGetIsClaimable","useBNBBusdPrice","getBscScanLink","multiplyPriceByAmount","useIsRefundable","formatBnb","getNetPayout","CollectWinningsButton","PositionTag","ReclaimPositionButton","StyledBetResult","theme","colors","textDisabled","Divider","hr","cardBorder","BetResult","bet","result","t","dispatch","account","round","epoch","isRefundable","canClaim","bnbBusdPrice","fee","placement","targetRef","tooltip","tooltipVisible","isWinner","WIN","payout","amount","totalPayout","returned","getHeaderColor","LOSE","CANCELED","HOUSE","getHeaderText","getHeaderIcon","getResultColor","handleSuccess","epochs","claimed","claimedHash","position","BULL","textAlign","toFixed"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { useWeb3React } from '@web3-react/core'\nimport { Box, Flex, Heading, Text, PrizeIcon, BlockIcon, LinkExternal, useTooltip, InfoIcon } from '@pancakeswap/uikit'\nimport styled from 'styled-components'\nimport { useAppDispatch } from 'state'\nimport { useTranslation } from 'contexts/Localization'\nimport { REWARD_RATE } from 'state/predictions/config'\nimport { Bet, BetPosition } from 'state/types'\nimport { fetchLedgerData, markAsCollected } from 'state/predictions'\nimport { Result } from 'state/predictions/helpers'\nimport { useGetIsClaimable } from 'state/predictions/hooks'\nimport { useBNBBusdPrice } from 'hooks/useBUSDPrice'\nimport { getBscScanLink } from 'utils'\nimport { multiplyPriceByAmount } from 'utils/prices'\nimport useIsRefundable from '../../hooks/useIsRefundable'\nimport { formatBnb, getNetPayout } from './helpers'\nimport CollectWinningsButton from '../CollectWinningsButton'\nimport PositionTag from '../PositionTag'\nimport ReclaimPositionButton from '../ReclaimPositionButton'\n\ninterface BetResultProps {\n  bet: Bet\n  result: Result\n}\n\nconst StyledBetResult = styled(Box)`\n  border: 2px solid ${({ theme }) => theme.colors.textDisabled};\n  border-radius: 16px;\n  margin-bottom: 24px;\n  padding: 16px;\n`\n\nconst Divider = styled.hr`\n  border: 1px solid ${({ theme }) => theme.colors.cardBorder};\n`\n\nconst BetResult: React.FC<BetResultProps> = ({ bet, result }) => {\n  const { t } = useTranslation()\n  const dispatch = useAppDispatch()\n  const { account } = useWeb3React()\n  const { isRefundable } = useIsRefundable(bet.round.epoch)\n  const canClaim = useGetIsClaimable(bet.round.epoch)\n  const bnbBusdPrice = useBNBBusdPrice()\n  const { targetRef, tooltip, tooltipVisible } = useTooltip(\n    <Text as=\"p\">{t('Includes your original position and your winnings, minus the %fee% fee.', { fee: '3%' })}</Text>,\n    { placement: 'auto' },\n  )\n\n  const isWinner = result === Result.WIN\n\n  // Winners get the payout, otherwise the claim what they put it if it was canceled\n  const payout = isWinner ? getNetPayout(bet, REWARD_RATE) : bet.amount\n  const totalPayout = multiplyPriceByAmount(bnbBusdPrice, payout)\n  const returned = payout + bet.amount\n\n  const getHeaderColor = () => {\n    switch (result) {\n      case Result.WIN:\n        return 'warning'\n      case Result.LOSE:\n        return 'textSubtle'\n      case Result.CANCELED:\n        return 'textDisabled'\n      case Result.HOUSE:\n        return 'textDisabled'\n      default:\n        return 'text'\n    }\n  }\n\n  const getHeaderText = () => {\n    switch (result) {\n      case Result.WIN:\n        return t('Win')\n      case Result.LOSE:\n        return t('Lose')\n      case Result.CANCELED:\n        return t('Canceled')\n      case Result.HOUSE:\n        return t('To Burn')\n      default:\n        return ''\n    }\n  }\n\n  const getHeaderIcon = () => {\n    switch (result) {\n      case Result.WIN:\n        return <PrizeIcon color={getHeaderColor()} />\n      case Result.LOSE:\n      case Result.CANCELED:\n        return <BlockIcon color={getHeaderColor()} />\n      default:\n        return null\n    }\n  }\n\n  const getResultColor = () => {\n    switch (result) {\n      case Result.WIN:\n        return 'success'\n      case Result.LOSE:\n        return 'failure'\n      case Result.CANCELED:\n      case Result.HOUSE:\n      default:\n        return 'text'\n    }\n  }\n\n  const handleSuccess = async () => {\n    // We have to mark the bet as claimed immediately because it does not update fast enough\n    dispatch(markAsCollected({ [bet.round.epoch]: true }))\n    dispatch(fetchLedgerData({ account, epochs: [bet.round.epoch] }))\n  }\n\n  return (\n    <>\n      <Flex alignItems=\"center\" justifyContent=\"space-between\" mb=\"8px\">\n        <Heading>{t('Your History')}</Heading>\n        <Flex alignItems=\"center\">\n          <Heading as=\"h3\" color={getHeaderColor()} textTransform=\"uppercase\" bold mr=\"4px\">\n            {getHeaderText()}\n          </Heading>\n          {getHeaderIcon()}\n        </Flex>\n      </Flex>\n      <StyledBetResult>\n        {result === Result.WIN && !canClaim && (\n          <CollectWinningsButton hasClaimed={!canClaim} width=\"100%\" mb=\"16px\" onSuccess={handleSuccess}>\n            {bet.claimed ? t('Already Collected') : t('Collect Winnings')}\n          </CollectWinningsButton>\n        )}\n        {bet.claimed && bet.claimedHash && (\n          <Flex justifyContent=\"center\">\n            <LinkExternal href={getBscScanLink(bet.claimedHash, 'transaction')} mb=\"16px\">\n              {t('View on BscScan')}\n            </LinkExternal>\n          </Flex>\n        )}\n        {result === Result.CANCELED && isRefundable && (\n          <ReclaimPositionButton epoch={bet.round.epoch} width=\"100%\" mb=\"16px\" />\n        )}\n        <Flex alignItems=\"center\" justifyContent=\"space-between\" mb=\"16px\">\n          <Text>{t('Your direction')}:</Text>\n          <PositionTag betPosition={bet.position}>\n            {bet.position === BetPosition.BULL ? t('Up') : t('Down')}\n          </PositionTag>\n        </Flex>\n        <Flex alignItems=\"center\" justifyContent=\"space-between\" mb=\"16px\">\n          <Text>{t('Your position')}</Text>\n          <Text>{`${formatBnb(bet.amount)} BNB`}</Text>\n        </Flex>\n        <Flex alignItems=\"start\" justifyContent=\"space-between\">\n          <Text bold>{isWinner ? t('Your winnings') : t('Your Result')}:</Text>\n          <Box style={{ textAlign: 'right' }}>\n            <Text bold color={getResultColor()}>{`${isWinner ? '+' : '-'}${formatBnb(payout)} BNB`}</Text>\n            <Text fontSize=\"12px\" color=\"textSubtle\">\n              {`~$${totalPayout.toFixed(2)}`}\n            </Text>\n          </Box>\n        </Flex>\n        {isWinner && (\n          <>\n            <Divider />\n            <Flex alignItems=\"start\" justifyContent=\"space-between\">\n              <Text fontSize=\"14px\" color=\"textSubtle\">\n                {t('Amount to collect')}:\n              </Text>\n              <Flex justifyContent=\"end\">\n                <Text fontSize=\"14px\" color=\"textSubtle\">{`${formatBnb(returned)} BNB`}</Text>\n                <span ref={targetRef}>\n                  <InfoIcon color=\"textSubtle\" ml=\"4px\" />\n                </span>\n              </Flex>\n              {tooltipVisible && tooltip}\n            </Flex>\n          </>\n        )}\n      </StyledBetResult>\n    </>\n  )\n}\n\nexport default BetResult\n"]},"metadata":{},"sourceType":"module"}