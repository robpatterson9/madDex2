{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React from'react';import{Modal,Flex,Text}from'@pancakeswap/uikit';import{formatUnits}from'@ethersproject/units';import{useAppDispatch}from'state';import{useTranslation}from'contexts/Localization';import{useCake,useProfile}from'hooks/useContract';import useApproveConfirmTransaction from'hooks/useApproveConfirmTransaction';import{fetchProfile}from'state/profile';import useToast from'hooks/useToast';import{useCallWithGasPrice}from'hooks/useCallWithGasPrice';import{ToastDescriptionWithTx}from'components/Toast';import ApproveConfirmButtons from'components/ApproveConfirmButtons';import{REGISTER_COST}from'./config';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ConfirmProfileCreationModal=function ConfirmProfileCreationModal(_ref){var account=_ref.account,teamId=_ref.teamId,selectedNft=_ref.selectedNft,minimumCakeRequired=_ref.minimumCakeRequired,allowance=_ref.allowance,onDismiss=_ref.onDismiss;var _useTranslation=useTranslation(),t=_useTranslation.t;var profileContract=useProfile();var dispatch=useAppDispatch();var _useToast=useToast(),toastSuccess=_useToast.toastSuccess;var cakeContract=useCake();var _useCallWithGasPrice=useCallWithGasPrice(),callWithGasPrice=_useCallWithGasPrice.callWithGasPrice;var _useApproveConfirmTra=useApproveConfirmTransaction({onRequiresApproval:function(){var _onRequiresApproval=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return cakeContract.allowance(account,profileContract.address);case 3:response=_context.sent;return _context.abrupt(\"return\",response.gte(minimumCakeRequired));case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",false);case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));function onRequiresApproval(){return _onRequiresApproval.apply(this,arguments);}return onRequiresApproval;}(),onApprove:function onApprove(){return callWithGasPrice(cakeContract,'approve',[profileContract.address,allowance.toJSON()]);},onConfirm:function onConfirm(){return callWithGasPrice(profileContract,'createProfile',[teamId,selectedNft.collectionAddress,selectedNft.tokenId]);},onSuccess:function(){var _onSuccess=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref2){var receipt;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:receipt=_ref2.receipt;_context2.next=3;return dispatch(fetchProfile(account));case 3:onDismiss();toastSuccess(t('Profile created!'),/*#__PURE__*/_jsx(ToastDescriptionWithTx,{txHash:receipt.transactionHash}));case 5:case\"end\":return _context2.stop();}}},_callee2);}));function onSuccess(_x){return _onSuccess.apply(this,arguments);}return onSuccess;}()}),isApproving=_useApproveConfirmTra.isApproving,isApproved=_useApproveConfirmTra.isApproved,isConfirmed=_useApproveConfirmTra.isConfirmed,isConfirming=_useApproveConfirmTra.isConfirming,handleApprove=_useApproveConfirmTra.handleApprove,handleConfirm=_useApproveConfirmTra.handleConfirm;return/*#__PURE__*/_jsxs(Modal,{title:t('Complete Profile'),onDismiss:onDismiss,children:[/*#__PURE__*/_jsx(Text,{color:\"textSubtle\",mb:\"8px\",children:t('Submitting NFT to contract and confirming User Name and Team.')}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",mb:\"16px\",children:[/*#__PURE__*/_jsx(Text,{children:t('Cost')}),/*#__PURE__*/_jsx(Text,{children:t('%num% CAKE',{num:formatUnits(REGISTER_COST)})})]}),/*#__PURE__*/_jsx(ApproveConfirmButtons,{isApproveDisabled:isConfirmed||isConfirming||isApproved,isApproving:isApproving,isConfirmDisabled:!isApproved||isConfirmed,isConfirming:isConfirming,onApprove:handleApprove,onConfirm:handleConfirm})]});};export default ConfirmProfileCreationModal;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/views/ProfileCreation/ConfirmProfileCreationModal.tsx"],"names":["React","Modal","Flex","Text","formatUnits","useAppDispatch","useTranslation","useCake","useProfile","useApproveConfirmTransaction","fetchProfile","useToast","useCallWithGasPrice","ToastDescriptionWithTx","ApproveConfirmButtons","REGISTER_COST","ConfirmProfileCreationModal","account","teamId","selectedNft","minimumCakeRequired","allowance","onDismiss","t","profileContract","dispatch","toastSuccess","cakeContract","callWithGasPrice","onRequiresApproval","address","response","gte","onApprove","toJSON","onConfirm","collectionAddress","tokenId","onSuccess","receipt","transactionHash","isApproving","isApproved","isConfirmed","isConfirming","handleApprove","handleConfirm","num"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Modal, Flex, Text } from '@pancakeswap/uikit'\nimport { ethers } from 'ethers'\nimport { formatUnits } from '@ethersproject/units'\nimport { useAppDispatch } from 'state'\nimport { useTranslation } from 'contexts/Localization'\nimport { useCake, useProfile } from 'hooks/useContract'\nimport useApproveConfirmTransaction from 'hooks/useApproveConfirmTransaction'\nimport { fetchProfile } from 'state/profile'\nimport useToast from 'hooks/useToast'\nimport { useCallWithGasPrice } from 'hooks/useCallWithGasPrice'\nimport { ToastDescriptionWithTx } from 'components/Toast'\nimport ApproveConfirmButtons from 'components/ApproveConfirmButtons'\nimport { REGISTER_COST } from './config'\nimport { State } from './contexts/types'\n\ninterface Props {\n  userName: string\n  selectedNft: State['selectedNft']\n  account: string\n  teamId: number\n  minimumCakeRequired: ethers.BigNumber\n  allowance: ethers.BigNumber\n  onDismiss?: () => void\n}\n\nconst ConfirmProfileCreationModal: React.FC<Props> = ({\n  account,\n  teamId,\n  selectedNft,\n  minimumCakeRequired,\n  allowance,\n  onDismiss,\n}) => {\n  const { t } = useTranslation()\n  const profileContract = useProfile()\n  const dispatch = useAppDispatch()\n  const { toastSuccess } = useToast()\n  const cakeContract = useCake()\n  const { callWithGasPrice } = useCallWithGasPrice()\n\n  const { isApproving, isApproved, isConfirmed, isConfirming, handleApprove, handleConfirm } =\n    useApproveConfirmTransaction({\n      onRequiresApproval: async () => {\n        try {\n          const response = await cakeContract.allowance(account, profileContract.address)\n          return response.gte(minimumCakeRequired)\n        } catch (error) {\n          return false\n        }\n      },\n      onApprove: () => {\n        return callWithGasPrice(cakeContract, 'approve', [profileContract.address, allowance.toJSON()])\n      },\n      onConfirm: () => {\n        return callWithGasPrice(profileContract, 'createProfile', [\n          teamId,\n          selectedNft.collectionAddress,\n          selectedNft.tokenId,\n        ])\n      },\n      onSuccess: async ({ receipt }) => {\n        await dispatch(fetchProfile(account))\n        onDismiss()\n        toastSuccess(t('Profile created!'), <ToastDescriptionWithTx txHash={receipt.transactionHash} />)\n      },\n    })\n\n  return (\n    <Modal title={t('Complete Profile')} onDismiss={onDismiss}>\n      <Text color=\"textSubtle\" mb=\"8px\">\n        {t('Submitting NFT to contract and confirming User Name and Team.')}\n      </Text>\n      <Flex justifyContent=\"space-between\" mb=\"16px\">\n        <Text>{t('Cost')}</Text>\n        <Text>{t('%num% CAKE', { num: formatUnits(REGISTER_COST) })}</Text>\n      </Flex>\n      <ApproveConfirmButtons\n        isApproveDisabled={isConfirmed || isConfirming || isApproved}\n        isApproving={isApproving}\n        isConfirmDisabled={!isApproved || isConfirmed}\n        isConfirming={isConfirming}\n        onApprove={handleApprove}\n        onConfirm={handleConfirm}\n      />\n    </Modal>\n  )\n}\n\nexport default ConfirmProfileCreationModal\n"]},"metadata":{},"sourceType":"module"}