{"ast":null,"code":"import _objectSpread from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectWithoutProperties from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";var _excluded=[\"data\",\"setValue\",\"setLabel\"];import React,{useRef,useState,useEffect,useCallback}from'react';import{createChart}from'lightweight-charts';import{format}from'date-fns';import useTheme from'hooks/useTheme';import{CandleChartLoader}from'views/Info/components/ChartLoaders';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CANDLE_CHART_HEIGHT=250;var CandleChart=function CandleChart(_ref){var data=_ref.data,setValue=_ref.setValue,setLabel=_ref.setLabel,rest=_objectWithoutProperties(_ref,_excluded);var _useTheme=useTheme(),theme=_useTheme.theme;var chartRef=useRef(null);var _useState=useState(),_useState2=_slicedToArray(_useState,2),chartCreated=_useState2[0],setChart=_useState2[1];var handleResize=useCallback(function(){var _chartRef$current;if(chartCreated&&(chartRef===null||chartRef===void 0?void 0:(_chartRef$current=chartRef.current)===null||_chartRef$current===void 0?void 0:_chartRef$current.parentElement)){chartCreated.resize(chartRef.current.parentElement.clientWidth-32,CANDLE_CHART_HEIGHT);chartCreated.timeScale().fitContent();chartCreated.timeScale().scrollToPosition(0,false);}},[chartCreated,chartRef]);// add event listener for resize\nvar isClient=typeof window==='object';useEffect(function(){if(!isClient){return null;}window.addEventListener('resize',handleResize);return function(){return window.removeEventListener('resize',handleResize);};},[isClient,chartRef,handleResize]);// Empty array ensures that effect is only run on mount and unmount\n// if chart not instantiated in canvas, create it\nuseEffect(function(){var _chartRef$current2;if(!chartCreated&&data&&!!(chartRef===null||chartRef===void 0?void 0:(_chartRef$current2=chartRef.current)===null||_chartRef$current2===void 0?void 0:_chartRef$current2.parentElement)){var chart=createChart(chartRef.current,{height:CANDLE_CHART_HEIGHT,width:chartRef.current.parentElement.clientWidth-32,layout:{backgroundColor:'transparent',textColor:theme.colors.textSubtle,fontFamily:'Kanit, sans-serif',fontSize:12},rightPriceScale:{scaleMargins:{top:0.1,bottom:0.1},borderVisible:false},timeScale:{borderVisible:false,secondsVisible:true,tickMarkFormatter:function tickMarkFormatter(unixTime){return format(unixTime*1000,'MM/dd h:mm a');}},watermark:{visible:false},grid:{horzLines:{visible:false},vertLines:{visible:false}},crosshair:{horzLine:{visible:false,labelVisible:false},mode:1,vertLine:{visible:true,labelVisible:false,style:3,width:1,color:theme.colors.textSubtle,labelBackgroundColor:theme.colors.primary}}});chart.timeScale().fitContent();setChart(chart);}},[chartCreated,data,setValue,theme]);useEffect(function(){if(chartCreated&&data){var series=chartCreated.addCandlestickSeries({upColor:theme.colors.success,downColor:theme.colors.failure,borderDownColor:theme.colors.failure,borderUpColor:theme.colors.success,wickDownColor:theme.colors.failure,wickUpColor:theme.colors.success});series.setData(data);// update the title when hovering on the chart\nchartCreated.subscribeCrosshairMove(function(param){if((chartRef===null||chartRef===void 0?void 0:chartRef.current)&&(param===undefined||param.time===undefined||param&&param.point&&param.point.x<0||param&&param.point&&param.point.x>chartRef.current.clientWidth||param&&param.point&&param.point.y<0||param&&param.point&&param.point.y>CANDLE_CHART_HEIGHT)){// reset values\nif(setValue)setValue(undefined);if(setLabel)setLabel(undefined);}else if(series&&param){var timestamp=param.time;var now=new Date(timestamp*1000);var utc=new Date(now.getTime()+now.getTimezoneOffset()*60000);var time=\"\".concat(format(utc,'MMM d, yyyy h:mm a'),\" (UTC)\");var parsed=param.seriesPrices.get(series);if(setValue)setValue(parsed===null||parsed===void 0?void 0:parsed.open);if(setLabel)setLabel(time);}});}},[chartCreated,data,setValue,setLabel,theme]);return/*#__PURE__*/_jsxs(_Fragment,{children:[!chartCreated&&/*#__PURE__*/_jsx(CandleChartLoader,{}),/*#__PURE__*/_jsx(\"div\",_objectSpread({ref:chartRef,id:\"candle-chart\"},rest))]});};export default CandleChart;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/views/Info/components/InfoCharts/CandleChart/index.tsx"],"names":["React","useRef","useState","useEffect","useCallback","createChart","format","useTheme","CandleChartLoader","CANDLE_CHART_HEIGHT","CandleChart","data","setValue","setLabel","rest","theme","chartRef","chartCreated","setChart","handleResize","current","parentElement","resize","clientWidth","timeScale","fitContent","scrollToPosition","isClient","window","addEventListener","removeEventListener","chart","height","width","layout","backgroundColor","textColor","colors","textSubtle","fontFamily","fontSize","rightPriceScale","scaleMargins","top","bottom","borderVisible","secondsVisible","tickMarkFormatter","unixTime","watermark","visible","grid","horzLines","vertLines","crosshair","horzLine","labelVisible","mode","vertLine","style","color","labelBackgroundColor","primary","series","addCandlestickSeries","upColor","success","downColor","failure","borderDownColor","borderUpColor","wickDownColor","wickUpColor","setData","subscribeCrosshairMove","param","undefined","time","point","x","y","timestamp","now","Date","utc","getTime","getTimezoneOffset","parsed","seriesPrices","get","open"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect, useCallback, Dispatch, SetStateAction } from 'react'\nimport { createChart, IChartApi } from 'lightweight-charts'\nimport { format } from 'date-fns'\nimport useTheme from 'hooks/useTheme'\nimport { CandleChartLoader } from 'views/Info/components/ChartLoaders'\n\nconst CANDLE_CHART_HEIGHT = 250\n\nexport type LineChartProps = {\n  data: any[]\n  setValue?: Dispatch<SetStateAction<number | undefined>> // used for value on hover\n  setLabel?: Dispatch<SetStateAction<string | undefined>> // used for value label on hover\n} & React.HTMLAttributes<HTMLDivElement>\n\nconst CandleChart = ({ data, setValue, setLabel, ...rest }: LineChartProps) => {\n  const { theme } = useTheme()\n  const chartRef = useRef<HTMLDivElement>(null)\n  const [chartCreated, setChart] = useState<IChartApi | undefined>()\n\n  const handleResize = useCallback(() => {\n    if (chartCreated && chartRef?.current?.parentElement) {\n      chartCreated.resize(chartRef.current.parentElement.clientWidth - 32, CANDLE_CHART_HEIGHT)\n      chartCreated.timeScale().fitContent()\n      chartCreated.timeScale().scrollToPosition(0, false)\n    }\n  }, [chartCreated, chartRef])\n\n  // add event listener for resize\n  const isClient = typeof window === 'object'\n  useEffect(() => {\n    if (!isClient) {\n      return null\n    }\n    window.addEventListener('resize', handleResize)\n    return () => window.removeEventListener('resize', handleResize)\n  }, [isClient, chartRef, handleResize]) // Empty array ensures that effect is only run on mount and unmount\n\n  // if chart not instantiated in canvas, create it\n  useEffect(() => {\n    if (!chartCreated && data && !!chartRef?.current?.parentElement) {\n      const chart = createChart(chartRef.current, {\n        height: CANDLE_CHART_HEIGHT,\n        width: chartRef.current.parentElement.clientWidth - 32,\n        layout: {\n          backgroundColor: 'transparent',\n          textColor: theme.colors.textSubtle,\n          fontFamily: 'Kanit, sans-serif',\n          fontSize: 12,\n        },\n        rightPriceScale: {\n          scaleMargins: {\n            top: 0.1,\n            bottom: 0.1,\n          },\n          borderVisible: false,\n        },\n        timeScale: {\n          borderVisible: false,\n          secondsVisible: true,\n          tickMarkFormatter: (unixTime: number) => {\n            return format(unixTime * 1000, 'MM/dd h:mm a')\n          },\n        },\n        watermark: {\n          visible: false,\n        },\n        grid: {\n          horzLines: {\n            visible: false,\n          },\n          vertLines: {\n            visible: false,\n          },\n        },\n        crosshair: {\n          horzLine: {\n            visible: false,\n            labelVisible: false,\n          },\n          mode: 1,\n          vertLine: {\n            visible: true,\n            labelVisible: false,\n            style: 3,\n            width: 1,\n            color: theme.colors.textSubtle,\n            labelBackgroundColor: theme.colors.primary,\n          },\n        },\n      })\n\n      chart.timeScale().fitContent()\n      setChart(chart)\n    }\n  }, [chartCreated, data, setValue, theme])\n\n  useEffect(() => {\n    if (chartCreated && data) {\n      const series = chartCreated.addCandlestickSeries({\n        upColor: theme.colors.success,\n        downColor: theme.colors.failure,\n        borderDownColor: theme.colors.failure,\n        borderUpColor: theme.colors.success,\n        wickDownColor: theme.colors.failure,\n        wickUpColor: theme.colors.success,\n      })\n\n      series.setData(data)\n\n      // update the title when hovering on the chart\n      chartCreated.subscribeCrosshairMove((param) => {\n        if (\n          chartRef?.current &&\n          (param === undefined ||\n            param.time === undefined ||\n            (param && param.point && param.point.x < 0) ||\n            (param && param.point && param.point.x > chartRef.current.clientWidth) ||\n            (param && param.point && param.point.y < 0) ||\n            (param && param.point && param.point.y > CANDLE_CHART_HEIGHT))\n        ) {\n          // reset values\n          if (setValue) setValue(undefined)\n          if (setLabel) setLabel(undefined)\n        } else if (series && param) {\n          const timestamp = param.time as number\n          const now = new Date(timestamp * 1000)\n          const utc = new Date(now.getTime() + now.getTimezoneOffset() * 60000)\n          const time = `${format(utc, 'MMM d, yyyy h:mm a')} (UTC)`\n          const parsed = param.seriesPrices.get(series) as { open: number } | undefined\n          if (setValue) setValue(parsed?.open)\n          if (setLabel) setLabel(time)\n        }\n      })\n    }\n  }, [chartCreated, data, setValue, setLabel, theme])\n\n  return (\n    <>\n      {!chartCreated && <CandleChartLoader />}\n      <div ref={chartRef} id=\"candle-chart\" {...rest} />\n    </>\n  )\n}\n\nexport default CandleChart\n"]},"metadata":{},"sourceType":"module"}