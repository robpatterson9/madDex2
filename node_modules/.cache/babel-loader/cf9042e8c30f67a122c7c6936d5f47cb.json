{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject;import React,{useState,useCallback}from'react';import styled from'styled-components';import{Button,useModal,IconButton,AddIcon,MinusIcon,Skeleton,Text,Heading}from'@pancakeswap/uikit';import{useLocation}from'react-router-dom';import{BigNumber}from'bignumber.js';import ConnectWalletButton from'components/ConnectWalletButton';import Balance from'components/Balance';import{useWeb3React}from'@web3-react/core';import{useFarmUser,useLpTokenPrice,usePriceCakeBusd}from'state/farms/hooks';import{fetchFarmUserDataAsync}from'state/farms';import{useTranslation}from'contexts/Localization';import{useERC20}from'hooks/useContract';import{BASE_ADD_LIQUIDITY_URL}from'config';import{useAppDispatch}from'state';import{getAddress}from'utils/addressHelpers';import getLiquidityUrlPathParts from'utils/getLiquidityUrlPathParts';import{getBalanceAmount,getBalanceNumber,getFullDisplayBalance}from'utils/formatBalance';import useUnstakeFarms from'../../../hooks/useUnstakeFarms';import DepositModal from'../../DepositModal';import WithdrawModal from'../../WithdrawModal';import useStakeFarms from'../../../hooks/useStakeFarms';import useApproveFarm from'../../../hooks/useApproveFarm';import{ActionContainer,ActionTitles,ActionContent}from'./styles';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var IconButtonWrapper=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  display: flex;\\n\"])));var Staked=function Staked(_ref){var pid=_ref.pid,apr=_ref.apr,multiplier=_ref.multiplier,lpSymbol=_ref.lpSymbol,lpLabel=_ref.lpLabel,lpAddresses=_ref.lpAddresses,quoteToken=_ref.quoteToken,token=_ref.token,userDataReady=_ref.userDataReady,displayApr=_ref.displayApr;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),requestedApproval=_useState2[0],setRequestedApproval=_useState2[1];var _useFarmUser=useFarmUser(pid),allowance=_useFarmUser.allowance,tokenBalance=_useFarmUser.tokenBalance,stakedBalance=_useFarmUser.stakedBalance;var _useStakeFarms=useStakeFarms(pid),onStake=_useStakeFarms.onStake;var _useUnstakeFarms=useUnstakeFarms(pid),onUnstake=_useUnstakeFarms.onUnstake;var location=useLocation();var lpPrice=useLpTokenPrice(lpSymbol);var cakePrice=usePriceCakeBusd();var isApproved=account&&allowance&&allowance.isGreaterThan(0);var lpAddress=getAddress(lpAddresses);var liquidityUrlPathParts=getLiquidityUrlPathParts({quoteTokenAddress:quoteToken.address,tokenAddress:token.address});var addLiquidityUrl=\"\".concat(BASE_ADD_LIQUIDITY_URL,\"/\").concat(liquidityUrlPathParts);var handleStake=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(amount){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return onStake(amount);case 2:dispatch(fetchFarmUserDataAsync({account:account,pids:[pid]}));case 3:case\"end\":return _context.stop();}}},_callee);}));return function handleStake(_x){return _ref2.apply(this,arguments);};}();var handleUnstake=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(amount){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return onUnstake(amount);case 2:dispatch(fetchFarmUserDataAsync({account:account,pids:[pid]}));case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleUnstake(_x2){return _ref3.apply(this,arguments);};}();var displayBalance=useCallback(function(){var stakedBalanceBigNumber=getBalanceAmount(stakedBalance);if(stakedBalanceBigNumber.gt(0)&&stakedBalanceBigNumber.lt(0.0000001)){return stakedBalanceBigNumber.toFixed(10,BigNumber.ROUND_DOWN);}if(stakedBalanceBigNumber.gt(0)&&stakedBalanceBigNumber.lt(0.0001)){return getFullDisplayBalance(stakedBalance).toLocaleString();}return stakedBalanceBigNumber.toFixed(3,BigNumber.ROUND_DOWN);},[stakedBalance]);var _useModal=useModal(/*#__PURE__*/_jsx(DepositModal,{max:tokenBalance,lpPrice:lpPrice,lpLabel:lpLabel,apr:apr,displayApr:displayApr,stakedBalance:stakedBalance,onConfirm:handleStake,tokenName:lpSymbol,multiplier:multiplier,addLiquidityUrl:addLiquidityUrl,cakePrice:cakePrice})),_useModal2=_slicedToArray(_useModal,1),onPresentDeposit=_useModal2[0];var _useModal3=useModal(/*#__PURE__*/_jsx(WithdrawModal,{max:stakedBalance,onConfirm:handleUnstake,tokenName:lpSymbol})),_useModal4=_slicedToArray(_useModal3,1),onPresentWithdraw=_useModal4[0];var lpContract=useERC20(lpAddress);var dispatch=useAppDispatch();var _useApproveFarm=useApproveFarm(lpContract),onApprove=_useApproveFarm.onApprove;var handleApprove=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;setRequestedApproval(true);_context3.next=4;return onApprove();case 4:dispatch(fetchFarmUserDataAsync({account:account,pids:[pid]}));setRequestedApproval(false);_context3.next=11;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);console.error(_context3.t0);case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);})),[onApprove,dispatch,account,pid]);if(!account){return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsx(ActionTitles,{children:/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",children:t('Start Farming')})}),/*#__PURE__*/_jsx(ActionContent,{children:/*#__PURE__*/_jsx(ConnectWalletButton,{width:\"100%\"})})]});}if(isApproved){if(stakedBalance.gt(0)){return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsxs(ActionTitles,{children:[/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"secondary\",fontSize:\"12px\",pr:\"4px\",children:lpSymbol}),/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",children:t('Staked')})]}),/*#__PURE__*/_jsxs(ActionContent,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Heading,{children:displayBalance()}),stakedBalance.gt(0)&&lpPrice.gt(0)&&/*#__PURE__*/_jsx(Balance,{fontSize:\"12px\",color:\"textSubtle\",decimals:2,value:getBalanceNumber(lpPrice.times(stakedBalance)),unit:\" USD\",prefix:\"~\"})]}),/*#__PURE__*/_jsxs(IconButtonWrapper,{children:[/*#__PURE__*/_jsx(IconButton,{variant:\"secondary\",onClick:onPresentWithdraw,mr:\"6px\",children:/*#__PURE__*/_jsx(MinusIcon,{color:\"primary\",width:\"14px\"})}),/*#__PURE__*/_jsx(IconButton,{variant:\"secondary\",onClick:onPresentDeposit,disabled:['history','archived'].some(function(item){return location.pathname.includes(item);}),children:/*#__PURE__*/_jsx(AddIcon,{color:\"primary\",width:\"14px\"})})]})]})]});}return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsxs(ActionTitles,{children:[/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",pr:\"4px\",children:t('Stake').toUpperCase()}),/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"secondary\",fontSize:\"12px\",children:lpSymbol})]}),/*#__PURE__*/_jsx(ActionContent,{children:/*#__PURE__*/_jsx(Button,{width:\"100%\",onClick:onPresentDeposit,variant:\"secondary\",disabled:['history','archived'].some(function(item){return location.pathname.includes(item);}),children:t('Stake LP')})})]});}if(!userDataReady){return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsx(ActionTitles,{children:/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",children:t('Start Farming')})}),/*#__PURE__*/_jsx(ActionContent,{children:/*#__PURE__*/_jsx(Skeleton,{width:180,marginBottom:28,marginTop:14})})]});}return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsx(ActionTitles,{children:/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",children:t('Enable Farm')})}),/*#__PURE__*/_jsx(ActionContent,{children:/*#__PURE__*/_jsx(Button,{width:\"100%\",disabled:requestedApproval,onClick:handleApprove,variant:\"secondary\",children:t('Enable')})})]});};export default Staked;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/views/Farms/components/FarmTable/Actions/StakedAction.tsx"],"names":["React","useState","useCallback","styled","Button","useModal","IconButton","AddIcon","MinusIcon","Skeleton","Text","Heading","useLocation","BigNumber","ConnectWalletButton","Balance","useWeb3React","useFarmUser","useLpTokenPrice","usePriceCakeBusd","fetchFarmUserDataAsync","useTranslation","useERC20","BASE_ADD_LIQUIDITY_URL","useAppDispatch","getAddress","getLiquidityUrlPathParts","getBalanceAmount","getBalanceNumber","getFullDisplayBalance","useUnstakeFarms","DepositModal","WithdrawModal","useStakeFarms","useApproveFarm","ActionContainer","ActionTitles","ActionContent","IconButtonWrapper","div","Staked","pid","apr","multiplier","lpSymbol","lpLabel","lpAddresses","quoteToken","token","userDataReady","displayApr","t","account","requestedApproval","setRequestedApproval","allowance","tokenBalance","stakedBalance","onStake","onUnstake","location","lpPrice","cakePrice","isApproved","isGreaterThan","lpAddress","liquidityUrlPathParts","quoteTokenAddress","address","tokenAddress","addLiquidityUrl","handleStake","amount","dispatch","pids","handleUnstake","displayBalance","stakedBalanceBigNumber","gt","lt","toFixed","ROUND_DOWN","toLocaleString","onPresentDeposit","onPresentWithdraw","lpContract","onApprove","handleApprove","console","error","times","some","item","pathname","includes","toUpperCase"],"mappings":"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","sourcesContent":["import React, { useState, useCallback } from 'react'\nimport styled from 'styled-components'\nimport { Button, useModal, IconButton, AddIcon, MinusIcon, Skeleton, Text, Heading } from '@pancakeswap/uikit'\nimport { useLocation } from 'react-router-dom'\nimport { BigNumber } from 'bignumber.js'\nimport ConnectWalletButton from 'components/ConnectWalletButton'\nimport Balance from 'components/Balance'\nimport { useWeb3React } from '@web3-react/core'\nimport { useFarmUser, useLpTokenPrice, usePriceCakeBusd } from 'state/farms/hooks'\nimport { fetchFarmUserDataAsync } from 'state/farms'\nimport { FarmWithStakedValue } from 'views/Farms/components/FarmCard/FarmCard'\nimport { useTranslation } from 'contexts/Localization'\nimport { useERC20 } from 'hooks/useContract'\nimport { BASE_ADD_LIQUIDITY_URL } from 'config'\nimport { useAppDispatch } from 'state'\nimport { getAddress } from 'utils/addressHelpers'\nimport getLiquidityUrlPathParts from 'utils/getLiquidityUrlPathParts'\nimport { getBalanceAmount, getBalanceNumber, getFullDisplayBalance } from 'utils/formatBalance'\nimport useUnstakeFarms from '../../../hooks/useUnstakeFarms'\nimport DepositModal from '../../DepositModal'\nimport WithdrawModal from '../../WithdrawModal'\nimport useStakeFarms from '../../../hooks/useStakeFarms'\nimport useApproveFarm from '../../../hooks/useApproveFarm'\nimport { ActionContainer, ActionTitles, ActionContent } from './styles'\n\nconst IconButtonWrapper = styled.div`\n  display: flex;\n`\n\ninterface StackedActionProps extends FarmWithStakedValue {\n  userDataReady: boolean\n  lpLabel?: string\n  displayApr?: string\n}\n\nconst Staked: React.FunctionComponent<StackedActionProps> = ({\n  pid,\n  apr,\n  multiplier,\n  lpSymbol,\n  lpLabel,\n  lpAddresses,\n  quoteToken,\n  token,\n  userDataReady,\n  displayApr,\n}) => {\n  const { t } = useTranslation()\n  const { account } = useWeb3React()\n  const [requestedApproval, setRequestedApproval] = useState(false)\n  const { allowance, tokenBalance, stakedBalance } = useFarmUser(pid)\n  const { onStake } = useStakeFarms(pid)\n  const { onUnstake } = useUnstakeFarms(pid)\n  const location = useLocation()\n  const lpPrice = useLpTokenPrice(lpSymbol)\n  const cakePrice = usePriceCakeBusd()\n\n  const isApproved = account && allowance && allowance.isGreaterThan(0)\n\n  const lpAddress = getAddress(lpAddresses)\n  const liquidityUrlPathParts = getLiquidityUrlPathParts({\n    quoteTokenAddress: quoteToken.address,\n    tokenAddress: token.address,\n  })\n  const addLiquidityUrl = `${BASE_ADD_LIQUIDITY_URL}/${liquidityUrlPathParts}`\n\n  const handleStake = async (amount: string) => {\n    await onStake(amount)\n    dispatch(fetchFarmUserDataAsync({ account, pids: [pid] }))\n  }\n\n  const handleUnstake = async (amount: string) => {\n    await onUnstake(amount)\n    dispatch(fetchFarmUserDataAsync({ account, pids: [pid] }))\n  }\n\n  const displayBalance = useCallback(() => {\n    const stakedBalanceBigNumber = getBalanceAmount(stakedBalance)\n    if (stakedBalanceBigNumber.gt(0) && stakedBalanceBigNumber.lt(0.0000001)) {\n      return stakedBalanceBigNumber.toFixed(10, BigNumber.ROUND_DOWN)\n    }\n    if (stakedBalanceBigNumber.gt(0) && stakedBalanceBigNumber.lt(0.0001)) {\n      return getFullDisplayBalance(stakedBalance).toLocaleString()\n    }\n    return stakedBalanceBigNumber.toFixed(3, BigNumber.ROUND_DOWN)\n  }, [stakedBalance])\n\n  const [onPresentDeposit] = useModal(\n    <DepositModal\n      max={tokenBalance}\n      lpPrice={lpPrice}\n      lpLabel={lpLabel}\n      apr={apr}\n      displayApr={displayApr}\n      stakedBalance={stakedBalance}\n      onConfirm={handleStake}\n      tokenName={lpSymbol}\n      multiplier={multiplier}\n      addLiquidityUrl={addLiquidityUrl}\n      cakePrice={cakePrice}\n    />,\n  )\n  const [onPresentWithdraw] = useModal(\n    <WithdrawModal max={stakedBalance} onConfirm={handleUnstake} tokenName={lpSymbol} />,\n  )\n  const lpContract = useERC20(lpAddress)\n  const dispatch = useAppDispatch()\n  const { onApprove } = useApproveFarm(lpContract)\n\n  const handleApprove = useCallback(async () => {\n    try {\n      setRequestedApproval(true)\n      await onApprove()\n      dispatch(fetchFarmUserDataAsync({ account, pids: [pid] }))\n\n      setRequestedApproval(false)\n    } catch (e) {\n      console.error(e)\n    }\n  }, [onApprove, dispatch, account, pid])\n\n  if (!account) {\n    return (\n      <ActionContainer>\n        <ActionTitles>\n          <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\">\n            {t('Start Farming')}\n          </Text>\n        </ActionTitles>\n        <ActionContent>\n          <ConnectWalletButton width=\"100%\" />\n        </ActionContent>\n      </ActionContainer>\n    )\n  }\n\n  if (isApproved) {\n    if (stakedBalance.gt(0)) {\n      return (\n        <ActionContainer>\n          <ActionTitles>\n            <Text bold textTransform=\"uppercase\" color=\"secondary\" fontSize=\"12px\" pr=\"4px\">\n              {lpSymbol}\n            </Text>\n            <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\">\n              {t('Staked')}\n            </Text>\n          </ActionTitles>\n          <ActionContent>\n            <div>\n              <Heading>{displayBalance()}</Heading>\n              {stakedBalance.gt(0) && lpPrice.gt(0) && (\n                <Balance\n                  fontSize=\"12px\"\n                  color=\"textSubtle\"\n                  decimals={2}\n                  value={getBalanceNumber(lpPrice.times(stakedBalance))}\n                  unit=\" USD\"\n                  prefix=\"~\"\n                />\n              )}\n            </div>\n            <IconButtonWrapper>\n              <IconButton variant=\"secondary\" onClick={onPresentWithdraw} mr=\"6px\">\n                <MinusIcon color=\"primary\" width=\"14px\" />\n              </IconButton>\n              <IconButton\n                variant=\"secondary\"\n                onClick={onPresentDeposit}\n                disabled={['history', 'archived'].some((item) => location.pathname.includes(item))}\n              >\n                <AddIcon color=\"primary\" width=\"14px\" />\n              </IconButton>\n            </IconButtonWrapper>\n          </ActionContent>\n        </ActionContainer>\n      )\n    }\n\n    return (\n      <ActionContainer>\n        <ActionTitles>\n          <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\" pr=\"4px\">\n            {t('Stake').toUpperCase()}\n          </Text>\n          <Text bold textTransform=\"uppercase\" color=\"secondary\" fontSize=\"12px\">\n            {lpSymbol}\n          </Text>\n        </ActionTitles>\n        <ActionContent>\n          <Button\n            width=\"100%\"\n            onClick={onPresentDeposit}\n            variant=\"secondary\"\n            disabled={['history', 'archived'].some((item) => location.pathname.includes(item))}\n          >\n            {t('Stake LP')}\n          </Button>\n        </ActionContent>\n      </ActionContainer>\n    )\n  }\n\n  if (!userDataReady) {\n    return (\n      <ActionContainer>\n        <ActionTitles>\n          <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\">\n            {t('Start Farming')}\n          </Text>\n        </ActionTitles>\n        <ActionContent>\n          <Skeleton width={180} marginBottom={28} marginTop={14} />\n        </ActionContent>\n      </ActionContainer>\n    )\n  }\n\n  return (\n    <ActionContainer>\n      <ActionTitles>\n        <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\">\n          {t('Enable Farm')}\n        </Text>\n      </ActionTitles>\n      <ActionContent>\n        <Button width=\"100%\" disabled={requestedApproval} onClick={handleApprove} variant=\"secondary\">\n          {t('Enable')}\n        </Button>\n      </ActionContent>\n    </ActionContainer>\n  )\n}\n\nexport default Staked\n"]},"metadata":{},"sourceType":"module"}