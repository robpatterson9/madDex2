{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _slicedToArray from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import{Box,Modal}from'@pancakeswap/uikit';import{useWeb3React}from'@web3-react/core';import{useTranslation}from'contexts/Localization';import{SnapshotCommand}from'state/types';import{signMessage}from'utils/web3React';import useToast from'hooks/useToast';import useWeb3Provider from'hooks/useActiveWeb3React';import useTheme from'hooks/useTheme';import{ConfirmVoteView}from'./types';import MainView from'./MainView';import DetailsView from'./DetailsView';import{generatePayloadData,sendSnapshotData}from'../../helpers';import useGetVotingPower from'../../hooks/useGetVotingPower';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CastVoteModal=function CastVoteModal(_ref){var _title;var onSuccess=_ref.onSuccess,proposalId=_ref.proposalId,vote=_ref.vote,block=_ref.block,onDismiss=_ref.onDismiss;var _useState=useState(ConfirmVoteView.MAIN),_useState2=_slicedToArray(_useState,2),view=_useState2[0],setView=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),modalIsOpen=_useState4[0],setModalIsOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isPending=_useState6[0],setIsPending=_useState6[1];var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useToast=useToast(),toastError=_useToast.toastError;var _useWeb3Provider=useWeb3Provider(),library=_useWeb3Provider.library;var _useTheme=useTheme(),theme=_useTheme.theme;var _useGetVotingPower=useGetVotingPower(block,modalIsOpen),isLoading=_useGetVotingPower.isLoading,total=_useGetVotingPower.total,cakeBalance=_useGetVotingPower.cakeBalance,cakeVaultBalance=_useGetVotingPower.cakeVaultBalance,cakePoolBalance=_useGetVotingPower.cakePoolBalance,poolsBalance=_useGetVotingPower.poolsBalance,cakeBnbLpBalance=_useGetVotingPower.cakeBnbLpBalance,verificationHash=_useGetVotingPower.verificationHash;var isStartView=view===ConfirmVoteView.MAIN;var handleBack=isStartView?null:function(){return setView(ConfirmVoteView.MAIN);};var handleViewDetails=function handleViewDetails(){return setView(ConfirmVoteView.DETAILS);};var title=(_title={},_defineProperty(_title,ConfirmVoteView.MAIN,t('Confirm Vote')),_defineProperty(_title,ConfirmVoteView.DETAILS,t('Voting Power')),_title);var handleDismiss=function handleDismiss(){setModalIsOpen(false);onDismiss();};var handleConfirmVote=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var voteMsg,sig,msg;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setIsPending(true);voteMsg=JSON.stringify(_objectSpread(_objectSpread({},generatePayloadData()),{},{type:SnapshotCommand.VOTE,payload:{proposal:proposalId,choice:vote.value,metadata:{votingPower:total.toString(),verificationHash:verificationHash}}}));_context.next=5;return signMessage(library,account,voteMsg);case 5:sig=_context.sent;msg={address:account,msg:voteMsg,sig:sig};// Save proposal to snapshot\n_context.next=9;return sendSnapshotData(msg);case 9:setIsPending(false);_context.next=12;return onSuccess();case 12:handleDismiss();_context.next=20;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](0);setIsPending(false);toastError(t('Error'),_context.t0===null||_context.t0===void 0?void 0:_context.t0.message);console.error(_context.t0);case 20:case\"end\":return _context.stop();}}},_callee,null,[[0,15]]);}));return function handleConfirmVote(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(Modal,{title:title[view],onBack:handleBack,onDismiss:onDismiss,hideCloseButton:!isStartView,headerBackground:theme.colors.gradients.cardHeader,children:/*#__PURE__*/_jsxs(Box,{mb:\"24px\",width:\"320px\",children:[view===ConfirmVoteView.MAIN&&/*#__PURE__*/_jsx(MainView,{vote:vote,isLoading:isLoading,isPending:isPending,total:total,onConfirm:handleConfirmVote,onViewDetails:handleViewDetails,onDismiss:handleDismiss}),view===ConfirmVoteView.DETAILS&&/*#__PURE__*/_jsx(DetailsView,{total:total,cakeBalance:cakeBalance,cakeVaultBalance:cakeVaultBalance,cakePoolBalance:cakePoolBalance,poolsBalance:poolsBalance,cakeBnbLpBalance:cakeBnbLpBalance})]})});};export default CastVoteModal;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/views/Voting/components/CastVoteModal/index.tsx"],"names":["React","useState","Box","Modal","useWeb3React","useTranslation","SnapshotCommand","signMessage","useToast","useWeb3Provider","useTheme","ConfirmVoteView","MainView","DetailsView","generatePayloadData","sendSnapshotData","useGetVotingPower","CastVoteModal","onSuccess","proposalId","vote","block","onDismiss","MAIN","view","setView","modalIsOpen","setModalIsOpen","isPending","setIsPending","account","t","toastError","library","theme","isLoading","total","cakeBalance","cakeVaultBalance","cakePoolBalance","poolsBalance","cakeBnbLpBalance","verificationHash","isStartView","handleBack","handleViewDetails","DETAILS","title","handleDismiss","handleConfirmVote","voteMsg","JSON","stringify","type","VOTE","payload","proposal","choice","value","metadata","votingPower","toString","sig","msg","address","message","console","error","colors","gradients","cardHeader"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\nimport { Box, Modal } from '@pancakeswap/uikit'\nimport { useWeb3React } from '@web3-react/core'\nimport { useTranslation } from 'contexts/Localization'\nimport { SnapshotCommand } from 'state/types'\nimport { signMessage } from 'utils/web3React'\nimport useToast from 'hooks/useToast'\nimport useWeb3Provider from 'hooks/useActiveWeb3React'\nimport useTheme from 'hooks/useTheme'\nimport { CastVoteModalProps, ConfirmVoteView } from './types'\nimport MainView from './MainView'\nimport DetailsView from './DetailsView'\nimport { generatePayloadData, Message, sendSnapshotData } from '../../helpers'\nimport useGetVotingPower from '../../hooks/useGetVotingPower'\n\nconst CastVoteModal: React.FC<CastVoteModalProps> = ({ onSuccess, proposalId, vote, block, onDismiss }) => {\n  const [view, setView] = useState<ConfirmVoteView>(ConfirmVoteView.MAIN)\n  const [modalIsOpen, setModalIsOpen] = useState(true)\n  const [isPending, setIsPending] = useState(false)\n  const { account } = useWeb3React()\n  const { t } = useTranslation()\n  const { toastError } = useToast()\n  const { library } = useWeb3Provider()\n  const { theme } = useTheme()\n  const {\n    isLoading,\n    total,\n    cakeBalance,\n    cakeVaultBalance,\n    cakePoolBalance,\n    poolsBalance,\n    cakeBnbLpBalance,\n    verificationHash,\n  } = useGetVotingPower(block, modalIsOpen)\n\n  const isStartView = view === ConfirmVoteView.MAIN\n  const handleBack = isStartView ? null : () => setView(ConfirmVoteView.MAIN)\n  const handleViewDetails = () => setView(ConfirmVoteView.DETAILS)\n\n  const title = {\n    [ConfirmVoteView.MAIN]: t('Confirm Vote'),\n    [ConfirmVoteView.DETAILS]: t('Voting Power'),\n  }\n\n  const handleDismiss = () => {\n    setModalIsOpen(false)\n    onDismiss()\n  }\n\n  const handleConfirmVote = async () => {\n    try {\n      setIsPending(true)\n      const voteMsg = JSON.stringify({\n        ...generatePayloadData(),\n        type: SnapshotCommand.VOTE,\n        payload: {\n          proposal: proposalId,\n          choice: vote.value,\n          metadata: {\n            votingPower: total.toString(),\n            verificationHash,\n          },\n        },\n      })\n\n      const sig = await signMessage(library, account, voteMsg)\n      const msg: Message = { address: account, msg: voteMsg, sig }\n\n      // Save proposal to snapshot\n      await sendSnapshotData(msg)\n      setIsPending(false)\n\n      await onSuccess()\n\n      handleDismiss()\n    } catch (error) {\n      setIsPending(false)\n      toastError(t('Error'), error?.message)\n      console.error(error)\n    }\n  }\n\n  return (\n    <Modal\n      title={title[view]}\n      onBack={handleBack}\n      onDismiss={onDismiss}\n      hideCloseButton={!isStartView}\n      headerBackground={theme.colors.gradients.cardHeader}\n    >\n      <Box mb=\"24px\" width=\"320px\">\n        {view === ConfirmVoteView.MAIN && (\n          <MainView\n            vote={vote}\n            isLoading={isLoading}\n            isPending={isPending}\n            total={total}\n            onConfirm={handleConfirmVote}\n            onViewDetails={handleViewDetails}\n            onDismiss={handleDismiss}\n          />\n        )}\n        {view === ConfirmVoteView.DETAILS && (\n          <DetailsView\n            total={total}\n            cakeBalance={cakeBalance}\n            cakeVaultBalance={cakeVaultBalance}\n            cakePoolBalance={cakePoolBalance}\n            poolsBalance={poolsBalance}\n            cakeBnbLpBalance={cakeBnbLpBalance}\n          />\n        )}\n      </Box>\n    </Modal>\n  )\n}\n\nexport default CastVoteModal\n"]},"metadata":{},"sourceType":"module"}