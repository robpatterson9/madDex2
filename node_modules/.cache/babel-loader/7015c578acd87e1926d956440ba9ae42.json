{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import{useWeb3React}from'@web3-react/core';import{getActivePools}from'utils/calls';import{getAddress}from'utils/addressHelpers';import{simpleRpcProvider}from'utils/providers';import{getVotingPower}from'../helpers';var initialState={verificationHash:null,cakeBalance:0,cakeVaultBalance:0,cakePoolBalance:0,poolsBalance:0,cakeBnbLpBalance:0,total:0};var useGetVotingPower=function useGetVotingPower(block){var isActive=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var _useState=useState(initialState),_useState2=_slicedToArray(_useState,2),votingPower=_useState2[0],setVotingPower=_useState2[1];var _useState3=useState(!!account),_useState4=_slicedToArray(_useState3,2),isLoading=_useState4[0],setIsLoading=_useState4[1];useEffect(function(){var fetchVotingPower=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var blockNumber,eligiblePools,poolAddresses,_yield$getVotingPower,cakeBalance,cakeBnbLpBalance,cakePoolBalance,total,poolsBalance,cakeVaultBalance,verificationHash;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsLoading(true);_context.prev=1;_context.t0=block;if(_context.t0){_context.next=7;break;}_context.next=6;return simpleRpcProvider.getBlockNumber();case 6:_context.t0=_context.sent;case 7:blockNumber=_context.t0;_context.next=10;return getActivePools(blockNumber);case 10:eligiblePools=_context.sent;poolAddresses=eligiblePools.map(function(_ref2){var contractAddress=_ref2.contractAddress;return getAddress(contractAddress);});_context.next=14;return getVotingPower(account,poolAddresses,blockNumber);case 14:_yield$getVotingPower=_context.sent;cakeBalance=_yield$getVotingPower.cakeBalance;cakeBnbLpBalance=_yield$getVotingPower.cakeBnbLpBalance;cakePoolBalance=_yield$getVotingPower.cakePoolBalance;total=_yield$getVotingPower.total;poolsBalance=_yield$getVotingPower.poolsBalance;cakeVaultBalance=_yield$getVotingPower.cakeVaultBalance;verificationHash=_yield$getVotingPower.verificationHash;if(isActive){setVotingPower(function(prevVotingPower){return _objectSpread(_objectSpread({},prevVotingPower),{},{verificationHash:verificationHash,cakeBalance:parseFloat(cakeBalance),cakeBnbLpBalance:parseFloat(cakeBnbLpBalance),cakePoolBalance:parseFloat(cakePoolBalance),poolsBalance:parseFloat(poolsBalance),cakeVaultBalance:parseFloat(cakeVaultBalance),total:parseFloat(total)});});}case 23:_context.prev=23;setIsLoading(false);return _context.finish(23);case 26:case\"end\":return _context.stop();}}},_callee,null,[[1,,23,26]]);}));return function fetchVotingPower(){return _ref.apply(this,arguments);};}();if(account&&isActive){fetchVotingPower();}},[account,block,setVotingPower,isActive,setIsLoading]);return _objectSpread(_objectSpread({},votingPower),{},{isLoading:isLoading});};export default useGetVotingPower;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/views/Voting/hooks/useGetVotingPower.tsx"],"names":["useState","useEffect","useWeb3React","getActivePools","getAddress","simpleRpcProvider","getVotingPower","initialState","verificationHash","cakeBalance","cakeVaultBalance","cakePoolBalance","poolsBalance","cakeBnbLpBalance","total","useGetVotingPower","block","isActive","account","votingPower","setVotingPower","isLoading","setIsLoading","fetchVotingPower","getBlockNumber","blockNumber","eligiblePools","poolAddresses","map","contractAddress","prevVotingPower","parseFloat"],"mappings":"4lBAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,OAASC,YAAT,KAA6B,kBAA7B,CACA,OAASC,cAAT,KAA+B,aAA/B,CACA,OAASC,UAAT,KAA2B,sBAA3B,CACA,OAASC,iBAAT,KAAkC,iBAAlC,CACA,OAASC,cAAT,KAA+B,YAA/B,CAYA,GAAMC,CAAAA,YAAmB,CAAG,CAC1BC,gBAAgB,CAAE,IADQ,CAE1BC,WAAW,CAAE,CAFa,CAG1BC,gBAAgB,CAAE,CAHQ,CAI1BC,eAAe,CAAE,CAJS,CAK1BC,YAAY,CAAE,CALY,CAM1BC,gBAAgB,CAAE,CANQ,CAO1BC,KAAK,CAAE,CAPmB,CAA5B,CAUA,GAAMC,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACC,KAAD,CAAqE,IAApDC,CAAAA,QAAoD,2DAAzC,IAAyC,CAC7F,kBAAoBf,YAAY,EAAhC,CAAQgB,OAAR,eAAQA,OAAR,CACA,cAAsClB,QAAQ,CAACO,YAAD,CAA9C,wCAAOY,WAAP,eAAoBC,cAApB,eACA,eAAkCpB,QAAQ,CAAC,CAAC,CAACkB,OAAH,CAA1C,yCAAOG,SAAP,eAAkBC,YAAlB,eAEArB,SAAS,CAAC,UAAM,CACd,GAAMsB,CAAAA,gBAAgB,0FAAG,uSACvBD,YAAY,CAAC,IAAD,CAAZ,CADuB,4BAIDN,KAJC,8DAIeX,CAAAA,iBAAiB,CAACmB,cAAlB,EAJf,yCAIfC,WAJe,oCAKOtB,CAAAA,cAAc,CAACsB,WAAD,CALrB,SAKfC,aALe,eAMfC,aANe,CAMCD,aAAa,CAACE,GAAd,CAAkB,mBAAGC,CAAAA,eAAH,OAAGA,eAAH,OAAyBzB,CAAAA,UAAU,CAACyB,eAAD,CAAnC,EAAlB,CAND,wBAeXvB,CAAAA,cAAc,CAACY,OAAD,CAAUS,aAAV,CAAyBF,WAAzB,CAfH,6CAQnBhB,WARmB,uBAQnBA,WARmB,CASnBI,gBATmB,uBASnBA,gBATmB,CAUnBF,eAVmB,uBAUnBA,eAVmB,CAWnBG,KAXmB,uBAWnBA,KAXmB,CAYnBF,YAZmB,uBAYnBA,YAZmB,CAanBF,gBAbmB,uBAanBA,gBAbmB,CAcnBF,gBAdmB,uBAcnBA,gBAdmB,CAiBrB,GAAIS,QAAJ,CAAc,CACZG,cAAc,CAAC,SAACU,eAAD,wCACVA,eADU,MAEbtB,gBAAgB,CAAhBA,gBAFa,CAGbC,WAAW,CAAEsB,UAAU,CAACtB,WAAD,CAHV,CAIbI,gBAAgB,CAAEkB,UAAU,CAAClB,gBAAD,CAJf,CAKbF,eAAe,CAAEoB,UAAU,CAACpB,eAAD,CALd,CAMbC,YAAY,CAAEmB,UAAU,CAACnB,YAAD,CANX,CAObF,gBAAgB,CAAEqB,UAAU,CAACrB,gBAAD,CAPf,CAQbI,KAAK,CAAEiB,UAAU,CAACjB,KAAD,CARJ,IAAD,CAAd,CAUD,CA5BoB,yBA8BrBQ,YAAY,CAAC,KAAD,CAAZ,CA9BqB,oGAAH,kBAAhBC,CAAAA,gBAAgB,0CAAtB,CAkCA,GAAIL,OAAO,EAAID,QAAf,CAAyB,CACvBM,gBAAgB,GACjB,CACF,CAtCQ,CAsCN,CAACL,OAAD,CAAUF,KAAV,CAAiBI,cAAjB,CAAiCH,QAAjC,CAA2CK,YAA3C,CAtCM,CAAT,CAwCA,sCAAYH,WAAZ,MAAyBE,SAAS,CAATA,SAAzB,GACD,CA9CD,CAgDA,cAAeN,CAAAA,iBAAf","sourcesContent":["import { useState, useEffect } from 'react'\nimport { useWeb3React } from '@web3-react/core'\nimport { getActivePools } from 'utils/calls'\nimport { getAddress } from 'utils/addressHelpers'\nimport { simpleRpcProvider } from 'utils/providers'\nimport { getVotingPower } from '../helpers'\n\ninterface State {\n  verificationHash: string\n  cakeBalance: number\n  cakeVaultBalance: number\n  cakePoolBalance: number\n  poolsBalance: number\n  cakeBnbLpBalance: number\n  total: number\n}\n\nconst initialState: State = {\n  verificationHash: null,\n  cakeBalance: 0,\n  cakeVaultBalance: 0,\n  cakePoolBalance: 0,\n  poolsBalance: 0,\n  cakeBnbLpBalance: 0,\n  total: 0,\n}\n\nconst useGetVotingPower = (block?: number, isActive = true): State & { isLoading: boolean } => {\n  const { account } = useWeb3React()\n  const [votingPower, setVotingPower] = useState(initialState)\n  const [isLoading, setIsLoading] = useState(!!account)\n\n  useEffect(() => {\n    const fetchVotingPower = async () => {\n      setIsLoading(true)\n\n      try {\n        const blockNumber = block || (await simpleRpcProvider.getBlockNumber())\n        const eligiblePools = await getActivePools(blockNumber)\n        const poolAddresses = eligiblePools.map(({ contractAddress }) => getAddress(contractAddress))\n        const {\n          cakeBalance,\n          cakeBnbLpBalance,\n          cakePoolBalance,\n          total,\n          poolsBalance,\n          cakeVaultBalance,\n          verificationHash,\n        } = await getVotingPower(account, poolAddresses, blockNumber)\n\n        if (isActive) {\n          setVotingPower((prevVotingPower) => ({\n            ...prevVotingPower,\n            verificationHash,\n            cakeBalance: parseFloat(cakeBalance),\n            cakeBnbLpBalance: parseFloat(cakeBnbLpBalance),\n            cakePoolBalance: parseFloat(cakePoolBalance),\n            poolsBalance: parseFloat(poolsBalance),\n            cakeVaultBalance: parseFloat(cakeVaultBalance),\n            total: parseFloat(total),\n          }))\n        }\n      } finally {\n        setIsLoading(false)\n      }\n    }\n\n    if (account && isActive) {\n      fetchVotingPower()\n    }\n  }, [account, block, setVotingPower, isActive, setIsLoading])\n\n  return { ...votingPower, isLoading }\n}\n\nexport default useGetVotingPower\n"]},"metadata":{},"sourceType":"module"}