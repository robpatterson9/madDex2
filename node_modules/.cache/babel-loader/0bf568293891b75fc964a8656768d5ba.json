{"ast":null,"code":"import _slicedToArray from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3;import React,{useState}from'react';import styled from'styled-components';import{Card,CardHeader,CardBody,Flex,Heading,Text,Skeleton,Button,useModal,Box,CardFooter,ExpandableLabel}from'@pancakeswap/uikit';import{useWeb3React}from'@web3-react/core';import{LotteryStatus}from'config/constants/types';import{useTranslation}from'contexts/Localization';import{usePriceCakeBusd}from'state/farms/hooks';import{useLottery}from'state/lottery/hooks';import{getBalanceNumber}from'utils/formatBalance';import Balance from'components/Balance';import ViewTicketsModal from'./ViewTicketsModal';import BuyTicketsButton from'./BuyTicketsButton';import{dateTimeOptions}from'../helpers';import RewardBrackets from'./RewardBrackets';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Grid=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  display: grid;\\n  grid-template-columns: auto;\\n\\n  \",\" {\\n    grid-column-gap: 32px;\\n    grid-template-columns: auto 1fr;\\n  }\\n\"])),function(_ref){var theme=_ref.theme;return theme.mediaQueries.md;});var StyledCard=styled(Card)(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  width: 100%;\\n\\n  \",\" {\\n    width: 520px;\\n  }\\n\\n  \",\" {\\n    width: 756px;\\n  }\\n\"])),function(_ref2){var theme=_ref2.theme;return theme.mediaQueries.sm;},function(_ref3){var theme=_ref3.theme;return theme.mediaQueries.md;});var NextDrawWrapper=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  background: \",\";\\n  padding: 24px;\\n\"])),function(_ref4){var theme=_ref4.theme;return theme.colors.background;});var NextDrawCard=function NextDrawCard(){var _userTickets$tickets;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var _useLottery=useLottery(),currentLotteryId=_useLottery.currentLotteryId,isTransitioning=_useLottery.isTransitioning,currentRound=_useLottery.currentRound;var endTime=currentRound.endTime,amountCollectedInCake=currentRound.amountCollectedInCake,userTickets=currentRound.userTickets,status=currentRound.status;var _useModal=useModal(/*#__PURE__*/_jsx(ViewTicketsModal,{roundId:currentLotteryId,roundStatus:status})),_useModal2=_slicedToArray(_useModal,1),onPresentViewTicketsModal=_useModal2[0];var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isExpanded=_useState2[0],setIsExpanded=_useState2[1];var ticketBuyIsDisabled=status!==LotteryStatus.OPEN||isTransitioning;var cakePriceBusd=usePriceCakeBusd();var prizeInBusd=amountCollectedInCake.times(cakePriceBusd);var endTimeMs=parseInt(endTime,10)*1000;var endDate=new Date(endTimeMs);var isLotteryOpen=status===LotteryStatus.OPEN;var userTicketCount=(userTickets===null||userTickets===void 0?void 0:(_userTickets$tickets=userTickets.tickets)===null||_userTickets$tickets===void 0?void 0:_userTickets$tickets.length)||0;var getPrizeBalances=function getPrizeBalances(){if(status===LotteryStatus.CLOSE||status===LotteryStatus.CLAIMABLE){return/*#__PURE__*/_jsxs(Heading,{scale:\"xl\",color:\"secondary\",textAlign:['center',null,null,'left'],children:[t('Calculating'),\"...\"]});}return/*#__PURE__*/_jsxs(_Fragment,{children:[prizeInBusd.isNaN()?/*#__PURE__*/_jsx(Skeleton,{my:\"7px\",height:40,width:160}):/*#__PURE__*/_jsx(Balance,{fontSize:\"40px\",color:\"secondary\",textAlign:['center',null,null,'left'],lineHeight:\"1\",bold:true,prefix:\"~$\",value:getBalanceNumber(prizeInBusd),decimals:0}),prizeInBusd.isNaN()?/*#__PURE__*/_jsx(Skeleton,{my:\"2px\",height:14,width:90}):/*#__PURE__*/_jsx(Balance,{fontSize:\"14px\",color:\"textSubtle\",textAlign:['center',null,null,'left'],unit:\" CAKE\",value:getBalanceNumber(amountCollectedInCake),decimals:0})]});};var getNextDrawId=function getNextDrawId(){if(status===LotteryStatus.OPEN){return\"\".concat(currentLotteryId,\" |\");}if(status===LotteryStatus.PENDING){return'';}return parseInt(currentLotteryId,10)+1;};var getNextDrawDateTime=function getNextDrawDateTime(){if(status===LotteryStatus.OPEN){return\"\".concat(t('Draw'),\": \").concat(endDate.toLocaleString(undefined,dateTimeOptions));}return'';};var ticketRoundText=userTicketCount>1?t('You have %amount% tickets this round',{amount:userTicketCount}):t('You have %amount% ticket this round',{amount:userTicketCount});var _ticketRoundText$spli=ticketRoundText.split(userTicketCount.toString()),_ticketRoundText$spli2=_slicedToArray(_ticketRoundText$spli,2),youHaveText=_ticketRoundText$spli2[0],ticketsThisRoundText=_ticketRoundText$spli2[1];return/*#__PURE__*/_jsxs(StyledCard,{children:[/*#__PURE__*/_jsx(CardHeader,{p:\"16px 24px\",children:/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",children:[/*#__PURE__*/_jsx(Heading,{mr:\"12px\",children:t('Next Draw')}),/*#__PURE__*/_jsxs(Text,{children:[currentLotteryId&&\"#\".concat(getNextDrawId()),\" \",Boolean(endTime)&&getNextDrawDateTime()]})]})}),/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsxs(Grid,{children:[/*#__PURE__*/_jsx(Flex,{justifyContent:['center',null,null,'flex-start'],children:/*#__PURE__*/_jsx(Heading,{children:t('Prize Pot')})}),/*#__PURE__*/_jsx(Flex,{flexDirection:\"column\",mb:\"18px\",children:getPrizeBalances()}),/*#__PURE__*/_jsx(Box,{display:['none',null,null,'flex'],children:/*#__PURE__*/_jsx(Heading,{children:t('Your tickets')})}),/*#__PURE__*/_jsxs(Flex,{flexDirection:['column',null,null,'row'],alignItems:['center',null,null,'flex-start'],children:[isLotteryOpen&&/*#__PURE__*/_jsxs(Flex,{flexDirection:\"column\",mr:[null,null,null,'24px'],alignItems:['center',null,null,'flex-start'],children:[account&&/*#__PURE__*/_jsxs(Flex,{justifyContent:['center',null,null,'flex-start'],children:[/*#__PURE__*/_jsxs(Text,{display:\"inline\",children:[youHaveText,\" \"]}),!userTickets.isLoading?/*#__PURE__*/_jsx(Balance,{value:userTicketCount,decimals:0,display:\"inline\",bold:true,mx:\"4px\"}):/*#__PURE__*/_jsx(Skeleton,{mx:\"4px\",height:20,width:40}),/*#__PURE__*/_jsxs(Text,{display:\"inline\",children:[\" \",ticketsThisRoundText]})]}),!userTickets.isLoading&&userTicketCount>0&&/*#__PURE__*/_jsx(Button,{onClick:onPresentViewTicketsModal,height:\"auto\",width:\"fit-content\",p:\"0\",mb:['32px',null,null,'0'],variant:\"text\",scale:\"sm\",children:t('View your tickets')})]}),/*#__PURE__*/_jsx(BuyTicketsButton,{disabled:ticketBuyIsDisabled,maxWidth:\"280px\"})]})]})}),/*#__PURE__*/_jsxs(CardFooter,{p:\"0\",children:[isExpanded&&/*#__PURE__*/_jsx(NextDrawWrapper,{children:/*#__PURE__*/_jsx(RewardBrackets,{lotteryNodeData:currentRound})}),(status===LotteryStatus.OPEN||status===LotteryStatus.CLOSE)&&/*#__PURE__*/_jsx(Flex,{p:\"8px 24px\",alignItems:\"center\",justifyContent:\"center\",children:/*#__PURE__*/_jsx(ExpandableLabel,{expanded:isExpanded,onClick:function onClick(){return setIsExpanded(!isExpanded);},children:isExpanded?t('Hide'):t('Details')})})]})]});};export default NextDrawCard;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/views/Lottery/components/NextDrawCard.tsx"],"names":["React","useState","styled","Card","CardHeader","CardBody","Flex","Heading","Text","Skeleton","Button","useModal","Box","CardFooter","ExpandableLabel","useWeb3React","LotteryStatus","useTranslation","usePriceCakeBusd","useLottery","getBalanceNumber","Balance","ViewTicketsModal","BuyTicketsButton","dateTimeOptions","RewardBrackets","Grid","div","theme","mediaQueries","md","StyledCard","sm","NextDrawWrapper","colors","background","NextDrawCard","t","account","currentLotteryId","isTransitioning","currentRound","endTime","amountCollectedInCake","userTickets","status","onPresentViewTicketsModal","isExpanded","setIsExpanded","ticketBuyIsDisabled","OPEN","cakePriceBusd","prizeInBusd","times","endTimeMs","parseInt","endDate","Date","isLotteryOpen","userTicketCount","tickets","length","getPrizeBalances","CLOSE","CLAIMABLE","isNaN","getNextDrawId","PENDING","getNextDrawDateTime","toLocaleString","undefined","ticketRoundText","amount","split","toString","youHaveText","ticketsThisRoundText","Boolean","isLoading"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\nimport styled from 'styled-components'\nimport {\n  Card,\n  CardHeader,\n  CardBody,\n  Flex,\n  Heading,\n  Text,\n  Skeleton,\n  Button,\n  useModal,\n  Box,\n  CardFooter,\n  ExpandableLabel,\n} from '@pancakeswap/uikit'\nimport { useWeb3React } from '@web3-react/core'\nimport { LotteryStatus } from 'config/constants/types'\nimport { useTranslation } from 'contexts/Localization'\nimport { usePriceCakeBusd } from 'state/farms/hooks'\nimport { useLottery } from 'state/lottery/hooks'\nimport { getBalanceNumber } from 'utils/formatBalance'\nimport Balance from 'components/Balance'\nimport ViewTicketsModal from './ViewTicketsModal'\nimport BuyTicketsButton from './BuyTicketsButton'\nimport { dateTimeOptions } from '../helpers'\nimport RewardBrackets from './RewardBrackets'\n\nconst Grid = styled.div`\n  display: grid;\n  grid-template-columns: auto;\n\n  ${({ theme }) => theme.mediaQueries.md} {\n    grid-column-gap: 32px;\n    grid-template-columns: auto 1fr;\n  }\n`\n\nconst StyledCard = styled(Card)`\n  width: 100%;\n\n  ${({ theme }) => theme.mediaQueries.sm} {\n    width: 520px;\n  }\n\n  ${({ theme }) => theme.mediaQueries.md} {\n    width: 756px;\n  }\n`\n\nconst NextDrawWrapper = styled.div`\n  background: ${({ theme }) => theme.colors.background};\n  padding: 24px;\n`\n\nconst NextDrawCard = () => {\n  const { t } = useTranslation()\n  const { account } = useWeb3React()\n  const { currentLotteryId, isTransitioning, currentRound } = useLottery()\n  const { endTime, amountCollectedInCake, userTickets, status } = currentRound\n\n  const [onPresentViewTicketsModal] = useModal(<ViewTicketsModal roundId={currentLotteryId} roundStatus={status} />)\n  const [isExpanded, setIsExpanded] = useState(false)\n  const ticketBuyIsDisabled = status !== LotteryStatus.OPEN || isTransitioning\n\n  const cakePriceBusd = usePriceCakeBusd()\n  const prizeInBusd = amountCollectedInCake.times(cakePriceBusd)\n  const endTimeMs = parseInt(endTime, 10) * 1000\n  const endDate = new Date(endTimeMs)\n  const isLotteryOpen = status === LotteryStatus.OPEN\n  const userTicketCount = userTickets?.tickets?.length || 0\n\n  const getPrizeBalances = () => {\n    if (status === LotteryStatus.CLOSE || status === LotteryStatus.CLAIMABLE) {\n      return (\n        <Heading scale=\"xl\" color=\"secondary\" textAlign={['center', null, null, 'left']}>\n          {t('Calculating')}...\n        </Heading>\n      )\n    }\n    return (\n      <>\n        {prizeInBusd.isNaN() ? (\n          <Skeleton my=\"7px\" height={40} width={160} />\n        ) : (\n          <Balance\n            fontSize=\"40px\"\n            color=\"secondary\"\n            textAlign={['center', null, null, 'left']}\n            lineHeight=\"1\"\n            bold\n            prefix=\"~$\"\n            value={getBalanceNumber(prizeInBusd)}\n            decimals={0}\n          />\n        )}\n        {prizeInBusd.isNaN() ? (\n          <Skeleton my=\"2px\" height={14} width={90} />\n        ) : (\n          <Balance\n            fontSize=\"14px\"\n            color=\"textSubtle\"\n            textAlign={['center', null, null, 'left']}\n            unit=\" CAKE\"\n            value={getBalanceNumber(amountCollectedInCake)}\n            decimals={0}\n          />\n        )}\n      </>\n    )\n  }\n\n  const getNextDrawId = () => {\n    if (status === LotteryStatus.OPEN) {\n      return `${currentLotteryId} |`\n    }\n    if (status === LotteryStatus.PENDING) {\n      return ''\n    }\n    return parseInt(currentLotteryId, 10) + 1\n  }\n\n  const getNextDrawDateTime = () => {\n    if (status === LotteryStatus.OPEN) {\n      return `${t('Draw')}: ${endDate.toLocaleString(undefined, dateTimeOptions)}`\n    }\n    return ''\n  }\n\n  const ticketRoundText =\n    userTicketCount > 1\n      ? t('You have %amount% tickets this round', { amount: userTicketCount })\n      : t('You have %amount% ticket this round', { amount: userTicketCount })\n  const [youHaveText, ticketsThisRoundText] = ticketRoundText.split(userTicketCount.toString())\n\n  return (\n    <StyledCard>\n      <CardHeader p=\"16px 24px\">\n        <Flex justifyContent=\"space-between\">\n          <Heading mr=\"12px\">{t('Next Draw')}</Heading>\n          <Text>\n            {currentLotteryId && `#${getNextDrawId()}`} {Boolean(endTime) && getNextDrawDateTime()}\n          </Text>\n        </Flex>\n      </CardHeader>\n      <CardBody>\n        <Grid>\n          <Flex justifyContent={['center', null, null, 'flex-start']}>\n            <Heading>{t('Prize Pot')}</Heading>\n          </Flex>\n          <Flex flexDirection=\"column\" mb=\"18px\">\n            {getPrizeBalances()}\n          </Flex>\n          <Box display={['none', null, null, 'flex']}>\n            <Heading>{t('Your tickets')}</Heading>\n          </Box>\n          <Flex flexDirection={['column', null, null, 'row']} alignItems={['center', null, null, 'flex-start']}>\n            {isLotteryOpen && (\n              <Flex\n                flexDirection=\"column\"\n                mr={[null, null, null, '24px']}\n                alignItems={['center', null, null, 'flex-start']}\n              >\n                {account && (\n                  <Flex justifyContent={['center', null, null, 'flex-start']}>\n                    <Text display=\"inline\">{youHaveText} </Text>\n                    {!userTickets.isLoading ? (\n                      <Balance value={userTicketCount} decimals={0} display=\"inline\" bold mx=\"4px\" />\n                    ) : (\n                      <Skeleton mx=\"4px\" height={20} width={40} />\n                    )}\n                    <Text display=\"inline\"> {ticketsThisRoundText}</Text>\n                  </Flex>\n                )}\n                {!userTickets.isLoading && userTicketCount > 0 && (\n                  <Button\n                    onClick={onPresentViewTicketsModal}\n                    height=\"auto\"\n                    width=\"fit-content\"\n                    p=\"0\"\n                    mb={['32px', null, null, '0']}\n                    variant=\"text\"\n                    scale=\"sm\"\n                  >\n                    {t('View your tickets')}\n                  </Button>\n                )}\n              </Flex>\n            )}\n            <BuyTicketsButton disabled={ticketBuyIsDisabled} maxWidth=\"280px\" />\n          </Flex>\n        </Grid>\n      </CardBody>\n      <CardFooter p=\"0\">\n        {isExpanded && (\n          <NextDrawWrapper>\n            <RewardBrackets lotteryNodeData={currentRound} />\n          </NextDrawWrapper>\n        )}\n        {(status === LotteryStatus.OPEN || status === LotteryStatus.CLOSE) && (\n          <Flex p=\"8px 24px\" alignItems=\"center\" justifyContent=\"center\">\n            <ExpandableLabel expanded={isExpanded} onClick={() => setIsExpanded(!isExpanded)}>\n              {isExpanded ? t('Hide') : t('Details')}\n            </ExpandableLabel>\n          </Flex>\n        )}\n      </CardFooter>\n    </StyledCard>\n  )\n}\n\nexport default NextDrawCard\n"]},"metadata":{},"sourceType":"module"}