{"ast":null,"code":"import _defineProperty from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Volumes/evo970/lou/madDex-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{createAsyncThunk,createSlice}from'@reduxjs/toolkit';import{merge}from'lodash';import{ProposalState,VotingStateLoadingStatus}from'state/types';import{getAllVotes,getProposal,getProposals,getVoteVerificationStatuses}from'./helpers';var initialState={proposalLoadingStatus:VotingStateLoadingStatus.INITIAL,proposals:{},voteLoadingStatus:VotingStateLoadingStatus.INITIAL,votes:{}};// Thunks\nexport var fetchProposals=createAsyncThunk('voting/fetchProposals',/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref){var first,_ref$skip,skip,_ref$state,state,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:first=_ref.first,_ref$skip=_ref.skip,skip=_ref$skip===void 0?0:_ref$skip,_ref$state=_ref.state,state=_ref$state===void 0?ProposalState.ACTIVE:_ref$state;_context.next=3;return getProposals(first,skip,state);case 3:response=_context.sent;return _context.abrupt(\"return\",response);case 5:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());export var fetchProposal=createAsyncThunk('voting/fetchProposal',/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(proposalId){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getProposal(proposalId);case 2:response=_context2.sent;return _context2.abrupt(\"return\",response);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref3.apply(this,arguments);};}());export var fetchVotes=createAsyncThunk('voting/fetchVotes',/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref4){var proposalId,block,response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:proposalId=_ref4.proposalId,block=_ref4.block;_context3.next=3;return getAllVotes(proposalId,block);case 3:response=_context3.sent;return _context3.abrupt(\"return\",{votes:response,proposalId:proposalId});case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref5.apply(this,arguments);};}());export var verifyVotes=createAsyncThunk('voting/verifyVotes',/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_ref6,_ref7){var proposalId,snapshot,getState,state,proposalVotes,response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:proposalId=_ref6.proposalId,snapshot=_ref6.snapshot;getState=_ref7.getState;state=getState();proposalVotes=state.voting.votes[proposalId];_context4.next=6;return getVoteVerificationStatuses(proposalVotes,Number(snapshot));case 6:response=_context4.sent;return _context4.abrupt(\"return\",{results:response,proposalId:proposalId});case 8:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4,_x5){return _ref8.apply(this,arguments);};}());export var votingSlice=createSlice({name:'voting',initialState:initialState,reducers:{},extraReducers:function extraReducers(builder){// Verify Votes\nbuilder.addCase(verifyVotes.fulfilled,function(state,action){var _action$payload=action.payload,proposalId=_action$payload.proposalId,results=_action$payload.results;if(state.votes[proposalId]){state.votes[proposalId]=state.votes[proposalId].map(function(vote){return _objectSpread(_objectSpread({},vote),{},{_inValid:results[vote.id]===false});});}});// Fetch Proposals\nbuilder.addCase(fetchProposals.pending,function(state){state.proposalLoadingStatus=VotingStateLoadingStatus.LOADING;});builder.addCase(fetchProposals.fulfilled,function(state,action){var proposals=action.payload.reduce(function(accum,proposal){return _objectSpread(_objectSpread({},accum),{},_defineProperty({},proposal.id,proposal));},{});state.proposals=merge({},state.proposals,proposals);state.proposalLoadingStatus=VotingStateLoadingStatus.IDLE;});// Fetch Proposal\nbuilder.addCase(fetchProposal.pending,function(state){state.proposalLoadingStatus=VotingStateLoadingStatus.LOADING;});builder.addCase(fetchProposal.fulfilled,function(state,action){state.proposals[action.payload.id]=action.payload;state.proposalLoadingStatus=VotingStateLoadingStatus.IDLE;});// Fetch Votes\nbuilder.addCase(fetchVotes.pending,function(state){state.voteLoadingStatus=VotingStateLoadingStatus.LOADING;});builder.addCase(fetchVotes.fulfilled,function(state,action){var _action$payload2=action.payload,votes=_action$payload2.votes,proposalId=_action$payload2.proposalId;state.votes=_objectSpread(_objectSpread({},state.votes),{},_defineProperty({},proposalId,votes));state.voteLoadingStatus=VotingStateLoadingStatus.IDLE;});}});export default votingSlice.reducer;","map":{"version":3,"sources":["/Volumes/evo970/lou/madDex-master/src/state/voting/index.tsx"],"names":["createAsyncThunk","createSlice","merge","ProposalState","VotingStateLoadingStatus","getAllVotes","getProposal","getProposals","getVoteVerificationStatuses","initialState","proposalLoadingStatus","INITIAL","proposals","voteLoadingStatus","votes","fetchProposals","first","skip","state","ACTIVE","response","fetchProposal","proposalId","fetchVotes","block","verifyVotes","snapshot","getState","proposalVotes","voting","Number","results","votingSlice","name","reducers","extraReducers","builder","addCase","fulfilled","action","payload","map","vote","_inValid","id","pending","LOADING","reduce","accum","proposal","IDLE","reducer"],"mappings":"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","sourcesContent":["import { createAsyncThunk, createSlice } from '@reduxjs/toolkit'\nimport { merge } from 'lodash'\nimport { Proposal, ProposalState, VotingStateLoadingStatus, VotingState, Vote, State } from 'state/types'\nimport { getAllVotes, getProposal, getProposals, getVoteVerificationStatuses } from './helpers'\n\nconst initialState: VotingState = {\n  proposalLoadingStatus: VotingStateLoadingStatus.INITIAL,\n  proposals: {},\n  voteLoadingStatus: VotingStateLoadingStatus.INITIAL,\n  votes: {},\n}\n\n// Thunks\nexport const fetchProposals = createAsyncThunk<Proposal[], { first?: number; skip?: number; state?: ProposalState }>(\n  'voting/fetchProposals',\n  async ({ first, skip = 0, state = ProposalState.ACTIVE }) => {\n    const response = await getProposals(first, skip, state)\n    return response\n  },\n)\n\nexport const fetchProposal = createAsyncThunk<Proposal, string>('voting/fetchProposal', async (proposalId) => {\n  const response = await getProposal(proposalId)\n  return response\n})\n\nexport const fetchVotes = createAsyncThunk<\n  { votes: Vote[]; proposalId: string },\n  { proposalId: string; block?: number }\n>('voting/fetchVotes', async ({ proposalId, block }) => {\n  const response = await getAllVotes(proposalId, block)\n  return { votes: response, proposalId }\n})\n\nexport const verifyVotes = createAsyncThunk<\n  { results: { [key: string]: boolean }; proposalId: string },\n  { proposalId: string; snapshot?: string },\n  { state: State }\n>('voting/verifyVotes', async ({ proposalId, snapshot }, { getState }) => {\n  const state = getState()\n  const proposalVotes = state.voting.votes[proposalId]\n  const response = await getVoteVerificationStatuses(proposalVotes, Number(snapshot))\n  return { results: response, proposalId }\n})\n\nexport const votingSlice = createSlice({\n  name: 'voting',\n  initialState,\n  reducers: {},\n  extraReducers: (builder) => {\n    // Verify Votes\n    builder.addCase(verifyVotes.fulfilled, (state, action) => {\n      const { proposalId, results } = action.payload\n\n      if (state.votes[proposalId]) {\n        state.votes[proposalId] = state.votes[proposalId].map((vote) => {\n          return {\n            ...vote,\n            _inValid: results[vote.id] === false,\n          }\n        })\n      }\n    })\n\n    // Fetch Proposals\n    builder.addCase(fetchProposals.pending, (state) => {\n      state.proposalLoadingStatus = VotingStateLoadingStatus.LOADING\n    })\n    builder.addCase(fetchProposals.fulfilled, (state, action) => {\n      const proposals = action.payload.reduce((accum, proposal) => {\n        return {\n          ...accum,\n          [proposal.id]: proposal,\n        }\n      }, {})\n\n      state.proposals = merge({}, state.proposals, proposals)\n      state.proposalLoadingStatus = VotingStateLoadingStatus.IDLE\n    })\n\n    // Fetch Proposal\n    builder.addCase(fetchProposal.pending, (state) => {\n      state.proposalLoadingStatus = VotingStateLoadingStatus.LOADING\n    })\n    builder.addCase(fetchProposal.fulfilled, (state, action) => {\n      state.proposals[action.payload.id] = action.payload\n      state.proposalLoadingStatus = VotingStateLoadingStatus.IDLE\n    })\n\n    // Fetch Votes\n    builder.addCase(fetchVotes.pending, (state) => {\n      state.voteLoadingStatus = VotingStateLoadingStatus.LOADING\n    })\n    builder.addCase(fetchVotes.fulfilled, (state, action) => {\n      const { votes, proposalId } = action.payload\n\n      state.votes = {\n        ...state.votes,\n        [proposalId]: votes,\n      }\n      state.voteLoadingStatus = VotingStateLoadingStatus.IDLE\n    })\n  },\n})\n\nexport default votingSlice.reducer\n"]},"metadata":{},"sourceType":"module"}